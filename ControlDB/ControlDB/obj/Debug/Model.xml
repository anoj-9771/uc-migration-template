<?xml version="1.0" encoding="utf-8"?>
<DataSchemaModel FileFormatVersion="1.2" SchemaVersion="3.3" DspName="Microsoft.Data.Tools.Schema.Sql.SqlAzureV12DatabaseSchemaProvider" CollationLcid="1033" CollationCaseSensitive="False" xmlns="http://schemas.microsoft.com/sqlserver/dac/Serialization/2012/02">
	<Header>
		<CustomData Category="AnsiNulls">
			<Metadata Name="AnsiNulls" Value="True" />
		</CustomData>
		<CustomData Category="QuotedIdentifier">
			<Metadata Name="QuotedIdentifier" Value="True" />
		</CustomData>
		<CustomData Category="CompatibilityMode">
			<Metadata Name="CompatibilityMode" Value="150" />
		</CustomData>
		<CustomData Category="Reference" Type="Assembly">
			<Metadata Name="LogicalName" Value="ControlDB.dll" />
			<Metadata Name="FileName" Value="C:\USERS\CODILI\ONEDRIVE - INSIGHT\DESKTOP\SUNSUPER\ADS\TESTING\TEST2\SUNSUPERTEST2\CONTROLDB\CONTROLDB\OBJ\DEBUG\CONTROLDB.DLL" />
			<Metadata Name="AssemblyName" Value="ControlDB" />
			<Metadata Name="PermissionSet" Value="SAFE" />
			<Metadata Name="Owner" Value="" />
			<Metadata Name="GenerateSqlClrDdl" Value="True" />
			<Metadata Name="IsVisible" Value="True" />
			<Metadata Name="IsModelAware" Value="True" />
			<Metadata Name="SkipCreationIfEmpty" Value="True" />
			<Metadata Name="AssemblySymbolsName" Value="c:\users\codili\onedrive - insight\desktop\sunsuper\ads\testing\test2\sunsupertest2\controldb\ControlDB\obj\Debug\ControlDB.pdb" />
		</CustomData>
		<CustomData Category="SqlCmdVariables" Type="SqlCmdVariable" />
	</Header>
	<Model>
		<Element Type="SqlDatabaseOptions">
			<Property Name="Collation" Value="SQL_Latin1_General_CP1_CI_AS" />
			<Property Name="IsAnsiNullDefaultOn" Value="True" />
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Property Name="IsAnsiWarningsOn" Value="True" />
			<Property Name="IsArithAbortOn" Value="True" />
			<Property Name="IsConcatNullYieldsNullOn" Value="True" />
			<Property Name="IsTornPageProtectionOn" Value="False" />
			<Property Name="IsFullTextEnabled" Value="True" />
			<Property Name="PageVerifyMode" Value="3" />
			<Property Name="DefaultLanguage" Value="" />
			<Property Name="DefaultFullTextLanguage" Value="" />
			<Property Name="QueryStoreDesiredState" Value="0" />
			<Property Name="QueryStoreCaptureMode" Value="1" />
			<Property Name="QueryStoreStaleQueryThreshold" Value="367" />
			<Property Name="MaxDop" Value="0" />
		</Element>
		<Element Type="SqlSchema" Name="[CTL]">
			<Relationship Name="Authorizer">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[dbo]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[CTL].[BatchExecutionLog]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[BatchExecutionLog].[BatchExecutionLogId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[BatchExecutionLog].[StartDate]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[BatchExecutionLog].[EndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[BatchExecutionLog].[BatchExecutionStatus]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[BatchExecutionLog].[ErrorMessage]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="2000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[BatchExecutionLog].[ProjectID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="3" />
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[ClearDB]">
			<Property Name="BodyScript">
				<Value><![CDATA[

Delete From [CTL].[ControlTaskCommand]

Delete From [CTL].[TaskExecutionLog]

Delete From [CTL].[BatchExecutionLog]

Delete From [CTL].[ControlWatermark]

Delete From [CTL].[ControlTasks]
			
Delete From [CTL].[ControlSource]
			
Delete From [CTL].[ControlTarget]

DELETE FROM CTL.ControlManifest

DBCC CHECKIDENT ('CTL.ControlTarget',Reseed,0)
DBCC CHECKIDENT ('CTL.ControlSource',Reseed,0)
DBCC CHECKIDENT ('CTL.ControlTasks',Reseed,0)
DBCC CHECKIDENT ('CTL.BatchExecutionLog',Reseed,0)
DBCC CHECKIDENT ('CTL.TaskExecutionLog',Reseed,0)
DBCC CHECKIDENT ('CTL.ControlTaskCommand',Reseed,0)
DBCC CHECKIDENT ('CTL.ControlWatermark',Reseed,0)]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlTaskCommand]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="699" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE   PROC [CTL].[ClearDB]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[CTL].[Configuration]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[Configuration].[ConfigurationKey]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[Configuration].[ConfigurationValue]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlComplianceDependency]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlComplianceDependency].[TableName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlCuratedConfig]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedConfig].[SubjectArea]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedConfig].[Project]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedConfig].[DependentTableName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedConfig].[Valid]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="4" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlCuratedManifest]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedManifest].[BatchExecutionLogID]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedManifest].[TaskExecutionLogID]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedManifest].[SubjectArea]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedManifest].[Project]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedManifest].[StartPeriod]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedManifest].[EndPeriod]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedManifest].[LoadStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedManifest].[StartTimestamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlCuratedManifest].[EndTimeStamp]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="5" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlDataLoadTypes]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadTypes].[DataLoadTypeID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadTypes].[DataLoadType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadTypes].[DeltaExtract]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadTypes].[CDCSource]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadTypes].[TruncateTarget]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadTypes].[UpsertTarget]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="6" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlDataLoadValidation]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[DataValidationID]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[ProjectRunID]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[ObjectName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[SourceHighWatermark]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[SourceRecordCount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[SourceTotalValue]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[SourceMinValue]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[SourceMaxValue]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[TargetHighWatermark]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[TargetRecordCount]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[TargetTotalValue]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[TargetMinValue]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlDataLoadValidation].[TargetMaxValue]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlManifest]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[BatchExecutionLogID]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[TaskExecutionLogID]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[SourceObject]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[Container]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[StartCounter]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="500" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[EndCounter]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="500" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[RecordCountLoaded]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[RecordCountDeltaTable]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[FolderName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[FileName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[ProcessedToTrustedZone]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[DeltaColumn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[ProcessedToSQLEDW]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[RawZonePipelineRunID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[TrustedZonePipelineRunID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlManifest].[SQLEDWPipelineRunID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="7" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlProjects]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlProjects].[ProjectId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlProjects].[ProjectName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlProjects].[Enabled]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="8" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlProjectSchedule]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlProjectSchedule].[ControlTaskScheduleId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlProjectSchedule].[ControlProjectId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlProjectSchedule].[CronExpression]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="250" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlProjectSchedule].[ControlStageID]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlProjectSchedule].[TriggerName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="9" />
		</Element>
		<Element Type="SqlIndex" Name="[CTL].[ControlProjectSchedule].[IX_ControlProjectSchedule_Unique]">
			<Property Name="IsUnique" Value="True" />
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlProjectSchedule].[ControlProjectId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlProjectSchedule].[ControlStageID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlProjectSchedule].[TriggerName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="IndexedObject">
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlSource]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[SourceId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[SourceName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[SourceTypeId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[SourceLocation]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[LoadSource]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[SourceServer]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[Processor]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[BusinessKeyColumn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[AdditionalProperty]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[IsAuditTable]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[SoftDeleteSource]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[UseAuditTable]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSource].[ValidationColumn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="10" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="11" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlSourceColumns]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSourceColumns].[ControlSourceColumnId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSourceColumns].[SourceTableId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSourceColumns].[ColumnName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSourceColumns].[DataType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSourceColumns].[MaxLength]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSourceColumns].[Precision]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSourceColumns].[ColumnQuery]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlSourceColumns].[SourceProcessor]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="12" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlStages]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlStages].[ControlStageId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlStages].[StageSequence]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlStages].[StageName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="13" />
		</Element>
		<Element Type="SqlIndex" Name="[CTL].[ControlStages].[IX_ControlStages_StageName]">
			<Property Name="IsUnique" Value="True" />
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlStages].[StageName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="IndexedObject">
				<Entry>
					<References Name="[CTL].[ControlStages]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlIndex" Name="[CTL].[ControlStages].[IX_ControlStages_StageSequence]">
			<Property Name="IsUnique" Value="True" />
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlStages].[StageSequence]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="IndexedObject">
				<Entry>
					<References Name="[CTL].[ControlStages]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlTarget]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTarget].[TargetId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTarget].[TargetName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTarget].[TargetTypeId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTarget].[TargetLocation]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTarget].[TargetEnabled]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTarget].[Compressed]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTarget].[TargetServer]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="14" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="15" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlTargetColumns]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTargetColumns].[ControlTargetColumnId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTargetColumns].[TargetId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTargetColumns].[ColumnName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTargetColumns].[DataType]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTargetColumns].[MaxLength]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTargetColumns].[Precision]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="16" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="17" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlTaskCommand]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTaskCommand].[CommandId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTaskCommand].[ControlTaskId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTaskCommand].[CommandTypeId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTaskCommand].[Command]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="18" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="19" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlTasks]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[TaskId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[TaskName]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[SourceId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[TargetId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[TruncateTarget]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[TaskEnabled]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[LoadLatestOnly]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[ExecuteSourceSQLasStoredProc]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[ControlStageId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[ProjectId]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[ObjectGrain]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="30" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[DataLoadMode]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[TrackChanges]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTasks].[LoadToSqlEDW]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="20" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="21" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="22" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="23" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="24" />
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlTypes]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTypes].[TypeId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlTypes].[ControlType]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="25" />
		</Element>
		<Element Type="SqlIndex" Name="[CTL].[ControlTypes].[IX_ControlTypes_ControlType]">
			<Property Name="IsUnique" Value="True" />
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlTypes].[ControlType]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="IndexedObject">
				<Entry>
					<References Name="[CTL].[ControlTypes]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlTable" Name="[CTL].[ControlWatermark]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlWatermark].[WatermarkId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlWatermark].[ControlSourceId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlWatermark].[SourceColumn]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlWatermark].[SourceSQL]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="2000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlWatermark].[Watermarks]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[ControlWatermark].[SourceName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[nvarchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="26" />
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="27" />
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[CreateBatchLog]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

	If (Select Count(*) From CTL.BatchExecutionLog Where BatchExecutionStatus = 'In Progress' AND ProjectID = @ProjectID) > 0 
		BEGIN
			RAISERROR('Execution batch already in progress', 16, 1) 
		END
	Else
	  BEGIN
		Insert Into CTL.BatchExecutionLog (StartDate, BatchExecutionStatus, ProjectID) Values ([CTL].[udf_GetDateLocalTZ](), 'In Progress', @ProjectID)
		Select @@IDENTITY BatchLogId
	  END

END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[BatchExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[ProjectID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateBatchLog].[@ProjectID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[StartDate]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[ProjectID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetDateLocalTZ]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateBatchLog].[@ProjectID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="485" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE Procedure [CTL].[CreateBatchLog] (@ProjectID bigint)&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[CreateManifestRecord]">
			<Property Name="BodyScript">
				<Value><![CDATA[ 

SET @DeltaColumn = ISNULL(@DeltaColumn, '')

DECLARE @Start varchar(500)
IF ISDATE(@StartCounter) = 1
	SET @Start = FORMAT(TRY_CONVERT(DATETIME, @StartCounter), 'yyyy-MM-ddTHH:mm:ss')
ELSE
	SET @Start = @StartCounter

DECLARE @End varchar(500)
IF ISDATE(@EndCounter) = 1
	SET @End = FORMAT(TRY_CONVERT(DATETIME, @EndCounter), 'yyyy-MM-ddTHH:mm:ss')
ELSE
	SET @End = @EndCounter


INSERT INTO CTL.ControlManifest(
	[BatchExecutionLogID]
	,[TaskExecutionLogID]
	,[SourceObject]
	,[Container]
	,[DeltaColumn]
	,[StartCounter]
	,[EndCounter]
	,[RecordCountLoaded]
	,[RecordCountDeltaTable]
	,[FolderName]
	,[FileName]
	,[RawZonePipelineRunID]
	)
VALUES (
	@BatchExecutionLogID
	,@TaskExecutionLogID
	,@SourceObject
	,@Container
	,@DeltaColumn
	,@Start
	,@End
	,@Records
	,NULL
	,@FolderName
	,@FileName
	,@PipelineRunID
	)]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@DeltaColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@StartCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@EndCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[TaskExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[Container]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[DeltaColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[StartCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[EndCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[RecordCountLoaded]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[RecordCountDeltaTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[FolderName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[FileName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[RawZonePipelineRunID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@TaskExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@Container]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@Records]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@FolderName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@FileName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateManifestRecord].[@PipelineRunID]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@BatchExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@TaskExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@SourceObject]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@Container]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@DeltaColumn]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@StartCounter]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="500" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@EndCounter]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="500" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@Records]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@RecordsDeltaTable]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA[0]]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@FolderName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@FileName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateManifestRecord].[@PipelineRunID]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="1270" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE [CTL].[CreateManifestRecord] (&#xD;&#xA;&#x9;@BatchExecutionLogID bigint,&#xD;&#xA;&#x9;@TaskExecutionLogID bigint,&#xD;&#xA;&#x9;@SourceObject varchar(1000),&#xD;&#xA;&#x9;@Container varchar(1000),&#xD;&#xA;&#x9;@DeltaColumn varchar(100),&#xD;&#xA;&#x9;@StartCounter varchar(500),&#xD;&#xA;&#x9;@EndCounter varchar(500),&#xD;&#xA;&#x9;@Records bigint,&#xD;&#xA;&#x9;@RecordsDeltaTable bigint = 0,&#xD;&#xA;&#x9;@FolderName varchar(1000),&#xD;&#xA;&#x9;@FileName varchar(1000),&#xD;&#xA;&#x9;@PipelineRunID varchar(50) = ''&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[CreateSource]">
			<Property Name="BodyScript">
				<Value><![CDATA[ 

declare @TargetName varchar(1000), @TargetLocation varchar(1000)
SET @TargetName = @SourceObjectName
SET @TargetLocation = @DLRawSubFolder

declare @project int
declare @startStage int, @endStage int
declare @sourceTypeId int, @rawTypeId int, @stageTypeId int, @databricksTypeId int
declare @taskName varchar(650)

declare @error varchar(1000)
declare @counter int
declare @currentStage varchar(50)

--Default option is to load all tables to SQLEDW. If any table does not need to be loaded, then manually run the UPDATE command
DECLARE @LoadToSqlEDW bit = 1

--Update Flags based on value
declare @TrackChangeFlag bit
IF UPPER(@TrackChanges) IN ('YES', 'Y') 
	SET @TrackChangeFlag = 1
ELSE
	SET @TrackChangeFlag = 0

DECLARE @IsAuditTableFlag bit
IF UPPER(@IsAuditTable) IN ('YES', 'Y') 
	SET @IsAuditTableFlag = 1
ELSE
	SET @IsAuditTableFlag = 0

--If Data Load Mode is TRUNCATE-LOAD then TrackChange is false
IF @DataLoadMode = 'TRUNCATE-LOAD'
	SET @TrackChangeFlag = 0

IF @DataLoadMode = 'INCREMENTAL' AND @WatermarkColumn = ''
BEGIN
	RAISERROR('Please specify a WatermarkColumn when the data load mode is INCREMENTAL', 16, 1)
	RETURN
END

IF @DataLoadMode != 'TRUNCATE-LOAD' AND @BusinessKeyColumn = '' AND @StartStageName = 'Source to Raw'
BEGIN
	RAISERROR('Please specify a BusinessKeyColumn column when the data load mode is not TRUNCATE-LOAD', 16, 1) 
	RETURN
END

IF @TrackChangeFlag = 1 AND @BusinessKeyColumn = ''
BEGIN
	RAISERROR('Please specify a BusinessKeyColumn column when TrackChanges is Yes', 16, 1) 
	RETURN
END

--Get project id
set @project = (select ProjectId from [CTL].[ControlProjects] where ProjectName = @ProjectName)

set @error = 'Invalid project name: ' + @ProjectName
if @project is null raiserror(@error,16,1)

--Get start stage id
set @startStage = (select ControlStageId from [CTL].[ControlStages] where StageName = @StartStageName)

set @error = 'Invalid starting stage: ' + @StartStageName
if @startStage is null raiserror(@error,16,1)

--Get end stage id
set @endStage = (select ControlStageId from [CTL].[ControlStages] where StageName = @EndStageName)

set @error = 'Invalid starting stage: ' + @EndStageName
if @endStage is null raiserror(@error,16,1)

--Get source type id
set @sourceTypeId = (select TypeId from [CTL].[ControlTypes] where ControlType = @SourceType)

set @error = 'Invalid source type: ' + @SourceType
if @sourceTypeId is null raiserror(@error,16,1)

--Get raw type id
set @rawTypeId = (select TypeId from [CTL].[ControlTypes] where ControlType = @DLRawType)

set @error = 'Invalid raw zone type: ' + @DLRawType
if @rawTypeId is null raiserror(@error,16,1)

--Get stage type id
set @stageTypeId = (select TypeId from [CTL].[ControlTypes] where ControlType = @DLStagedType)

set @error = 'Invalid stage zone type: ' + @DLStagedType
if @stageTypeId is null raiserror(@error,16,1)


DECLARE @StageFolder varchar(100)
SET @StageFolder =  @DLStagedMainFolder + '/' + @DLStagedSubFolder

--set @deltaFlag = case when @Delta = 'Yes' then 1 else 0 end
set @databricksTypeId = (select typeid from [CTL].[ControlTypes] where ControlType = 'Databricks')

SET @SoftDeleteSource = TRIM(@SoftDeleteSource)
SET @AdditionalProperty = TRIM(@AdditionalProperty)

set @counter = @startStage
While @counter <= @endStage
begin
	
	PRINT 'Starting Stage : ' + CONVERT(VARCHAR, @counter)

	set @currentStage = (select StageName from [CTL].[ControlStages] where ControlStageId = @counter)
	set @taskName = replace(replace(trim(@SourceName + '_' + @SourceObjectName),'[',''),']','')
	set @targetName = replace(replace(trim(@SourceObjectName),'[',''),']','')

	PRINT @currentStage + ' - ' + @taskName + ' - ' + @targetName

	if @currentStage = 'Source to Raw'
	BEGIN
		EXEC [CTL].[CreateTask] 
			@SourceName
			,@SourceObjectName
			,@sourceTypeId
			,@SourceSecretName
			,@DBProcessor
			,@TargetName
			,@TargetLocation
			,@rawTypeId
			,@DLRawSecret
			,@counter
			,@project
			,@sourceTypeId
			,@SourceCommand
			,@DataLoadMode
			,@DLObjectGrain
			,@BusinessKeyColumn
			,@WatermarkColumn
			,@TrackChangeFlag
			,@AdditionalProperty
			,@LoadToSqlEDW
			,@IsAuditTableFlag
			,@SoftDeleteSource

	END

    if @currentStage = 'Raw to Trusted'
	BEGIN
		EXEC [CTL].[CreateTask] 
			@SourceName
			,@TargetLocation
			,@rawTypeId
			,@DLRawSecret
			,@DBProcessor
			,@DLRawSubFolder
			,@StageFolder
			,@StageTypeId
			,@DLStagedSecret
			,@counter
			,@project
			,@databricksTypeId
			,@DLRawtoStageCommand
			,@DataLoadMode
			,@DLObjectGrain
			,@BusinessKeyColumn
			,@WatermarkColumn
			,@TrackChangeFlag
			,@AdditionalProperty
			,@LoadToSqlEDW
			,@IsAuditTableFlag
			,@SoftDeleteSource

	END
	

	if @currentStage = 'Trusted to Curated'
	BEGIN

		EXEC [CTL].[CreateTask] 
			@SourceName
			,@DLStagedMainFolder
			,@stageTypeId
			,@DLStagedSecret
			,@DBProcessor
			,@DLRawSubFolder 
			,@targetName
			,1
			,@StageDBSecret
			,@counter
			,@project
			,@databricksTypeId
			,@DLStagetoDBCommand
			,0
			,@DLObjectGrain
			,@BusinessKeyColumn
			,@WatermarkColumn
			,@TrackChangeFlag
			,@AdditionalProperty
			,@LoadToSqlEDW
			,@IsAuditTableFlag
			,@SoftDeleteSource
	END	

	if @currentStage IN ('Cubes', 'DW Export')
	BEGIN

		SET @TargetLocation = REPLACE(@SourceObjectName, '.', '_')

		EXEC [CTL].[CreateTask] 
			@SourceName
			,@SourceObjectName
			,@SourceTypeId
			,'' --SourceSecretName
			,@DBProcessor
			,@TargetName
			,@TargetLocation
			,@SourceTypeId
			,@SourceSecretName
			,@counter
			,@project
			,@sourceTypeId
			,@SourceCommand
			,@DataLoadMode
			,@DLObjectGrain
			,@BusinessKeyColumn
			,@WatermarkColumn
			,@TrackChangeFlag
			,@AdditionalProperty
			,@LoadToSqlEDW
			,@IsAuditTableFlag
			,@SoftDeleteSource

	END
	set @counter += 1
end]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bit]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bit]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bit]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@SourceObjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DLRawSubFolder]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@TrackChanges]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@IsAuditTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DataLoadMode]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@WatermarkColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@BusinessKeyColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@StartStageName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@ProjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[StageName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@EndStageName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[TypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[ControlType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@SourceType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DLRawType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DLStagedType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DLStagedMainFolder]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DLStagedSubFolder]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@SoftDeleteSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@AdditionalProperty]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@SourceSecretName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DBProcessor]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DLRawSecret]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@SourceCommand]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DLObjectGrain]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DLStagedSecret]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DLRawtoStageCommand]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@StageDBSecret]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateSource].[@DLStagetoDBCommand]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@ProjectName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@StartStageName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@EndStageName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@SourceName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@SourceObjectName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="500" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@SourceType]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DataLoadMode]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@SourceSecretName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DLRawSecret]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DLStagedSecret]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DBProcessor]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@StageDBSecret]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DLRawSubFolder]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DLRawType]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DLStagedMainFolder]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DLStagedSubFolder]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DLStagedType]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DLObjectGrain]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@SourceCommand]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="5000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DLRawtoStageCommand]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="5000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@DLStagetoDBCommand]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="5000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@TargetObjectType]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@TargetOverride]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="150" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@BusinessKeyColumn]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="150" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@WatermarkColumn]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="150" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@TrackChanges]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@AdditionalProperty]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@IsAuditTable]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateSource].[@SoftDeleteSource]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="4" />
				<Property Name="Length" Value="7121" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;CREATE PROC [CTL].[CreateSource] &#xD;&#xA;        @ProjectName&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@StartStageName&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@EndStageName&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@SourceName&#x9;&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@SourceObjectName&#x9; varchar(500),&#xD;&#xA;&#x9;&#x9;@SourceType&#x9;&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@DataLoadMode&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@SourceSecretName&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@DLRawSecret&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@DLStagedSecret&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@DBProcessor&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@StageDBSecret&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@DLRawSubFolder&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@DLRawType&#x9;&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@DLStagedMainFolder&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@DLStagedSubFolder&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@DLStagedType&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@DLObjectGrain&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@SourceCommand&#x9;&#x9; varchar(5000),&#xD;&#xA;&#x9;&#x9;@DLRawtoStageCommand varchar(5000),&#xD;&#xA;&#x9;&#x9;@DLStagetoDBCommand  varchar(5000),&#xD;&#xA;&#x9;&#x9;@TargetObjectType&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@TargetOverride&#x9;&#x9; varchar(150),&#xD;&#xA;&#x9;&#x9;@BusinessKeyColumn&#x9; varchar(150),&#xD;&#xA;&#x9;&#x9;@WatermarkColumn&#x9; varchar(150),&#xD;&#xA;&#x9;&#x9;@TrackChanges&#x9;&#x9; varchar(100),&#xD;&#xA;&#x9;&#x9;@AdditionalProperty&#x9; varchar(max),&#xD;&#xA;&#x9;&#x9;@IsAuditTable&#x9;&#x9; varchar(100) = '', --Add column to track if the table is a Audit Table&#xD;&#xA;&#x9;&#x9;@SoftDeleteSource&#x9; varchar(100) = '' --Name of the source to be used for Soft Delete&#xD;&#xA;as" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[CreateTask]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
	Declare	@SourceId BigInt,
	        @TargetId BigInt,
			@TaskId BigInt

	Begin Try
	Begin Transaction

		DECLARE @UseAuditTable INT
		SET @UseAuditTable = 0 --The default value to UseAuditTable is False for now. If Audit Table is to be used, then set the value to 1 manually

		--If the table is a Audit table, update the values for Audit Table
		IF @IsAuditTable = 1
		BEGIN
			PRINT 'Processing records for Audit Table'
			SET @LoadToSqlEDW = 0 --Do not load Audit table to SQLEDW
			SET @DataLoadMode  = 'APPEND' --No Merge required for Audit table
			SET @TrackChangeFlag = 0 --No track changes required

			IF @StageId = 1
			BEGIN
				SET @Command = 'SELECT ' + @BusinessKeyColumn + ', ' + @WatermarkColumn + ' FROM ' + @SourceLocation --Update SQL to fetch only needed columns
			END

		END

		PRINT 'Adding record to ControlSource'
		Insert Into CTL.ControlSource (SourceName, SourceTypeId, SourceLocation, LoadSource, SourceServer, Processor, BusinessKeyColumn, AdditionalProperty, IsAuditTable, SoftDeleteSource, UseAuditTable) 
		Values(@SourceName, @SourceTypeId, @SourceLocation, 1, @SourceServer, @Processor, @BusinessKeyColumn, @AdditionalProperty, @IsAuditTable, @SoftDeleteSource, @UseAuditTable)
		Select @SourceId = @@IDENTITY

		PRINT 'Adding record to ControlTarget'
		Insert Into CTL.ControlTarget (TargetName, TargetTypeId, TargetLocation, TargetEnabled, TargetServer, Compressed) 
		Values (@SourceName, @TargetTypeId, @TargetLocation, 1, @TargetServer, 1)
		Select @TargetId = @@IDENTITY

		PRINT 'Adding record to ControlTasks'
		Insert Into CTL.ControlTasks (TaskName, SourceId, TargetId, TruncateTarget, TaskEnabled, LoadLatestOnly, 
			ExecuteSourceSQLasStoredProc, ControlStageId, ProjectId, ObjectGrain, DataLoadMode, TrackChanges, LoadToSqlEDW)
		Values (@SourceName, @SourceId, @TargetId, 0, 1, 0, 1, @StageId, @ProjectId, @Grain, @DataLoadMode, @TrackChangeFlag, @LoadToSqlEDW)
		Select @TaskId = @@IDENTITY
		
		PRINT 'Adding record to ControlTaskCommand'
		Insert Into CTL.[ControlTaskCommand] (ControlTaskId, CommandTypeId, Command)
		Values (@TaskId, @CommandType, @Command)

		--Updated by Rahul to add the default entry for Watermark for CDC Sources
		IF @DataLoadMode = 'CDC' AND @StageId = 1
		BEGIN
			PRINT 'Inserting initial watermark for CDC' 
			DECLARE @StartLSN varchar(20)
			SELECT @StartLSN = upper(sys.fn_varbintohexstr(sys.fn_cdc_map_time_to_lsn('START-LSN', '2000-01-01 12:00:00.000')))

			INSERT INTO CTL.ControlWatermark (ControlSourceId, SourceColumn, SourceSQL, Watermarks, SourceName)
			VALUES (@TaskId, '__$start_lsn', '', @StartLSN, @SourceName)
		END

		IF @DataLoadMode IN ('INCREMENTAL', 'APPEND') AND @StageId = 1
		BEGIN
			PRINT 'Inserting initial watermark column'

			INSERT INTO CTL.ControlWatermark (ControlSourceId, SourceColumn, SourceSQL, Watermarks, SourceName)
			VALUES (@SourceId, @WatermarkColumn, @WatermarkColumn, '2000-01-01 00:00:00', @SourceName)
		END

		IF NOT EXISTS(SELECT 1 FROM CTL.ControlProjectSchedule WHERE ControlProjectId = @ProjectId AND ControlStageID = @StageId)
		BEGIN
			DECLARE @ProjectName varchar(100)
			SELECT @ProjectName = ProjectName FROM CTL.ControlProjects WHERE ProjectId = @ProjectId
			--If the Project Schedule does not exist, add a default schedule entry
			INSERT INTO CTL.ControlProjectSchedule (ControlProjectId, ControlStageID, TriggerName) VALUES (@ProjectId, @StageId, @ProjectName)
		END


	Commit
	End Try
	Begin Catch

		Rollback
		Declare @err_num  int = @@ERROR
		Declare @err_desc varchar(500) = ERROR_MESSAGE()
		raiserror(@err_desc,@err_num,1)

	End Catch

END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@IsAuditTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@LoadToSqlEDW]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@DataLoadMode]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@TrackChangeFlag]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@StageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@Command]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@BusinessKeyColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@WatermarkColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[LoadSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceServer]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[Processor]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[BusinessKeyColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[AdditionalProperty]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[IsAuditTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SoftDeleteSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[UseAuditTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@SourceTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@SourceServer]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@Processor]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@AdditionalProperty]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@SoftDeleteSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetEnabled]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetServer]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[Compressed]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@TargetTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@TargetLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@TargetServer]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TruncateTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskEnabled]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[LoadLatestOnly]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ExecuteSourceSQLasStoredProc]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ObjectGrain]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[DataLoadMode]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TrackChanges]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[LoadToSqlEDW]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@Grain]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[CommandTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[Command]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTask].[@CommandType]" />
				</Entry>
				<Entry />
				<Entry />
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceSQL]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[Watermarks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlStageID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlStageID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[TriggerName]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@SourceName]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@SourceLocation]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@SourceTypeId]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA[2]]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@SourceServer]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@Processor]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@TargetName]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@TargetLocation]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@TargetTypeId]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA[4]]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@TargetServer]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@StageId]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA[2]]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@ProjectId]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA[1]]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@CommandType]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA[1]]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@Command]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@DataLoadMode]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@Grain]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="30" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@BusinessKeyColumn]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@WatermarkColumn]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@TrackChangeFlag]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA[0]]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@AdditionalProperty]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="IsMax" Value="True" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@LoadToSqlEDW]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA[0]]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@IsAuditTable]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA[0]]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTask].[@SoftDeleteSource]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="8" />
				<Property Name="Length" Value="4439" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;CREATE Procedure [CTL].[CreateTask] &#xD;&#xA;&#x9;@SourceName Varchar(255) = '',&#xD;&#xA;    @SourceLocation Varchar(255) = '',&#xD;&#xA;&#x9;@SourceTypeId BigInt = 2,  &#xD;&#xA;&#x9;@SourceServer varchar(255) = '',&#xD;&#xA;&#x9;@Processor varchar(255) = '',&#xD;&#xA;&#x9;@TargetName Varchar(255) = '',&#xD;&#xA;&#x9;@TargetLocation Varchar(255) = '',&#xD;&#xA;&#x9;@TargetTypeId BigInt = 4,&#xD;&#xA;&#x9;@TargetServer varchar(255)= '',&#xD;&#xA;&#x9;@StageId BigInt = 2,&#xD;&#xA;&#x9;@ProjectId BigInt = 1,&#xD;&#xA;&#x9;@CommandType int = 1,&#xD;&#xA;&#x9;@Command varchar(max)= '',&#xD;&#xA;&#x9;@DataLoadMode varchar(100) = '',&#xD;&#xA;&#x9;@Grain varchar(30) = '',&#xD;&#xA;&#x9;@BusinessKeyColumn varchar(100) = '',&#xD;&#xA;&#x9;@WatermarkColumn varchar(100) = '',&#xD;&#xA;&#x9;@TrackChangeFlag bit = 0,&#xD;&#xA;&#x9;@AdditionalProperty&#x9;varchar(max) = '', &#xD;&#xA;&#x9;@LoadToSqlEDW BIT = 0,&#xD;&#xA;&#x9;@IsAuditTable BIT = 0,&#xD;&#xA;&#x9;@SoftDeleteSource varchar(100) = ''&#xD;&#xA;&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[CreateTaskLog]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
	If (Select Count(*) From CTL.BatchExecutionLog Where BatchExecutionLogId = @BatchLogId And BatchExecutionStatus = 'In Progress') = 0
	  BEGIN
		RAISERROR('Batch execution log could not be located',16,1)
	  END
	Else
	  BEGIN
	    If (Select Count(*) From CTL.TaskExecutionLog Where ControlTaskId = @TaskId And ExecutionStatus = 'In Progress') > 0
		  BEGIN
			RAISERROR('Task is already in progress',16,1)
		  END
		Else
		  BEGIN
			Insert Into CTL.TaskExecutionLog (BatchExecutionId, ControlTaskId, StartTime, ExecutionStatus) 
				Values (@BatchLogId, @TaskId, [CTL].[udf_GetDateLocalTZ](), 'In Progress')
			Select @@IDENTITY TaskLogId
		  END
	  END
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[BatchExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionLogId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTaskLog].[@BatchLogId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CreateTaskLog].[@TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[BatchExecutionId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[StartTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetDateLocalTZ]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTaskLog].[@BatchLogId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CreateTaskLog].[@TaskId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="764" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE Procedure [CTL].[CreateTaskLog] (@BatchLogId BigInt, @TaskId BigInt)&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[CuratedGetProcessingPeriod]">
			<Property Name="BodyScript">
				<Value><![CDATA[

--DECLARE @SubjectArea varchar(255) = 'NAT';
--DECLARE @Project varchar(255) = 'ComplianceCurated';

DECLARE @StartDate DATETIME;
DECLARE @EndDate DATETIME;

IF EXISTS(SELECT 1 FROM CTL.ControlCuratedConfig Config WHERE Config.SubjectArea =  @SubjectArea AND Config.Project =  @Project)
BEGIN
	--Check If there are configuration then get the dates from data load information
	WITH AllList AS (
		--Get all the data load entries from ControlManifest for the passed parameter for Curated Entity and Rank them
		SELECT  
			[SourceObject]
			,[StartCounter]
			,[EndCounter]
			,ROW_NUMBER() over (PARTITION BY SourceObject ORDER BY StartCounter desc) RowRank
		FROM [CTL].[ControlManifest]
		WHERE SourceObject in (
			--Check for matching records in the Configuration Table ControlCuratedConfig
			SELECT SourceName
			FROM CTL.ControlCuratedConfig Config
			INNER JOIN CTL.ControlSource Source ON Source.SourceLocation = Config.DependentTableName
			WHERE Config.SubjectArea =  @SubjectArea
			AND Config.Project =  @Project
			AND Config.Valid = 1
			AND ProcessedToTrustedZone = 1
		)
	), LastLoadedTime AS (
		--Take only the latest load for each table
		SELECT 
			SourceObject
			,StartCounter
			,EndCounter
		FROM AllList
		WHERE RowRank IN (1)
	)
	SELECT
		--Get the minimum of each Start Date as Processing Start Time. Default to midnight time
		@StartDate = CONVERT(DATETIME, CONVERT(DATE, (MIN(StartCounter))))
		--Get current datetime at midnight as the Processing End Time
		,@EndDate = CONVERT(DATETIME, CAST(SYSDATETIMEOFFSET() AT TIME ZONE 'AUS Eastern Standard Time' AS date))
		--*
	FROM LastLoadedTime
END
ELSE
BEGIN
	--If there are no configuration then set the default dates
	SET @StartDate = '2000-01-01 00:00:00'
	SET @EndDate = '9999-12-31 00:00:00'
END


SELECT @StartDate AS ProcessingStartDate, @EndDate AS ProcessingEndDate]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedConfig]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedConfig].[SubjectArea]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CuratedGetProcessingPeriod].[@SubjectArea]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedConfig].[Project]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CuratedGetProcessingPeriod].[@Project]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[StartCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[EndCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedConfig].[DependentTableName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedConfig].[SubjectArea]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedConfig].[Project]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedConfig].[Valid]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[ProcessedToTrustedZone]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[date]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[date]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[CuratedGetProcessingPeriod].[CTE1].[AllList]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[CuratedGetProcessingPeriod].[CTE1].[AllList].[SourceObject]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[SourceObject]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[CuratedGetProcessingPeriod].[CTE1].[AllList].[StartCounter]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[StartCounter]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[CuratedGetProcessingPeriod].[CTE1].[AllList].[EndCounter]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[EndCounter]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[CuratedGetProcessingPeriod].[CTE1].[AllList].[RowRank]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[CuratedGetProcessingPeriod].[CTE1].[LastLoadedTime]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[CuratedGetProcessingPeriod].[CTE1].[LastLoadedTime].[SourceObject]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[SourceObject]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[CuratedGetProcessingPeriod].[CTE1].[LastLoadedTime].[StartCounter]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[StartCounter]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[CuratedGetProcessingPeriod].[CTE1].[LastLoadedTime].[EndCounter]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[EndCounter]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CuratedGetProcessingPeriod].[@SubjectArea]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CuratedGetProcessingPeriod].[@Project]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2021" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [CTL].[CuratedGetProcessingPeriod] (&#xD;&#xA;&#x9;@SubjectArea varchar(255),&#xD;&#xA;&#x9;@Project varchar(255)&#xD;&#xA;&#x9;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[CuratedLogComplete]">
			<Property Name="BodyScript">
				<Value><![CDATA[


UPDATE CTL.ControlCuratedManifest
SET LoadStatus = 'COMPLETE',
EndTimeStamp = [CTL].[udf_GetDateLocalTZ]()
WHERE BatchExecutionLogID = @BatchExecutionLogID
	AND TaskExecutionLogID = @TaskExecutionLogID
	AND LoadStatus = 'STARTED']]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[LoadStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[EndTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetDateLocalTZ]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CuratedLogComplete].[@BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[TaskExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CuratedLogComplete].[@TaskExecutionLogID]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CuratedLogComplete].[@BatchExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CuratedLogComplete].[@TaskExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="352" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE [CTL].[CuratedLogComplete] (&#xD;&#xA;&#x9;@BatchExecutionLogID bigint,&#xD;&#xA;&#x9;@TaskExecutionLogID bigint)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[CuratedLogStart]">
			<Property Name="BodyScript">
				<Value><![CDATA[

--Reset the previous status to Terminated if they were unfinished
UPDATE CTL.ControlCuratedManifest
SET LoadStatus = 'TERMINATED'
WHERE SubjectArea = @SubjectArea
	AND Project = @Project
	AND LoadStatus = 'STARTED'

--Create new log entry on the Manifest table
INSERT INTO CTL.ControlCuratedManifest (
	BatchExecutionLogID
	,TaskExecutionLogID
	,SubjectArea
	,Project
	,StartPeriod
	,EndPeriod
	,LoadStatus
	,StartTimestamp
	,EndTimeStamp)
VALUES (
	@BatchExecutionLogID
	,@TaskExecutionLogID
	,@SubjectArea
	,@Project
	,@StartPeriod
	,@EndPeriod
	,'STARTED'
	,[CTL].[udf_GetDateLocalTZ]()
	,NULL)]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[LoadStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[SubjectArea]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CuratedLogStart].[@SubjectArea]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[Project]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CuratedLogStart].[@Project]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[TaskExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[StartPeriod]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[EndPeriod]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[StartTimestamp]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest].[EndTimeStamp]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CuratedLogStart].[@BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CuratedLogStart].[@TaskExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CuratedLogStart].[@StartPeriod]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CuratedLogStart].[@EndPeriod]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetDateLocalTZ]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CuratedLogStart].[@BatchExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CuratedLogStart].[@TaskExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CuratedLogStart].[@SubjectArea]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CuratedLogStart].[@Project]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CuratedLogStart].[@StartPeriod]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[CuratedLogStart].[@EndPeriod]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="839" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE [CTL].[CuratedLogStart] (&#xD;&#xA;&#x9;@BatchExecutionLogID bigint,&#xD;&#xA;&#x9;@TaskExecutionLogID bigint,&#xD;&#xA;&#x9;@SubjectArea varchar(255),&#xD;&#xA;&#x9;@Project varchar(255),&#xD;&#xA;&#x9;@StartPeriod datetime,&#xD;&#xA;&#x9;@EndPeriod datetime)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[CTL].[CustomDataLoad]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[CustomDataLoad].[TableName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[CustomDataLoad].[ServiceName]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[CustomDataLoad].[StartDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[CustomDataLoad].[EndDate]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[CustomDataLoad].[ExtractionComplete]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[DeleteConfigTask]">
			<Property Name="BodyScript">
				<Value><![CDATA[

DECLARE @StageID int = 1

DECLARE @ProjectID bigint
DECLARE @TaskID bigint, @SourceID bigint, @TargetID bigint

WHILE @StageID <= 5
BEGIN
	SELECT @ProjectID = ProjectID FROM CTL.ControlProjects WHERE ProjectName = @ProjectName

	SELECT @TaskID = TaskId, @SourceID = SourceId, @TargetID = TargetId
	FROM CTL.ControlTasks T
	WHERE T.ProjectId = @ProjectID
	AND T.TaskName = @TaskName
	AND T.ControlStageId = @StageID

	PRINT @ProjectID
	PRINT @TaskID
	PRINT @SourceID
	PRINT @TargetID


	PRINT 'Deleting from ControlWatermark'
	DELETE FROM CTL.ControlWatermark
	WHERE ControlSourceId = @SourceID

	PRINT 'Deleting from TaskExecutionLog'
	DELETE FROM CTL.TaskExecutionLog
	WHERE ControlTaskId = @TaskID

	PRINT 'Deleting from ControlTaskCommand'
	DELETE FROM CTL.ControlTaskCommand
	WHERE ControlTaskId = @TaskID

	PRINT 'Deleting from ControlWatermark'
	DELETE FROM CTL.ControlWatermark
	WHERE ControlSourceId = @TaskID

	PRINT 'Deleting from ControlTasks'
	DELETE FROM CTL.ControlTasks
	WHERE TaskId = @TaskID

	PRINT 'Deleting from ControlSource'
	DELETE FROM CTL.ControlSource
	WHERE SourceId = @SourceId

	PRINT 'Deleting from ControlTarget'
	DELETE FROM CTL.ControlTarget
	WHERE TargetId = @TargetID


	PRINT 'Deleting from ControlManifest'
	DELETE FROM CTL.ControlManifest
	WHERE SourceObject = @TaskName

	SET @StageID = @StageID + 1

END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bigint]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[DeleteConfigTask].[@ProjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[DeleteConfigTask].[@TaskName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[DeleteConfigTask].[@ProjectName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[DeleteConfigTask].[@TaskName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="4" />
				<Property Name="Length" Value="1509" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;CREATE PROCEDURE [CTL].[DeleteConfigTask] (&#xD;&#xA;&#x9;@ProjectName varchar(255),&#xD;&#xA;&#x9;@TaskName varchar(255))&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[DeleteProjectConfig]">
			<Property Name="BodyScript">
				<Value><![CDATA[

Delete From [CTL].[ControlTaskCommand]
where ControlTaskId in (select TaskId from CTL.ControlTasks where ProjectId = @projectId)

DELETE FROM CTL.ControlManifest
WHERE TaskExecutionLogID IN (
	SELECT ExecutionLogID
	FROM CTL.TaskExecutionLog TEL
	LEFT JOIN CTL.ControlTasks CT ON TEL.ControlTaskId = CT.TaskId
	AND ProjectId = @projectId
)

Delete From [CTL].[TaskExecutionLog]
where ControlTaskId in (select TaskId from CTL.ControlTasks where ProjectId = @projectId)

Delete From [CTL].[BatchExecutionLog]
Where ProjectID = @projectId


Drop table if exists #tempSource
Select distinct SourceId 
Into #tempSource
From CTL.ControlSource
where SourceId in (select SourceId from CTL.ControlTasks Where ProjectId = @projectId)

Drop table if exists #tempTarget
Select distinct TargetId 
Into #tempTarget
From CTL.ControlTarget
where TargetId in (select TargetId from CTL.ControlTasks Where ProjectId = @projectId)

Delete From [CTL].[ControlWatermark]
where ControlSourceId in (select SourceId from #tempSource)

Delete From [CTL].[ControlTasks]
where SourceId in (select SourceId from #tempSource)
			
Delete From [CTL].[ControlSource]
where SourceId in (select SourceId from #tempSource)
			
Delete From [CTL].[ControlTarget]
where TargetId in (select TargetId from #tempTarget)

Drop table if exists #tempBatch
Drop table if exists #tempSource
Drop table if exists #tempTarget]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlTaskCommand]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[DeleteProjectConfig].[@projectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[TaskExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionLogId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[ProjectID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[DeleteProjectConfig].[#tempSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[DeleteProjectConfig].[#tempTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[DeleteProjectConfig].[#tempSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[DeleteProjectConfig].[#tempSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[DeleteProjectConfig].[#tempSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[DeleteProjectConfig].[#tempTarget].[TargetId]" />
				</Entry>
				<Entry />
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[DeleteProjectConfig].[#tempSource]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[DeleteProjectConfig].[#tempSource].[SourceId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlSource].[SourceId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[DeleteProjectConfig].[#tempTarget]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[DeleteProjectConfig].[#tempTarget].[TargetId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTarget].[TargetId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[DeleteProjectConfig].[@projectId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1487" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE     PROC [CTL].[DeleteProjectConfig]&#xD;&#xA;@projectId int&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[CTL].[FK_ControlSource_ControlTypes]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceTypeId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[CTL].[ControlTypes].[TypeId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[CTL].[ControlTypes]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="11" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[CTL].[FK_ControlTarget_ControlTypes]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetTypeId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[CTL].[ControlTypes].[TypeId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[CTL].[ControlTypes]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="15" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[CTL].[FK_ControlTargetColumns_ControlTarget]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[CTL].[ControlTargetColumns].[TargetId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTargetColumns]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="16" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[CTL].[FK_ControlTaskCommand_ControlTasks]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[ControlTaskId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTaskCommand]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="18" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[CTL].[FK_ControlTasks_ControlSource]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="21" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[CTL].[FK_ControlTasks_ControlStages]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[CTL].[ControlTasks].[ControlStageId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[CTL].[ControlStages].[ControlStageId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[CTL].[ControlStages]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="22" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[CTL].[FK_ControlTasks_ControlTarget]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[CTL].[ControlTasks].[TargetId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="23" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[CTL].[FK_ControlWatermark_ControlSource]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="27" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[CTL].[FK_TaskExecutionLog_BatchExecutionLog]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[BatchExecutionId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionLogId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[CTL].[BatchExecutionLog]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="28" />
		</Element>
		<Element Type="SqlForeignKeyConstraint" Name="[CTL].[FK_TaskExecutionLog_ControlTasks]">
			<Relationship Name="Columns">
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignColumns">
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
			</Relationship>
			<Relationship Name="ForeignTable">
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="29" />
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetAPIParams]">
			<Property Name="BodyScript">
				<Value><![CDATA[

BEGIN

	DECLARE @MappingInfo VARCHAR(MAX)
	IF EXISTS(SELECT 1 FROM CTL.ControlSource WHERE SourceID = @SourceId AND AdditionalProperty <> '')
	BEGIN

		DECLARE @Prop varchar(max)
		SELECT @Prop = AdditionalProperty FROM CTL.ControlSource WHERE SourceID = @SourceId

		DECLARE @CurrPos int, @NextPos int

		SET @CurrPos = 0
		SET @NextPos = CHARINDEX('|', @Prop, @CurrPos+1)
		DECLARE @Cols varchar(MAX) = SUBSTRING(@Prop, @CurrPos+1, @NextPos - @CurrPos - 1)

		SET @CurrPos = @NextPos
		SET @NextPos = CHARINDEX('|', @Prop, @CurrPos+1)
		DECLARE @CollectionFilter varchar(100) = SUBSTRING(@Prop, @CurrPos+1, @NextPos - @CurrPos - 1)

		/*********Get Mapping Information ***************/
		IF @Cols != ''
		BEGIN
			DECLARE @json_construct varchar(MAX) = '{"type": "TabularTranslator", "mappings": {X}, "collectionReference": "{CollectionFilter}"}';
			DECLARE @json VARCHAR(MAX);
    
			SET @json = (
				SELECT
					c.[value] AS 'source.path', 
					c.[value] AS 'sink.path' 
				FROM (select value from string_split(@cols, ',')) as c
			FOR JSON PATH );
 
			SET @MappingInfo = REPLACE(REPLACE(@json_construct,'{X}', @json),'{CollectionFilter}', @CollectionFilter) 
		END
	END

	SELECT @MappingInfo AS MappingInfo
END

--[CTL].[GetAPIParams] 622]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetAPIParams].[@SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[AdditionalProperty]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[AdditionalProperty]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry />
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetAPIParams].[@SourceId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1352" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [CTL].[GetAPIParams] (@SourceId BigInt)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetComplianceProcessingStartDate]">
			<Property Name="BodyScript">
				<Value><![CDATA[

WITH AllList AS (
SELECT  [SourceObject]
      ,[StartCounter]
	  ,[EndCounter]
	  ,ROW_NUMBER() over (PARTITION BY SourceObject ORDER BY StartCounter desc) RID
  FROM [CTL].[ControlManifest]
  WHERE SourceObject in (
	SELECT SourceName
	FROM CTL.ControlComplianceDependency Compliance
	INNER JOIN CTL.ControlSource Source ON Source.SourceLocation = Compliance.TableName
	)
), LastLoadedTime AS (
	SELECT 
		SourceObject
		,StartCounter
		,EndCounter
	FROM AllList
	WHERE RID IN (1)
)
SELECT
	MIN(StartCounter) AS ProcessingStartTimeStamp, CONVERT(DATE, (MIN(StartCounter))) ProcessingStartDate
	--*
FROM LastLoadedTime]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[StartCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[EndCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlComplianceDependency]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlComplianceDependency].[TableName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[date]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[GetComplianceProcessingStartDate].[CTE1].[AllList]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetComplianceProcessingStartDate].[CTE1].[AllList].[SourceObject]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[SourceObject]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetComplianceProcessingStartDate].[CTE1].[AllList].[StartCounter]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[StartCounter]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetComplianceProcessingStartDate].[CTE1].[AllList].[EndCounter]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[EndCounter]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetComplianceProcessingStartDate].[CTE1].[AllList].[RID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[GetComplianceProcessingStartDate].[CTE1].[LastLoadedTime]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetComplianceProcessingStartDate].[CTE1].[LastLoadedTime].[SourceObject]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[SourceObject]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetComplianceProcessingStartDate].[CTE1].[LastLoadedTime].[StartCounter]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[StartCounter]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetComplianceProcessingStartDate].[CTE1].[LastLoadedTime].[EndCounter]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlManifest].[EndCounter]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="702" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE CTL.GetComplianceProcessingStartDate&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[GetDeltaSQL]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSourceColumns]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSourceColumns].[SourceTableId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetDeltaSQL].[@TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSourceColumns].[SourceTableId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSourceColumns].[ColumnQuery]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSourceColumns].[ColumnName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceSQL]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[Watermarks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[CTL].[GetDeltaSQL].[@Columns].[SourceSQL]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetDeltaSQL].[@Watermakrs].[Watermark]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[GetDeltaSQL].[@Columns]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[CTL].[GetDeltaSQL].[@Columns].[ColumnName]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="255" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[CTL].[GetDeltaSQL].[@Columns].[SourceSQL]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="2000" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[GetDeltaSQL].[@Watermakrs]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[CTL].[GetDeltaSQL].[@Watermakrs].[Watermark]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="255" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
BEGIN
Declare @SQL Varchar(Max) = 'Select * ',
		@TableName Varchar(255) = ' From ',
		@Where Varchar(2000) = ' Where '

Declare @Columns Table
(
  ColumnName Varchar(255),
  SourceSQL Varchar(2000)
)

Declare @Watermakrs Table
(
  Watermark Varchar(255)
)

If (Select Count(*)
      From [CTL].[ControlSourceColumns] col
        Join [CTL].[ControlSource] cs
          On col.SourceTableId = cs.SourceId
        Join [CTL].[ControlTasks] ct
          On cs.SourceId = ct.SourceId
     Where ct.TaskId = @TaskId) = 0
  BEGIN
    Select @SQL = 'Select * '
  END
Else
  BEGIN
    Select @SQL = 'Select '
    Select @SQL = @SQL + Case When Len(col.ColumnQuery) = 0 then col.ColumnName else col.ColumnQuery end + ', '
      From [CTL].[ControlSourceColumns] col
        Join [CTL].[ControlSource] cs
          On col.SourceTableId = cs.SourceId
        Join [CTL].ControlTasks ct
          On cs.SourceId = ct.SourceId
     Where ct.TaskId = @TaskId
    Select @SQL = Left(@SQL, Len(@SQL) - 1)
  END

	Select @TableName = @TableName + (Select SourceLocation From CTL.ControlSource cs Join CTL.ControlTasks ct ON cs.SourceId = ct.SourceId  Where ct.TaskId = @TaskId)

	Insert Into @Columns
		Select m.SourceColumn, m.SourceSQL
			From [CTL].[ControlWatermark] m
				Join [CTL].[ControlSource] cs
				On m.ControlSourceId = cs.SourceId
			Join [CTL].[ControlTasks] ct
				On cs.SourceId = ct.SourceId
			Where ct.TaskId = @TaskId

	Insert Into @Watermakrs
	Select value
	  From string_split((
					Select m.Watermarks
					  From [CTL].[ControlWatermark] m
					    Join [CTL].[ControlSource] cs
						  On m.ControlSourceId = cs.SourceId
						Join [CTL].[ControlTasks] ct
						  On cs.SourceId = ct.SourceId
					 Where ct.TaskId = @TaskId), '|')

	While (Select Count(*) From @Columns) > 0
	  BEGIN
		--Updated by Rahul Agrawal on 28-Jan-2020. Updated the condition to > from >=. The >= operator loads the last watermark data over and over.
		Select @Where = @Where  + (Select Top 1 SourceSQL From @Columns) + ' > ''' + (Select Top 1 Watermark From @Watermakrs) + ''' AND '
		Delete Top(1) From @Columns
		Delete Top(1) From @Watermakrs
	  END

	Select @Where = LEFT(@Where, Len(@Where) - 4)

	Select @SQL = @SQL + @TableName + @Where

	Return @SQL 
END]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="2405" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [CTL].[GetDeltaSQL] (@TaskId BigInt)&#xD;&#xA;Returns Varchar(MAX)&#xD;&#xA;AS" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetDeltaSQL].[@TaskId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="IsMax" Value="True" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[varchar]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetExecutionStages]">
			<Property Name="BodyScript">
				<Value><![CDATA[

SELECT DISTINCT 
	PS.ControlProjectId AS ProjectId, 
	PS.ControlStageId,
	S.StageName,
	S.StageSequence
FROM CTL.ControlProjectSchedule PS
INNER JOIN CTL.ControlStages S ON PS.ControlStageID = S.ControlStageId
AND PS.ControlProjectId = @ProjectID
AND PS.TriggerName = @TriggerName
AND EXISTS (SELECT 1 FROM CTL.ControlTasks T WHERE T.ProjectId = PS.ControlProjectId AND T.ControlStageId = S.ControlStageId)
ORDER BY S.StageSequence]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlStageID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetExecutionStages].[@ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[TriggerName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetExecutionStages].[@TriggerName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlStageID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[StageName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[StageSequence]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetExecutionStages].[@ProjectId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetExecutionStages].[@TriggerName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="44" />
				<Property Name="Length" Value="586" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;-- EXEC [CTL].[getExecutionStages] 1&#xD;&#xA;&#xD;&#xA;CREATE Proc [CTL].[GetExecutionStages] (&#xD;&#xA;&#x9;@ProjectId BigInt,&#xD;&#xA;&#x9;@TriggerName VARCHAR(100)&#xD;&#xA;&#x9;)&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetExecutionTasks]">
			<Property Name="BodyScript">
				<Value><![CDATA[

With allTasks as
(
Select 
	styp.ControlType SourceType, 
	src.SourceServer, 
	src.SourceName, 
	src.SourceLocation, 
	src.AdditionalProperty,
	src.Processor, 
	src.IsAuditTable,
	ISNULL(Audit.SourceName, '') AS SoftDeleteSource,
	p.ProjectName,
	p.ProjectId,
	ttyp.ControlType TargetType, 
	targ.TargetName, 
	targ.TargetLocation, 
	targ.TargetServer, 
--	targ.Compressed,
    ct.DataLoadMode, 
	DLT.DeltaExtract,
	DLT.CDCSource,
	DLT.TruncateTarget,
	DLT.UpsertTarget,
	CT.TrackChanges,
	CT.LoadToSqlEDW,
	ct.TaskName, 
	ct.ControlStageId, 
	--cps.CronExpression,  
	ct.TaskId, 
	cs.StageSequence, 
	cs.StageName, 
	src.SourceId, 
	ct.TargetId,
	ct.ObjectGrain, 
	ctc.CommandTypeId, 
	CW.Watermarks,
	FORMAT(TRY_CONVERT(DATETIME, CW.Watermarks), 'yyyy-MM-ddTHH:mm:ss') WatermarksDT,
	ISNULL(CW.SourceColumn, '') AS WatermarkColumn,
	src.BusinessKeyColumn,
	Case 
	    When (ctc.CommandTypeId = 1 OR ctc.CommandTypeId = 6) AND DLT.DeltaExtract = 1
		Then CTL.[udf_GetDeltaSQL](ct.TaskId)
		Else ctc.Command
	End Command,
	CTL.[udf_GetLastLoadedFile](src.SourceName, src.SourceLocation) LastLoadedFile

  From CTL.ControlSource src
    Join CTL.ControlTypes styp On src.SourceTypeId = styp.TypeId
    Join CTL.ControlTasks ct On src.SourceId = ct.SourceId
	Join CTL.ControlTaskCommand ctc On ct.TaskId = ctc.ControlTaskId
	Join CTL.ControlStages cs On ct.ControlStageId = cs.ControlStageId
	Join CTL.ControlTarget targ On ct.TargetId = targ.TargetId
	Join CTL.ControlTypes ttyp On targ.TargetTypeId = ttyp.TypeId
	LEFT JOIN CTL.ControlProjects P ON ct.ProjectId = p.ProjectId
	--join [CTL].[ControlProjectSchedule] cps on ct.ProjectId = cps.ControlProjectId
	LEFT JOIN CTL.ControlWatermark CW ON SRC.SourceId = CW.ControlSourceId
	LEFT JOIN CTL.ControlDataLoadTypes DLT ON CT.DataLoadMode = DLT.DataLoadType
	LEFT JOIN CTL.ControlSource Audit ON ISNULL(src.SoftDeleteSource, '') = Audit.SourceLocation AND Audit.IsAuditTable = 1
	LEFT JOIN CTL.TaskExecutionLog tel On ct.TaskId = tel.ControlTaskId
		   And tel.StartTime = (Select Max(StartTime) From CTL.TaskExecutionLog Where ControlTaskId = ct.TaskId)
 Where ct.TaskEnabled = 1
   And ct.ControlStageId = @StageId
   And ct.ProjectId = @ProjectId
),
lastFullExecutions As
(
Select ct.TaskId, Max(tel.EndTime) LastExecutionDate
  From CTL.ControlSource src
    Join CTL.ControlTasks ct On src.SourceId = ct.SourceId 
	Join CTL.TaskExecutionLog tel On ct.TaskId = tel.ControlTaskId
 Where ct.TaskEnabled = 1
   And ct.ControlStageId = @StageId  
   And ct.ProjectId = @ProjectId
   And tel.ExecutionStatus In ('Success', 'Failure', 'Terminated')
 Group By ct.TaskId
),
noExecutions As
(
Select ct.TaskId
  From CTL.ControlSource src
    Join CTL.ControlTasks ct On src.SourceId = ct.SourceId
	Left Join CTL.TaskExecutionLog tel On ct.TaskId = tel.ControlTaskId
 Where ct.TaskEnabled = 1
   And ct.ControlStageId = @StageId
   And ct.ProjectId = @ProjectId
   And tel.ControlTaskId Is Null
)

Select *
  From allTasks t
 Where (TaskId In (Select TaskId From noExecutions)
   Or t.TaskId In (Select ct.TaskId 
                   From CTL.ControlTasks ct
				     Join lastFullExecutions ex
					   On ct.TaskId = ex.TaskId))
				  --Where (Case 
				  --        When ct.RunFrequencyTypeId = 1 and DATEDIFF(Hour,ex.lastExecutionDate, getdate()) > 24 --Daily
						--    then 1
						--  When ct.RunFrequencyTypeId = 2 and DATEDIFF(Hour, ex.lastExecutionDate, getdate()) > 1 --Hourly
						--    then 1
						--  When ct.RunFrequencyTypeId = 3 and DATEDIFF(day, ex.lastExecutionDate, getdate()) > 7 --Annualy
						--    then 1
						--  Else 0
						--End) = 1))
 Order BY t.StageSequence, t.TaskId]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[TypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[TypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadTypes]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[DataLoadMode]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadTypes].[DataLoadType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SoftDeleteSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[IsAuditTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[StartTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[StartTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[ControlType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceServer]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[AdditionalProperty]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[Processor]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[IsAuditTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[ControlType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetServer]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[DataLoadMode]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadTypes].[DeltaExtract]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadTypes].[CDCSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadTypes].[TruncateTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadTypes].[UpsertTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TrackChanges]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[LoadToSqlEDW]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[StageSequence]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[StageName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ObjectGrain]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[CommandTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[Watermarks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[BusinessKeyColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetDeltaSQL]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[Command]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetLastLoadedFile]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskEnabled]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetExecutionTasks].[@StageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetExecutionTasks].[@ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[EndTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskEnabled]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[StageSequence]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[SourceType]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTypes].[ControlType]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[SourceServer]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlSource].[SourceServer]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[SourceName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlSource].[SourceName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[SourceLocation]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlSource].[SourceLocation]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[AdditionalProperty]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlSource].[AdditionalProperty]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[Processor]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlSource].[Processor]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[IsAuditTable]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlSource].[IsAuditTable]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[SoftDeleteSource]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[ProjectName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlProjects].[ProjectName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[ProjectId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlProjects].[ProjectId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[TargetType]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTypes].[ControlType]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[TargetName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTarget].[TargetName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[TargetLocation]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTarget].[TargetLocation]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[TargetServer]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTarget].[TargetServer]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[DataLoadMode]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTasks].[DataLoadMode]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[DeltaExtract]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlDataLoadTypes].[DeltaExtract]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[CDCSource]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlDataLoadTypes].[CDCSource]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[TruncateTarget]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlDataLoadTypes].[TruncateTarget]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[UpsertTarget]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlDataLoadTypes].[UpsertTarget]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[TrackChanges]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTasks].[TrackChanges]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[LoadToSqlEDW]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTasks].[LoadToSqlEDW]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[TaskName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTasks].[TaskName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[ControlStageId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTasks].[ControlStageId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[TaskId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTasks].[TaskId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[StageSequence]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlStages].[StageSequence]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[StageName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlStages].[StageName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[SourceId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlSource].[SourceId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[TargetId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTasks].[TargetId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[ObjectGrain]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTasks].[ObjectGrain]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[CommandTypeId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTaskCommand].[CommandTypeId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[Watermarks]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlWatermark].[Watermarks]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[WatermarksDT]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[WatermarkColumn]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[BusinessKeyColumn]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlSource].[BusinessKeyColumn]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[Command]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[allTasks].[LastLoadedFile]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[udf_GetLastLoadedFile]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[GetExecutionTasks].[CTE1].[lastFullExecutions]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[lastFullExecutions].[TaskId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTasks].[TaskId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[lastFullExecutions].[LastExecutionDate]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[GetExecutionTasks].[CTE1].[noExecutions]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetExecutionTasks].[CTE1].[noExecutions].[TaskId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlTasks].[TaskId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetExecutionTasks].[@StageId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetExecutionTasks].[@ProjectId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="45" />
				<Property Name="Length" Value="3882" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;--[CTL].[getExecutionTasks] 1,1&#xD;&#xA;&#xD;&#xA;CREATE Procedure [CTL].[GetExecutionTasks] (@StageId BigInt, @ProjectId BigInt)&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[getLastLoadedFile]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[EndTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[EndTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[getLastLoadedFile].[@SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[getLastLoadedFile].[@SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[TaskOutput]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[TaskOutput]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
BEGIN
	Declare @File Varchar(255) = ''
	Select @File = (
		select a.TaskOutput from (
			Select l.TaskOutput, TargetName, TargetLocation, row_number()over(order by l.TaskOutput desc) RowNum
			  From CTL.ControlTarget targ
				Join CTL.ControlTasks t
				  On targ.TargetId = t.TargetId
				Join CTL.TaskExecutionLog l
				  On t.TaskId = l.ControlTaskId
				 And l.ExecutionStatus = 'Success'
				 And l.EndTime = (Select Max(EndTime)
									From CTL.TaskExecutionLog
								   Where ControlTaskId = t.TaskId)
				And targ.TargetName = @SourceName
	            And targ.TargetLocation = @SourceLocation
			)a where a.RowNum = 1)
	   --And a.TargetName = @SourceName
	   --And a.TargetLocation = @SourceLocation)

	Return @File
END]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="881" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE Function [CTL].[getLastLoadedFile] (@SourceName Varchar(255), @SourceLocation Varchar(255))&#xD;&#xA;Returns Varchar(255)&#xD;&#xA;As" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[getLastLoadedFile].[@SourceName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[getLastLoadedFile].[@SourceLocation]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="Length" Value="255" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[varchar]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetManifestAudit]">
			<Property Name="BodyScript">
				<Value><![CDATA[

	SELECT
	ISNULL(MIN(StartCounter),0) AS StartCounter, 
	ISNULL(MAX(EndCounter), 0) AS EndCounter, 
	ISNULL(MAX(DeltaColumn), '''') AS DeltaColumn, 
	ISNULL(COUNT(BatchExecutionLogID), 0) AS Batches 
	FROM CTL.ControlManifest
	WHERE SourceObject = @SourceObject
	AND RecordCountLoaded > 0 
	AND ProcessedToTrustedZone IS NULL 
	AND RecordCountDeltaTable IS NOT NULL]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[StartCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[EndCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[DeltaColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetManifestAudit].[@SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[RecordCountLoaded]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[ProcessedToTrustedZone]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[RecordCountDeltaTable]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetManifestAudit].[@SourceObject]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="458" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE [CTL].[GetManifestAudit] (&#xD;&#xA;&#x9;@SourceObject varchar(100)&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetManifestRecords]">
			<Property Name="BodyScript">
				<Value><![CDATA[
SELECT [BatchExecutionLogID]
      ,TaskExecutionLogID
      ,[SourceObject]
      ,[Container]
      ,[StartCounter]
      ,[EndCounter]
      ,RecordCountLoaded
      ,[FolderName]
      ,[FileName]
  FROM [CTL].[ControlManifest]
  WHERE BatchExecutionLogID = @BatchID]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[TaskExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[Container]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[StartCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[EndCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[RecordCountLoaded]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[FolderName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[FileName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetManifestRecords].[@BatchID]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetManifestRecords].[@BatchID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="349" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [CTL].[GetManifestRecords] (&#xD;&#xA;@BatchID bigint)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetManifestSQLEDW]">
			<Property Name="BodyScript">
				<Value><![CDATA[

	--Get the Audit Table for Main Table
	DECLARE @AuditTable VARCHAR(100)
	SELECT @AuditTable = A.SourceName
	FROM CTL.ControlSource S 
	LEFT JOIN CTL.ControlSource A ON S.SoftDeleteSource = A.SourceLocation
	WHERE S.SourceName = @SourceObject

	--If there is no Audit Table defined then use the same table as default
	IF @AuditTable IS NULL OR @AuditTable = ''
		SET @AuditTable = @SourceObject

	SELECT
	ISNULL(MIN(StartCounter),0) AS StartCounter, 
	ISNULL(MAX(EndCounter), 0) AS EndCounter, 
	ISNULL(MAX(DeltaColumn), '''') AS DeltaColumn, 
	ISNULL(COUNT(BatchExecutionLogID), 0) AS Batches 
	FROM CTL.ControlManifest
	WHERE 1 = 1
	AND (SourceObject = @SourceObject OR SourceObject = @AuditTable) --Check the Manifest logs for both the main and Audit table
	AND ProcessedToSQLEDW IS NULL 
	AND ProcessedToTrustedZone IS NOT NULL]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SoftDeleteSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetManifestSQLEDW].[@SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[StartCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[EndCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[DeltaColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[ProcessedToSQLEDW]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[ProcessedToTrustedZone]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetManifestSQLEDW].[@SourceObject]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="936" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE [CTL].[GetManifestSQLEDW] (&#xD;&#xA;&#x9;@SourceObject varchar(100)&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetManifestTrusted]">
			<Property Name="BodyScript">
				<Value><![CDATA[
	SELECT
	*
	FROM CTL.ControlManifest
	WHERE SourceObject = @SourceObject
	AND RecordCountLoaded > 0 
	AND ProcessedToTrustedZone IS NULL 
	AND RecordCountDeltaTable IS NOT NULL 
	ORDER BY StartCounter]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetManifestTrusted].[@SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[RecordCountLoaded]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[ProcessedToTrustedZone]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[RecordCountDeltaTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[StartCounter]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetManifestTrusted].[@SourceObject]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="288" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE CTL.GetManifestTrusted (&#xD;&#xA;&#x9;@SourceObject varchar(100)&#xD;&#xA;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetProjects]">
			<Property Name="BodyScript">
				<Value><![CDATA[

--Get List of ProjectID for which Triggers have been configured
SELECT DISTINCT 
	P.ProjectId
	,P.ProjectName
FROM CTL.ControlProjectSchedule S
INNER JOIN CTL.ControlProjects P ON S.ControlProjectId = P.ProjectId
AND P.Enabled = 1
AND S.TriggerName = @TriggerName

/*
SELECT ProjectId as ControlProjectID, ProjectName
FROM CTL.ControlProjects
WHERE Enabled = 1
AND TriggerName = @TriggerName
*/]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[Enabled]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[TriggerName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetProjects].[@TriggerName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectName]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetProjects].[@TriggerName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="485" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [CTL].[GetProjects] (&#xD;&#xA;&#x9;@TriggerName varchar(100)&#xD;&#xA;)&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetProjectSchedule]">
			<Property Name="BodyScript">
				<Value><![CDATA[

With times as
(
Select p.ProjectName, ps.*, 
	   [CTL].[fn_getWAustDateTime](getdate()) CurrentTime,
       [CTL].[udf_CronToDatetime](ps.CronExpression) ExecutionTime
  From [CTL].[ControlProjects] p
    Join [CTL].[ControlProjectSchedule] ps
      On p.ProjectId = ps.ControlProjectId
 Where p.Enabled = 1
)

Select t.ControlProjectId, t.ProjectName, format(t.ExecutionTime, 'HH:mm:ss')
  From times t
 Where Case When CurrentTime >= ExecutionTime And CurrentTime <= DATEADD(MI, 10, ExecutionTime)
         Then 1
         Else 0
       End = 1]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlProjects]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[CronExpression]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[Enabled]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule].[ControlProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[GetProjectSchedule].[CTE1].[times]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetProjectSchedule].[CTE1].[times].[ProjectName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlProjects].[ProjectName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetProjectSchedule].[CTE1].[times].[ControlTaskScheduleId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlProjectSchedule].[ControlTaskScheduleId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetProjectSchedule].[CTE1].[times].[ControlProjectId]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlProjectSchedule].[ControlProjectId]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetProjectSchedule].[CTE1].[times].[CronExpression]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlProjectSchedule].[CronExpression]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetProjectSchedule].[CTE1].[times].[ControlStageID]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlProjectSchedule].[ControlStageID]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetProjectSchedule].[CTE1].[times].[TriggerName]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[ControlProjectSchedule].[TriggerName]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetProjectSchedule].[CTE1].[times].[CurrentTime]">
									<Relationship Name="ExpressionDependencies">
										<Entry />
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[GetProjectSchedule].[CTE1].[times].[ExecutionTime]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[udf_CronToDatetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="613" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [CTL].[GetProjectSchedule]&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetStageTableSQL]">
			<Property Name="BodyScript">
				<Value><![CDATA[
  Declare @Output table (command varchar(max))
  Declare @SQL varchar(max) = ''


  BEGIN
    If (Select Count(*)
          From CTL.ControlTarget ct
            Join CTL.ControlTargetColumns ctc
              On ct.TargetId = ctc.TargetId
         Where ct.TargetId = @TargetId) = 0
      BEGIN
        RAISERROR('Target table definition is not available.',16,1)
      END
    Else
      BEGIN
        Insert into @Output
        Select 'Exec (''DROP TABLE IF EXISTS ' + ct.TargetLocation + '.' + ct.TargetName + char(10) + char(13) + char(10) + char(13) + ''') Select 1'
          From CTL.ControlTarget ct
         Where ct.TargetId = @TargetId

        Select @SQL = 'Exec(''CREATE TABLE ' + ct.TargetLocation + '.' + ct.TargetName + ' ( '
          From CTL.ControlTarget ct
         Where ct.TargetId = @TargetId

        Select @SQL = @SQL + ColumnName + '  ' + DataType + Case When ctc.MaxLength = -1 then '(MAX)' 
                  When ctc.MaxLength = 0 then '' else '(' + Convert(varchar, ctc.MaxLength) + case when ctc.Precision = 0 then ')' else ', ' + convert(varchar, ctc.Precision) + ')' end end + ', '
          From CTL.ControlTargetColumns ctc
         Where ctc.TargetId = @TargetId
         
        Select @SQL = LEFT(@SQL, LEN(@SQL) - 1) + ' )'')' + char(10) + char(13) + char(10) + char(13) + ' Select 1'

        Insert into @Output Values (@SQL)

        Select * From @Output

      END

  END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTargetColumns]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTargetColumns].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetStageTableSQL].[@TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTargetColumns].[ColumnName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTargetColumns].[DataType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTargetColumns].[MaxLength]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTargetColumns].[Precision]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTargetColumns].[TargetId]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[GetStageTableSQL].[@Output]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[CTL].[GetStageTableSQL].[@Output].[command]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="IsMax" Value="True" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetStageTableSQL].[@TargetId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1523" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE Procedure [CTL].[GetStageTableSQL] (@TargetId BigInt)&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetStorageFileName]">
			<Property Name="BodyScript">
				<Value><![CDATA[
begin
	
	set @FolderName = LOWER(@FolderName)
	declare @DataType varchar(10)

	IF @TargetType = 'BLOB Storage (csv)' SET @DataType = 'csv'
	ELSE IF @TargetType = 'BLOB Storage (json)' SET @DataType = 'json'
	ELSE IF @TargetType = 'BLOB Storage (parquet)' SET @DataType = 'parquet'
	ELSE SET @DataType = 'csv'

	declare @blobfoldername varchar(1000)
	set @blobfoldername = @FolderName + '/' + @DataType + '/' + [CTL].[udf_GetFileDateHierarchy](@Grain) + '/'

	declare @blobfilename varchar(1000)
	IF @DeltaExtract = 1
	BEGIN
		set @blobfilename = @FileName + '_' + format([CTL].[udf_GetDateLocalTZ](),N'yyyy-MM-dd_HHmmss_fff') + '.' + @DataType
	END
	ELSE
	BEGIN
		set @blobfilename = @FileName + '_' + format([CTL].[udf_GetDateLocalTZ](),N'yyyy-MM-dd') + '.' + @DataType
		--Sometimes when the file with the same name is overwritten, Databricks does not read any record
		--Trying to check if having a unique name helps
		set @blobfilename = @FileName + '_' + format([CTL].[udf_GetDateLocalTZ](),N'yyyy-MM-dd_HHmmss_fff') + '.' + @DataType
	END

	IF @Compressed = 1 SET @blobfilename = @blobfilename + '.gz'


	SELECT @blobfoldername AS StorageFolder, @blobfilename AS StorageFile

end]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetStorageFileName].[@FolderName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetStorageFileName].[@TargetType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetFileDateHierarchy]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetStorageFileName].[@Grain]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetStorageFileName].[@DeltaExtract]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetStorageFileName].[@FileName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetDateLocalTZ]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetStorageFileName].[@Compressed]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetStorageFileName].[@FolderName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetStorageFileName].[@FileName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetStorageFileName].[@Grain]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="30" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetStorageFileName].[@DeltaExtract]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetStorageFileName].[@TargetType]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetStorageFileName].[@Compressed]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA[1]]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bit]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="1410" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE proc [CTL].[GetStorageFileName] (&#xD;&#xA;&#x9;@FolderName varchar(255)&#xD;&#xA;&#x9;,@FileName varchar(255)&#xD;&#xA;&#x9;,@Grain varchar(30)&#xD;&#xA;&#x9;,@DeltaExtract bit&#xD;&#xA;&#x9;,@TargetType varchar(255)&#xD;&#xA;&#x9;,@Compressed bit = 1)&#xD;&#xA;as" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetTableDetails]">
			<Property Name="BodyScript">
				<Value><![CDATA[

BEGIN

--DECLARE @SourceId BIGINT = 1008
--DECLARE @ValidationType varchar(10) = 'TARGET'

DECLARE @SQL Varchar(2000) = 'SELECT ',
		@TableName Varchar(255) = ' FROM '


DECLARE @DataLoadMode varchar(100)
DECLARE @SourceType varchar(100)
DECLARE @SourceTable varchar(100)
DECLARE @SourceColumn varchar(100)
DECLARE @ValidationColumn varchar(100)
DECLARE @SourceName varchar(100)
DECLARE @NULLFunction varchar(100), @DATEFunction varchar(100), @DATEFormat varchar(100)


SELECT 
	@DataLoadMode = CT.DataLoadMode 
	,@SourceType = T.ControlType
	,@SourceTable = CS.SourceLocation
	,@SourceColumn = W.SourceColumn
	,@ValidationColumn = CS.ValidationColumn
	,@SourceName = CS.SourceName
FROM CTL.ControlTasks CT 
LEFT JOIN CTL.ControlSource CS ON CT.SourceId = CS.SourceId
LEFT JOIN CTL.ControlTypes T ON CS.SourceTypeId = T.TypeId
LEFT JOIN CTL.ControlWatermark W ON W.ControlSourceId = CS.SourceId
WHERE CS.SourceId = @SourceId

SET @NULLFunction = 'ISNULL'
SET @DATEFunction = 'FORMAT'
SET @DATEFormat = '''yyyy-MM-dd HH:mm:ss'''


IF @ValidationType = 'SOURCE'
BEGIN
	IF @SourceType = 'Oracle'
	BEGIN
		SET @NULLFunction = 'NVL'
		SET @DATEFunction = 'TO_CHAR'
		SET @DATEFormat = '''YYYY-MM-DD HH24:MI:SS'''
	END
END




IF @DataLoadMode = 'CDC'
	BEGIN
		SELECT @SQL = 'SELECT ''UPPER([__$start_lsn])'' AS SourceColumn, upper(sys.fn_varbintohexstr(sys.fn_cdc_get_max_lsn())) AS ReturnValue, sys.fn_cdc_map_lsn_to_time(sys.fn_cdc_get_max_lsn()) AS ReturnTime'
	END
ELSE
	BEGIN
		SET @TableName = @TableName + @SourceTable
		DECLARE @COL varchar(100)
		SET @COL = [CTL].[udf_GetMultiColFilterClause](@SourceColumn, @SourceColumn)
		SET @COL = [CTL].[udf_GetMultiColFilterClause](@COL, @SourceType)

		SET @SQL = @SQL + '''' + @COL + ''' As SourceColumn'
		SET @SQL = @SQL + ', ' + @DATEFunction + '(MAX(' + @COL + '), ' + @DATEFormat + ') As ReturnValue'

		SET @SQL = @SQL + ', COUNT(1) AS RecordCount'

		IF @ValidationColumn <> ''
		BEGIN
			SET @SQL = @SQL + ', SUM(' + @NULLFunction + '(' + @ValidationColumn + ',0)) AS TotalValue'
			SET @SQL = @SQL + ', MAX(' + @NULLFunction + '(' + @ValidationColumn + ',0)) AS MaxValue'
			SET @SQL = @SQL + ', MIN(' + @NULLFunction + '(' + @ValidationColumn + ',0)) AS MinValue'
		END
		ELSE
		BEGIN
			SET @SQL = @SQL + ', 0 AS TotalValue'
			SET @SQL = @SQL + ', 0 AS MaxValue'
			SET @SQL = @SQL + ', 0 AS MinValue'
		END

		SET @SQL = @SQL + ', ''' + @ValidationType + ''' AS ValidationType'

		IF UPPER(@ValidationType) = 'SOURCE'
			SET @SQL = @SQL + @TableName
		ELSE
		BEGIN
			SET @SQL = @SQL + ' FROM ' + 'edw.' + @SourceName + ' WHERE _RecordCurrent = 1 AND _RecordDeleted = 0'
		END


	END

SELECT @SQL SQLStatement

END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[TypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[DataLoadMode]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[ControlType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[ValidationColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetTableDetails].[@SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetTableDetails].[@ValidationType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColFilterClause]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetTableDetails].[@SourceId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetTableDetails].[@ValidationType]">
						<Property Name="DefaultExpressionScript">
							<Value><![CDATA['SOURCE']]></Value>
						</Property>
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2880" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE Procedure [CTL].[GetTableDetails] (&#xD;&#xA;&#x9;@SourceId BigInt&#xD;&#xA;&#x9;,@ValidationType varchar(10) = 'SOURCE'&#xD;&#xA;)&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[GetWatemarkSQL]">
			<Property Name="BodyScript">
				<Value><![CDATA[

BEGIN
Declare @SQL Varchar(2000) = 'SELECT ',
		@TableName Varchar(255) = ' FROM '


DECLARE @DataLoadMode varchar(100)
DECLARE @SourceType varchar(100)
SELECT 
	@DataLoadMode = CT.DataLoadMode 
	,@SourceType = T.ControlType
FROM CTL.ControlTasks CT 
LEFT JOIN CTL.ControlSource CS ON CT.SourceId = CS.SourceId
LEFT JOIN CTL.ControlTypes T ON CS.SourceTypeId = T.TypeId
WHERE CS.SourceId = @SourceId

IF @DataLoadMode = 'CDC'
	BEGIN
		SELECT @SQL = 'SELECT ''UPPER([__$start_lsn])'' AS SourceColumn, upper(sys.fn_varbintohexstr(sys.fn_cdc_get_max_lsn())) AS ReturnValue, sys.fn_cdc_map_lsn_to_time(sys.fn_cdc_get_max_lsn()) AS ReturnTime'
	END
ELSE
	BEGIN
		Select @TableName = @TableName + (Select SourceLocation From CTL.ControlSource Where SourceId = @SourceId)
	
		Declare @Columns Table
		(
		  ColumnName Varchar(255),
		  SourceSQL Varchar(2000)
		)

		Insert Into @Columns
			Select m.SourceColumn, m.SourceSQL
				From CTL.ControlWatermark m
				Where ControlSourceId = @SourceId

		While (Select Count(*) From @Columns) > 0
		  BEGIN

			--Check if the Watermark column contains any comma, meaning there may be more than one column in it
			--If so, use the COALESCE, NVL style functions to get values
			DECLARE @COL varchar(100)
			SET @COL = (Select Top 1 ColumnName From @Columns)
			SET @COL = [CTL].[udf_GetMultiColFilterClause](@COL, @SourceType)

			--Updated by Rahul Agrawal on 28-Jan-2020. Updated the condition to > from >=. The >= operator loads the last watermark data over and over.
			IF @SourceType = 'Oracle'
				Select @SQL = @SQL + ' ''' + @COL + ''' As SourceColumn,  TO_CHAR(MAX(' + @COL + '), ''YYYY-MM-DD HH24:MI:SS'') As ReturnValue, '
			ELSE
				--Select @SQL = @SQL + ' ''' + @COL + ''' As SourceColumn,  FORMAT(MAX(' + @COL + '), ''yyyy-MM-dd hh:mm:ss'') As ReturnValue, '
				--Select @SQL = @SQL + ' ''' + @COL + ''' As SourceColumn,  MAX(' + @COL + ') As ReturnValue, '
				Select @SQL = @SQL + ' ''' + @COL + ''' As SourceColumn,  FORMAT(MAX(' + @COL + '), ''yyyy-MM-dd HH:mm:ss'') As ReturnValue, '

--			Select @SQL = @SQL + ' ''' + (Select Top 1 ColumnName From @Columns) + ''' As SourceColumn,  MAX(' + @UpdateCol + ') As ReturnValue, '
--			Delete Top(1) From @Columns

			Delete Top(1) From @Columns
		  END

		Select @SQL = LEFT(@SQL, Len(@SQL) - 1)

		Select @SQL = @SQL + @TableName

	END


Select @SQL SQLStatement

END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[TypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[DataLoadMode]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[ControlType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetWatemarkSQL].[@SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceSQL]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[GetWatemarkSQL].[@Columns].[ColumnName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColFilterClause]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[GetWatemarkSQL].[@Columns]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[CTL].[GetWatemarkSQL].[@Columns].[ColumnName]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="255" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[CTL].[GetWatemarkSQL].[@Columns].[SourceSQL]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="2000" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[GetWatemarkSQL].[@SourceId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="2502" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE Procedure [CTL].[GetWatemarkSQL] @SourceId BigInt&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_BatchExecutionLog]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[BatchExecutionLog].[BatchExecutionLogId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[BatchExecutionLog]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="3" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlCuratedConfig]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlCuratedConfig].[SubjectArea]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlCuratedConfig].[Project]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlCuratedConfig].[DependentTableName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlCuratedConfig]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="4" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlCuratedManifest]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlCuratedManifest].[BatchExecutionLogID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlCuratedManifest].[TaskExecutionLogID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlCuratedManifest]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="5" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlDataLoadTypes]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlDataLoadTypes].[DataLoadTypeID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlDataLoadTypes]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="6" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlProjects]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlProjects].[ProjectId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlProjects]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="8" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlProjectSchedule]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlProjectSchedule].[ControlTaskScheduleId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlProjectSchedule]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="9" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlSource]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlSource].[SourceId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="10" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlSourceColumns]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlSourceColumns].[ControlSourceColumnId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlSourceColumns]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="12" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlStages]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlStages].[ControlStageId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlStages]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="13" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlTarget]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlTarget].[TargetId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="14" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlTargetColumns]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlTargetColumns].[ControlTargetColumnId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTargetColumns]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="17" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlTaskCommand]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlTaskCommand].[CommandId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTaskCommand]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="19" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlTasks]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlTasks].[TaskId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="20" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlTypes]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlTypes].[TypeId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTypes]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="25" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_ControlWatermark]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlWatermark].[WatermarkId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="26" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_CTL_ControlManifest]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlManifest].[BatchExecutionLogID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlManifest].[TaskExecutionLogID]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="7" />
		</Element>
		<Element Type="SqlPrimaryKeyConstraint" Name="[CTL].[PK_TaskExecutionLog]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[TaskExecutionLog].[ExecutionLogId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
			</Relationship>
			<Annotation Type="SqlInlineConstraintAnnotation" Disambiguator="30" />
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[RecordDataValidation]">
			<Property Name="BodyScript">
				<Value><![CDATA[

IF UPPER(@ValidationType) = 'SOURCE'
BEGIN

	INSERT INTO CTL.ControlDataLoadValidation (
		ProjectRunID
		,ObjectName
		,SourceHighWatermark
		,SourceRecordCount
		,SourceTotalValue
		,SourceMinValue
		,SourceMaxValue)
	VALUES (
		@ProjectRunID
		,@ObjectName
		,@HighWatermark
		,@RecordCount
		,@TotalValue
		,@MinValue
		,@MaxValue)

END
ELSE
BEGIN
	UPDATE CTL.ControlDataLoadValidation
	SET TargetHighWatermark = @HighWatermark
	,TargetRecordCount = @RecordCount
	,TargetTotalValue = @TotalValue
	,TargetMinValue = @MinValue 
	,TargetMaxValue = @MaxValue

	WHERE ProjectRunID = @ProjectRunID
	AND ObjectName = @ObjectName

END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[RecordDataValidation].[@ValidationType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[ProjectRunID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[ObjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[SourceHighWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[SourceRecordCount]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[SourceTotalValue]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[SourceMinValue]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[SourceMaxValue]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[RecordDataValidation].[@ProjectRunID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[RecordDataValidation].[@ObjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[RecordDataValidation].[@HighWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[RecordDataValidation].[@RecordCount]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[RecordDataValidation].[@TotalValue]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[RecordDataValidation].[@MinValue]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[RecordDataValidation].[@MaxValue]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[TargetHighWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[TargetRecordCount]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[TargetTotalValue]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[TargetMinValue]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlDataLoadValidation].[TargetMaxValue]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[RecordDataValidation].[@ProjectRunID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[RecordDataValidation].[@ObjectName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[RecordDataValidation].[@ValidationType]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="10" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[RecordDataValidation].[@HighWatermark]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[RecordDataValidation].[@RecordCount]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[RecordDataValidation].[@TotalValue]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[RecordDataValidation].[@MinValue]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[RecordDataValidation].[@MaxValue]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="924" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE [CTL].[RecordDataValidation] (&#xD;&#xA;&#x9;@ProjectRunID varchar(50),&#xD;&#xA;&#x9;@ObjectName varchar(255),&#xD;&#xA;&#x9;@ValidationType varchar(10),&#xD;&#xA;&#x9;@HighWatermark varchar(100),&#xD;&#xA;&#x9;@RecordCount bigint,&#xD;&#xA;&#x9;@TotalValue bigint,&#xD;&#xA;&#x9;@MinValue bigint,&#xD;&#xA;&#x9;@MaxValue bigint)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[ResetLogs]">
			<Property Name="BodyScript">
				<Value><![CDATA[

UPDATE ctl.TaskExecutionLog 
SET ExecutionStatus = 'Terminated'
WHERE ExecutionStatus = 'In Progress' AND BatchExecutionId IN 
	(select BatchExecutionLogID from ctl.BatchExecutionLog where ProjectID = @ProjectID)

UPDATE CTL.BatchExecutionLog 
SET BatchExecutionStatus = 'Terminated'
WHERE BatchExecutionStatus = 'In Progress' AND ProjectID = @ProjectID

/*
delete from ctl.TaskExecutionLog where BatchExecutionId IN (select BatchExecutionLogID from ctl.BatchExecutionLog where BatchExecutionStatus = 'In Progress')
delete from ctl.BatchExecutionLog where BatchExecutionStatus = 'In Progress'
delete from ctl.TaskExecutionLog where ExecutionStatus = 'In Progress'

*/]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[BatchExecutionId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionLogId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[ProjectID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ResetLogs].[@ProjectID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[ProjectID]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[ResetLogs].[@ProjectID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[int]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="742" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE PROCEDURE [CTL].[ResetLogs] (@ProjectID INT)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[sp_getFullName]">
			<Property Name="BodyScript">
				<Value><![CDATA[
begin
	select @fileName + '/' + [CTL].[udf_getFileDateHierarchy](@Grain) + '/' + @fileName + '.csv.gz' FileName
end]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[sp_getFullName].[@fileName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetFileDateHierarchy]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[sp_getFullName].[@Grain]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[sp_getFullName].[@fileName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[sp_getFullName].[@Grain]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="30" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="202" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE proc [CTL].[sp_getFullName] (@fileName varchar(255), @Grain varchar(30))&#xD;&#xA;as" />
			</Annotation>
		</Element>
		<Element Type="SqlTable" Name="[CTL].[TaskExecutionLog]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[TaskExecutionLog].[ExecutionLogId]">
						<Property Name="IsNullable" Value="False" />
						<Property Name="IsIdentity" Value="True" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[TaskExecutionLog].[BatchExecutionId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[TaskExecutionLog].[ControlTaskId]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[TaskExecutionLog].[StartTime]">
						<Property Name="IsNullable" Value="False" />
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[TaskExecutionLog].[EndTime]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[TaskExecutionLog].[ExecutionStatus]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[TaskExecutionLog].[ErrorMessage]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="2000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSimpleColumn" Name="[CTL].[TaskExecutionLog].[TaskOutput]">
						<Relationship Name="TypeSpecifier">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="2000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="28" />
			<AttachedAnnotation Disambiguator="29" />
			<AttachedAnnotation Disambiguator="30" />
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_CronToDatetime]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime].[@CRONExp]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[ItemNumber]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[Item]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[Item]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[ItemNumber]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[1]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[2]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[3]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[4]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[5]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[6]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[7]" />
				</Entry>
				<Entry />
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime2]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[udf_CronToDatetime].[PV1].[piv]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[1]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[2]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[3]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[4]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[5]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[6]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToDatetime].[PV1].[piv].[7]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[ 
begin
	return (
		select cast(concat(Year,'/',Month,'/',DayOfMonth,' ',Hours,':',Minutes,':',Seconds) as datetime2)
		from (
			select 
				--Account for * and numeric seconds
				case when isNumeric(seconds) = 1
					then RIGHT('0'+ISNULL(Seconds,''),2)
					when isNumeric(Seconds) = 0 and Seconds = '*'
					then format([CTL].[fn_getWAustDateTime](getdate ()), 'ss')
					--Add for /
				end Seconds,
				case when isNumeric(Minutes) = 1
					then RIGHT('0'+ISNULL(Minutes,''),2)
					when isNumeric(Minutes) = 0 and Minutes = '*'
					then format([CTL].[fn_getWAustDateTime](getdate ()), 'mm')
					--Add for - /
				end Minutes,
				case when isNumeric(Hours) = 1
					then RIGHT('0'+ISNULL(Hours,''),2)
					when isNumeric(Hours) = 0 and Hours = '*'
					then format([CTL].[fn_getWAustDateTime](getdate ()), 'HH')
					--Add for - /
				end Hours,
				case when isNumeric(DayOfMonth) = 1
					then RIGHT('0'+ISNULL(DayOfMonth,''),2)
					when isNumeric(DayOfMonth) = 0 and DayOfMonth = '*'
					then datepart(dd,[CTL].[fn_getWAustDateTime](getdate ()))
					--Add for , - ? / L W
				end DayOfMonth,
				case when isNumeric(Month) = 1
					then RIGHT('0'+ISNULL(Month,''),2)
					when isNumeric(Month) = 0 and Month = '*'
					then datepart(mm,[CTL].[fn_getWAustDateTime](getdate ()))
					--Add for , - /
				end Month,
				case when isNumeric(DayOfWeek) = 1
					then RIGHT('0'+ISNULL(DayOfWeek,''),2)
					when isNumeric(DayOfWeek) = 0 and DayOfWeek = '*'
					then datepart(dw,[CTL].[fn_getWAustDateTime](getdate ()))
					--Add for , - /
				end DayOfWeek,
				case when isNumeric(Year) = 1
					then RIGHT('0'+ISNULL(Year,''),2)
					when isNumeric(Year) = 0 and (Year = '*' or Year is null) 
					then datepart(yyyy,[CTL].[fn_getWAustDateTime](getdate ()))
					--Add for , - /
				end Year
			from (
				select [1] Seconds , [2] Minutes , [3] Hours , [4] DayOfMonth, [5] Month, [6] DayOfWeek, [7] Year
				from (
						SELECT ItemNumber, Item
						FROM [CTL].[udf_DelimitedSplit8K](@CRONExp, ' ') 
					)a
					PIVOT
				(
					MAX(Item)
					FOR ItemNumber IN
						([1], [2], [3], [4], [5], [6], [7])
				) piv
			)a
		)b
	)
end]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="2298" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [CTL].[udf_CronToDatetime](@CRONExp varchar(50))&#xD;&#xA;returns datetime2&#xD;&#xA;as" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_CronToDatetime].[@CRONExp]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="Scale" Value="7" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[datetime2]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_CronToFrequency]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[udf_CronToFrequency].[@CRONExp]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[ItemNumber]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[Item]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[Item]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[ItemNumber]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[1]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[2]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[3]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[4]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[5]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[6]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[7]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_CronToDatetime]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[udf_CronToFrequency].[PV1].[piv]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[1]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[2]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[3]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[4]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[5]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[6]" />
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_CronToFrequency].[PV1].[piv].[7]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[ 
begin
	return (
		select RunFrequency
		from (
			select 
				--Hierarchy for yyyy/
				case when seconds <> '*' 
					and Minutes <> '*' 
					and Hours <> '*' 
					and DayOfMonth <> '*' 
					and Month <> '*' 
					then format([CTL].[udf_CronToDatetime](@CRONExp), 'yyyy/') + 
						format([CTL].[udf_CronToDatetime](@CRONExp), 'MM/')
				--Hierarchy for yyyy/MM/
				when seconds <> '*'
					and Minutes <> '*'
					and Hours <> '*'
					and DayOfMonth <> '*'
					and isnumeric(Month) = 1
					then format([CTL].[udf_CronToDatetime](@CRONExp), 'yyyy/') + 
						format([CTL].[udf_CronToDatetime](@CRONExp), 'MM/')
				--Hierarchy for yyyy/MM/dd/
				when seconds <> '*'
					and Minutes <> '*'
					and Hours <> '*'
					and isnumeric(DayOfMonth) = 1
					and Month = '*'
					then format([CTL].[udf_CronToDatetime](@CRONExp), 'yyyy/') + 
						format([CTL].[udf_CronToDatetime](@CRONExp), 'MM/') +
						format([CTL].[udf_CronToDatetime](@CRONExp), 'dd/')
				--Hierarchy for yyyy/MM/dd/HH
				when seconds <> '*'
					and Minutes <> '*'
					and isnumeric(Hours) = 1
					and DayOfMonth = '*'
					and Month = '*'
					then format([CTL].[udf_CronToDatetime](@CRONExp), 'yyyy/') + 
						format([CTL].[udf_CronToDatetime](@CRONExp), 'MM/') +
						format([CTL].[udf_CronToDatetime](@CRONExp), 'dd/') +
						format([CTL].[udf_CronToDatetime](@CRONExp), 'HH/')
				--Hierarchy for yyyy/MM/dd/HH/mm
				when seconds <> '*'
					and isnumeric(Minutes) = 1
					and Hours = '*'
					and DayOfMonth = '*'
					and Month = '*'
					then format([CTL].[udf_CronToDatetime](@CRONExp), 'yyyy/') + 
						format([CTL].[udf_CronToDatetime](@CRONExp), 'MM/') +
						format([CTL].[udf_CronToDatetime](@CRONExp), 'dd/') +
						format([CTL].[udf_CronToDatetime](@CRONExp), 'HH/') +
						format([CTL].[udf_CronToDatetime](@CRONExp), 'mm/') 
				--Hierarchy for yyyy/MM/dd/HH/mm/ss
				when isnumeric(seconds) = 1
					and Minutes = '*'
					and Hours = '*'
					and DayOfMonth = '*'
					and Month = '*'
					then format([CTL].[udf_CronToDatetime](@CRONExp), 'yyyy/') + 
						format([CTL].[udf_CronToDatetime](@CRONExp), 'MM/') +
						format([CTL].[udf_CronToDatetime](@CRONExp), 'dd/') +
						format([CTL].[udf_CronToDatetime](@CRONExp), 'HH/') +
						format([CTL].[udf_CronToDatetime](@CRONExp), 'mm/') +
						format([CTL].[udf_CronToDatetime](@CRONExp), 'ss/') 
				end RunFrequency
			from (
				select [1] Seconds , [2] Minutes , [3] Hours , [4] DayOfMonth, [5] Month, [6] DayOfWeek, [7] Year
				from (
						SELECT ItemNumber, Item
						FROM [CTL].[udf_DelimitedSplit8K](@CRONExp, ' ') 
					)a
					PIVOT
				(
					MAX(Item)
					FOR ItemNumber IN
						([1], [2], [3], [4], [5], [6], [7])
				) piv
			)a
		)b
	)
end]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="2896" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [CTL].[udf_CronToFrequency](@CRONExp varchar(50))&#xD;&#xA;returns varchar(50)&#xD;&#xA;as" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_CronToFrequency].[@CRONExp]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="Length" Value="50" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[varchar]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlInlineTableValuedFunction" Name="[CTL].[udf_DelimitedSplit8K]">
			<Property Name="IsSchemaBound" Value="True" />
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[@pString]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteTally].[N]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[@pDelimiter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteStart].[N1]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteLen].[N1]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteLen].[L1]" />
				</Entry>
			</Relationship>
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[udf_DelimitedSplit8K].[ItemNumber]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[udf_DelimitedSplit8K].[Item]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[E1]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[E1].[N]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[E2]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[E2].[N]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[E4]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[E4].[N]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteTally]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteTally].[N]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteStart]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteStart].[N1]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteLen]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteLen].[N1]">
									<Relationship Name="ExpressionDependencies">
										<Entry>
											<References Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteStart].[N1]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlComputedColumn" Name="[CTL].[udf_DelimitedSplit8K].[CTE1].[cteLen].[L1]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
--===== "Inline" CTE Driven "Tally Table" produces values from 1 up to 10,000...
     -- enough to cover VARCHAR(8000)
  WITH E1(N) AS (
                 SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL
                 SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL
                 SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1
                ),                          --10E+1 or 10 rows
       E2(N) AS (SELECT 1 FROM E1 a, E1 b), --10E+2 or 100 rows
       E4(N) AS (SELECT 1 FROM E2 a, E2 b), --10E+4 or 10,000 rows max
 cteTally(N) AS (--==== This provides the "base" CTE and limits the number of rows right up front
                     -- for both a performance gain and prevention of accidental "overruns"
                 SELECT TOP (ISNULL(DATALENGTH(@pString),0)) ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) FROM E4
                ),
cteStart(N1) AS (--==== This returns N+1 (starting position of each "element" just once for each delimiter)
                 SELECT 1 UNION ALL
                 SELECT t.N+1 FROM cteTally t WHERE SUBSTRING(@pString,t.N,1) = @pDelimiter
                ),
cteLen(N1,L1) AS(--==== Return start and length (for use in substring)
                 SELECT s.N1,
                        ISNULL(NULLIF(CHARINDEX(@pDelimiter,@pString,s.N1),0)-s.N1,8000)
                   FROM cteStart s
                )
--===== Do the actual split. The ISNULL/NULLIF combo handles the length for the final element when no delimiter is found.
 SELECT ItemNumber = ROW_NUMBER() OVER(ORDER BY l.N1),
        Item       = SUBSTRING(@pString, l.N1, l.L1)
   FROM cteLen l
]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="1910" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [CTL].[udf_DelimitedSplit8K]&#xD;&#xA;--===== Define I/O parameters&#xD;&#xA;        (@pString VARCHAR(8000), @pDelimiter CHAR(1))&#xD;&#xA;--WARNING!!! DO NOT USE MAX DATA-TYPES HERE!  IT WILL KILL PERFORMANCE!&#xD;&#xA;RETURNS TABLE WITH SCHEMABINDING AS&#xD;&#xA; RETURN" />
							<Property Name="FooterContents" Value=";" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_DelimitedSplit8K].[@pString]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="8000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_DelimitedSplit8K].[@pDelimiter]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[char]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_GetDateLocalTZ]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
begin
     DECLARE @DT AS datetimeoffset

     SET @DT = CONVERT(datetimeoffset, GETDATE()) AT TIME ZONE 'AUS Eastern Standard Time'

     RETURN CONVERT(datetime, @DT);

end]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="249" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [CTL].[udf_GetDateLocalTZ]()&#xD;&#xA;returns DATETIME&#xD;&#xA;as" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[datetime]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_GetDeltaSQL]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bit]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[bit]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[TypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[DataLoadMode]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[ControlType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[IsAuditTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[UseAuditTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SoftDeleteSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[Command]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[Watermarks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[BusinessKeyColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetDeltaSQL].[@TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[Command]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColTableJoinClause]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColSelectList]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColFilterClause]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
/************************************************************
The function builds the initial SQL for Source Extraction
The function is called from the SP [CTL].[GetExecutionTasks] while building initial TaskDetails

************************************************************/

BEGIN
	Declare @SQL Varchar(Max) = 'SELECT * ',
			@TableName Varchar(255) = '',
			@WHERE Varchar(2000) = ' WHERE 1 = 1 '

	DECLARE @DataLoadMode varchar(100)
	DECLARE @SourceType varchar(100)
	DECLARE @IsAuditTable bit, @UseAuditTable bit
	DECLARE @TaskName varchar(100)
	DECLARE @AuditTable varchar(100)
	DECLARE @SQLCommand varchar(max)
	DECLARE @WaterMarkCol varchar(100), @WatermarkVal varchar(40)
	DECLARE @BusinessKey varchar(100)

	--This keyword will be inserted in the current delta sql and will be replaced with endvalue in ADF
	DECLARE @EndDateKey varchar(100) = '<<ENDDATE>>'

	--Get values from table
	SELECT 
		@DataLoadMode = CT.DataLoadMode 
		,@SourceType = T.ControlType
		,@TableName = CS.SourceLocation
		,@IsAuditTable = CS.IsAuditTable
		,@UseAuditTable = CS.UseAuditTable
		,@TaskName = CT.TaskName
		,@AuditTable = CS.SoftDeleteSource
		,@SQLCommand = CTC.Command
		,@WaterMarkCol = WM.SourceColumn
		,@WatermarkVal = WM.Watermarks
		,@BusinessKey = CS.BusinessKeyColumn
	FROM CTL.ControlTasks CT 
	LEFT JOIN CTL.ControlSource CS ON CT.SourceId = CS.SourceId
	LEFT JOIN CTL.ControlTypes T ON CS.SourceTypeId = T.TypeId
	LEFT JOIN CTL.ControlTaskCommand CTC ON CT.TaskId = CTC.ControlTaskId
	LEFT JOIN CTL.ControlWatermark WM ON CS.SourceId = WM.ControlSourceId
	WHERE CT.TaskId = @TaskId

	SET @SQLCommand = (SELECT Command FROM CTL.ControlTaskCommand WHERE ControlTaskId = @TaskId)

	--Beginning of filter condition build block

	/**********************************************************************/
	--Start of Special Audit Table Handling of OneEBS
	IF @UseAuditTable = 1 AND @AuditTable <> '' AND @TaskName LIKE 'OneEBS%'
	BEGIN
		DECLARE @ALIAS_MAIN varchar(50) = 'mn'
		DECLARE @ALIAS_AUDIT varchar(50) = 'aud'
		DECLARE @ALIAS_UPDATED_TRANS_DATE varchar(50) = '"_ONEEBS_UPDATED_TRANSACTION_DATE"' --Please ensure that this column name is used as in on DataBricks
		DECLARE @JOIN_CLAUSE VARCHAR(500), @WATERMARK_COLS VARCHAR(500)

		--Get the table join clause with columns aliased
		SET @JOIN_CLAUSE = [CTL].[udf_GetMultiColTableJoinClause](@BusinessKey, @ALIAS_MAIN, @ALIAS_AUDIT)

		--Get the SQL Column list with columns aliased
		SET @WATERMARK_COLS = [CTL].[udf_GetMultiColSelectList](@WaterMarkCol, @ALIAS_MAIN)


		SET @SQL = 'SELECT '
		SET @SQL = @SQL + @ALIAS_MAIN + '.*'
		SET @SQL = @SQL + ', COALESCE(' + @ALIAS_AUDIT + '.AUDIT__TIMESTAMP, ' + @WATERMARK_COLS + ') ' + @ALIAS_UPDATED_TRANS_DATE
		SET @SQL = @SQL + ' FROM ' + @TableName + ' ' + @ALIAS_MAIN
		SET @SQL = @SQL + ' LEFT JOIN ('
		SET @SQL = @SQL + ' SELECT ' + @BusinessKey + ', MAX(AUDIT__TIMESTAMP) AS AUDIT__TIMESTAMP'
		SET @SQL = @SQL + ' FROM ' + @AuditTable
		SET @SQL = @SQL + ' WHERE AUDIT__TIMESTAMP'
		SET @SQL = @SQL + ' BETWEEN TO_DATE(''' + @WatermarkVal + ''', ''YYYY-MM-DD HH24:MI:SS'') AND TO_DATE(''' + @EndDateKey + ''', ''YYYY-MM-DD HH24:MI:SS'')'
		SET @SQL = @SQL + ' GROUP BY ' + @BusinessKey
		SET @SQL = @SQL + ' ) ' + @ALIAS_AUDIT + ' ON ' + @JOIN_CLAUSE
		SET @SQL = @SQL + ' WHERE COALESCE(' + @ALIAS_AUDIT + '.AUDIT__TIMESTAMP, ' + @WATERMARK_COLS + ')'
		SET @SQL = @SQL + ' BETWEEN TO_DATE(''' + @WatermarkVal + ''', ''YYYY-MM-DD HH24:MI:SS'') AND TO_DATE(''' + @EndDateKey + ''', ''YYYY-MM-DD HH24:MI:SS'')'

		RETURN @SQL

	END
	--End of Special Audit Table Handling of OneEBS
	/**********************************************************************/

	--Start of normal incrmental block. This is needed to build the WHERE Clause for Source Extraction
	--The following section checks if the source type is CDC. Use a different block altogether for CDC
	IF @DataLoadMode = 'CDC'
	BEGIN
	
			SELECT @TableName = @TableName + '[CDC].[' + (Select SourceName 
				FROM CTL.ControlTasks CT
				INNER JOIN CTL.ControlSource CS ON CT.SourceId = CS.SourceId
				WHERE CT.TaskId = @TaskId) + '_ct]'

			SET @WHERE = @WHERE + ' UPPER([__$start_lsn]) > CONVERT(BINARY(10), ''' + @WatermarkVal + ''', 1) AND [__$operation] in (1, 2, 3, 4)'

	--End of CDC block
	END
	ELSE IF @DataLoadMode IN ('INCREMENTAL', 'APPEND')
	BEGIN
		--If it is Audit table and from OneEBS than update the source sql to include only deleted records
		IF @IsAuditTable = 1 AND @TaskName LIKE 'OneEBSAudit%'
		BEGIN
			SET @WHERE = @WHERE + ' AND AUDIT__OPERATION = ''D'' '
		END

		SET @WaterMarkCol = [CTL].[udf_GetMultiColFilterClause](@WaterMarkCol, @SourceType)
		IF @SourceType = 'Oracle'
			Select @WHERE = @WHERE  + ' AND ' + @WaterMarkCol + ' BETWEEN TO_DATE(''' + @WatermarkVal + ''', ''YYYY-MM-DD HH24:MI:SS'') AND TO_DATE(''' + @EndDateKey + ''', ''YYYY-MM-DD HH24:MI:SS'')'
		ELSE
			Select @WHERE = @WHERE  + ' AND ' + @WaterMarkCol + ' BETWEEN ''' + @WatermarkVal + ''' AND ''' + @EndDateKey + ''
	END
	ELSE
	BEGIN
		--If it is Full-Extract or Truncate-Load then we do not need the WHERE Clause
		SELECT @WHERE = ''
	END
	--End of normal incrmental block


	/**************FINAL SQL****************************/
	--If the Configuration defines the SQL Extraction Column use that, else use SELECT * to pick all columns from Source Table
	IF UPPER(LEFT(TRIM(@SQLCommand), 8)) = 'SELECT *'
		SET @SQL = @SQL + 'FROM ' + @TableName
	ELSE
		SET @SQL = @SQLCommand

	--Build the final SQL with the WHERE filter clause
	SET @SQL = @SQL + @WHERE

	--Return the SQL
	Return @SQL 
END]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="5791" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [CTL].[udf_GetDeltaSQL] (@TaskId BigInt)&#xD;&#xA;Returns Varchar(MAX)&#xD;&#xA;AS" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetDeltaSQL].[@TaskId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="IsMax" Value="True" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[varchar]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_GetEAustDateTime]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetEAustDateTime].[@d]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
begin
     DECLARE @DT AS datetimeoffset

     SET @DT = CONVERT(datetimeoffset, @d) AT TIME ZONE 'E. Australia Standard Time'

     RETURN CONVERT(datetime, @DT);

end]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="259" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [CTL].[udf_GetEAustDateTime](@d as datetime)&#xD;&#xA;returns DATETIME&#xD;&#xA;as" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetEAustDateTime].[@d]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[datetime]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_GetFileDateHierarchy]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[udf_GetFileDateHierarchy].[@Grain]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetDateLocalTZ]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
BEGIN

return
(
	select Case @Grain
				WHEN 'Day' then 
					concat(
						'year=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'yyyy'), '/',
						'month=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'MM'), '/',
						'day=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'dd')
					)
				WHEN 'Month' then 
					concat(
						'year=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'yyyy'), '/',
						'month=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'MM'), '/'
					)
				WHEN 'Year' then 
					concat(
						'year=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'yyyy'), '/'
					)
				WHEN 'Hour' then 
					concat(
						'year=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'yyyy'), '/',
						'month=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'MM'), '/',
						'day=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'dd'), '/',
						'hour=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'HH')
					)
				WHEN 'Minute' then 
					concat(
						'year=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'yyyy'), '/',
						'month=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'MM'), '/',
						'day=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'dd'), '/',
						'hour=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'HH'), '/',
						'minute=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'mm')
					)
				WHEN 'Second' then 
					concat(
						'year=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'yyyy'), '/',
						'month=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'MM'), '/',
						'day=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'dd'), '/',
						'hour=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'HH'), '/',
						'minute=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'mm'), '/',
						'second=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'ss')
					)
				ELSE 
					concat(
						'year=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'yyyy'), '/',
						'month=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'MM'), '/',
						'day=',FORMAT([CTL].[udf_GetDateLocalTZ](),N'dd')
					)
		   End
)


END]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="CreateOffset" Value="8" />
							<Property Name="Length" Value="1999" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;CREATE   FUNCTION [CTL].[udf_GetFileDateHierarchy] (@Grain varchar(20))&#xD;&#xA;RETURNS varchar(50)&#xD;&#xA;AS" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetFileDateHierarchy].[@Grain]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="20" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="Length" Value="50" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[varchar]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_GetLastLoadedFile]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[EndTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[EndTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetLastLoadedFile].[@SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetLastLoadedFile].[@SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[TaskOutput]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[TaskOutput]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
BEGIN
	Declare @File Varchar(255) = ''
	Select @File = (
		select a.TaskOutput from (
			Select l.TaskOutput, TargetName, TargetLocation, row_number()over(order by l.TaskOutput desc) RowNum
			  From CTL.ControlTarget targ
				Join CTL.ControlTasks t
				  On targ.TargetId = t.TargetId
				Join CTL.TaskExecutionLog l
				  On t.TaskId = l.ControlTaskId
				 And l.ExecutionStatus = 'Success'
				 And l.EndTime = (Select Max(EndTime)
									From CTL.TaskExecutionLog
								   Where ControlTaskId = t.TaskId)
				And targ.TargetName = @SourceName
	            And targ.TargetLocation = @SourceLocation
			)a where a.RowNum = 1)
	   --And a.TargetName = @SourceName
	   --And a.TargetLocation = @SourceLocation)

	Return @File
END]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="885" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE Function [CTL].[udf_GetLastLoadedFile] (@SourceName Varchar(255), @SourceLocation Varchar(255))&#xD;&#xA;Returns Varchar(255)&#xD;&#xA;As" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetLastLoadedFile].[@SourceName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetLastLoadedFile].[@SourceLocation]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="Length" Value="255" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[varchar]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_GetMultiColFilterClause]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColFilterClause].[@Column]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColFilterClause].[@SourceType]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
/**************************************************************
This function returns the filter condition for null handling of more than one column
**************************************************************/
BEGIN

DECLARE @COL VARCHAR(255)

IF CHARINDEX (',', @Column) > 0
BEGIN
	IF @SourceType = 'SQL Server'
		SET @COL = 'COALESCE (' + @Column + ')'
	ELSE IF @SourceType = 'Oracle'
		SET @COL = 'COALESCE (' + @Column + ')'
	ELSE
		SET @COL = @Column
END
ELSE
	SET @COL = @Column

RETURN @COL
END]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="659" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [CTL].[udf_GetMultiColFilterClause] (&#xD;&#xA;&#x9;@Column varchar(255),&#xD;&#xA;&#x9;@SourceType varchar(100)&#xD;&#xA;)&#xD;&#xA;Returns Varchar(MAX)&#xD;&#xA;AS" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetMultiColFilterClause].[@Column]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetMultiColFilterClause].[@SourceType]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="IsMax" Value="True" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[varchar]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_GetMultiColSelectList]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColSelectList].[@Column]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColSelectList].[@ColTable].[ColName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[CTL].[udf_GetMultiColSelectList].[@ColTable].[RowID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColSelectList].[@SourceAlias]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[udf_GetMultiColSelectList].[@ColTable]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[CTL].[udf_GetMultiColSelectList].[@ColTable].[ColName]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="100" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[CTL].[udf_GetMultiColSelectList].[@ColTable].[RowID]">
									<Property Name="IsNullable" Value="False" />
									<Property Name="IsIdentity" Value="True" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
/**************************************************************
This function returns the column list with the source alias for select list
**************************************************************/
BEGIN

	DECLARE @SQLClause VARCHAR(MAX) = ''

	IF CHARINDEX (',', @Column) > 0
	BEGIN
		--Temporary table to store the list of columns 	
		DECLARE @ColTable TABLE 
		(
			ColName varchar(100),
			RowID INT identity(1,1)
		)

		--Split the column list based on comma and store in the temporary table
		INSERT INTO @ColTable (ColName)
		SELECT VALUE FROM STRING_SPLIT(@Column, ',')

		DECLARE @TotalRows INT, @CurrentRow INT

		--Get the total number of rows
		SELECT @TotalRows = COUNT(1) FROM @ColTable

		--Initial Counter
		SET @CurrentRow = 1

		--Loop through all the records
		WHILE @CurrentRow <= @TotalRows
		BEGIN
			DECLARE @Row varchar(100), @CurrentCol varchar(100)
			SELECT @CurrentCol = ColName FROM @ColTable WHERE RowID = @CurrentRow
			SET @CurrentCol = TRIM(@CurrentCol)
			--Alias the columns
			SET @Row = @SourceAlias + '.' + @CurrentCol

			--Add the comma from the second part onwards
			IF @SQLClause = ''
				SET @SQLClause = @SQLClause + @Row
			ELSE
				SET @SQLClause = @SQLClause + ', ' + @Row

			--Increment the counter, so that we are not in infinite loop
			SET @CurrentRow = @CurrentRow + 1
		END
	END
	ELSE
	BEGIN
		--If there are no comma, it means there is only one column
		SET @SQLClause = @SourceAlias + '.' + @Column 
	END
	RETURN @SQLClause

END]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="1679" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [CTL].[udf_GetMultiColSelectList] (&#xD;&#xA;&#x9;@Column varchar(255),&#xD;&#xA;&#x9;@SourceAlias varchar(100)&#xD;&#xA;)&#xD;&#xA;RETURNS VARCHAR(MAX)&#xD;&#xA;AS" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetMultiColSelectList].[@Column]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetMultiColSelectList].[@SourceAlias]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="IsMax" Value="True" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[varchar]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_GetMultiColTableJoinClause]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[int]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColTableJoinClause].[@Column]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColTableJoinClause].[@ColTable].[ColName]" />
				</Entry>
				<Entry />
				<Entry>
					<References Name="[CTL].[udf_GetMultiColTableJoinClause].[@ColTable].[RowID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColTableJoinClause].[@SourceAlias]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetMultiColTableJoinClause].[@TargetAlias]" />
				</Entry>
			</Relationship>
			<Relationship Name="DynamicObjects">
				<Entry>
					<Element Type="SqlDynamicColumnSource" Name="[CTL].[udf_GetMultiColTableJoinClause].[@ColTable]">
						<Relationship Name="Columns">
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[CTL].[udf_GetMultiColTableJoinClause].[@ColTable].[ColName]">
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Property Name="Length" Value="100" />
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[varchar]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
							<Entry>
								<Element Type="SqlSimpleColumn" Name="[CTL].[udf_GetMultiColTableJoinClause].[@ColTable].[RowID]">
									<Property Name="IsNullable" Value="False" />
									<Property Name="IsIdentity" Value="True" />
									<Relationship Name="TypeSpecifier">
										<Entry>
											<Element Type="SqlTypeSpecifier">
												<Relationship Name="Type">
													<Entry>
														<References ExternalSource="BuiltIns" Name="[int]" />
													</Entry>
												</Relationship>
											</Element>
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
/**************************************************************
This function returns the column list with the source and target table alias for table join
**************************************************************/
BEGIN

	DECLARE @SQLClause VARCHAR(MAX) = ''

	IF CHARINDEX (',', @Column) > 0
	BEGIN
		--Temporary table to store the list of columns 	
		DECLARE @ColTable TABLE 
		(
			ColName varchar(100),
			RowID INT identity(1,1)
		)

		--Split the column list based on comma and store in the temporary table
		INSERT INTO @ColTable (ColName)
		SELECT VALUE FROM STRING_SPLIT(@Column, ',')

		DECLARE @TotalRows INT, @CurrentRow INT

		--Get the total number of rows
		SELECT @TotalRows = COUNT(1) FROM @ColTable

		--Initial Counter
		SET @CurrentRow = 1

		--Loop through all the records
		WHILE @CurrentRow <= @TotalRows
		BEGIN
			DECLARE @Row varchar(100), @CurrentCol varchar(100)
			SELECT @CurrentCol = ColName FROM @ColTable WHERE RowID = @CurrentRow
			SET @CurrentCol = TRIM(@CurrentCol)
			--Alias the columns
			SET @Row = @SourceAlias + '.' + @CurrentCol + ' = ' + @TargetAlias + '.' + @CurrentCol

			--Add the and clause from the second part onwards
			IF @SQLClause = ''
				SET @SQLClause = @SQLClause + @Row
			ELSE
				SET @SQLClause = @SQLClause + ' AND ' + @Row

			--Increment the counter, so that we are not in infinite loop
			SET @CurrentRow = @CurrentRow + 1
		END
	END
	ELSE
	BEGIN
		--If there are no comma, it means there is only one column
		SET @SQLClause = @SourceAlias + '.' + @Column + ' = ' + @TargetAlias + '.' + @Column
	END
	RETURN @SQLClause

END]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="1818" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION [CTL].[udf_GetMultiColTableJoinClause] (&#xD;&#xA;&#x9;@Column varchar(255),&#xD;&#xA;&#x9;@SourceAlias varchar(100),&#xD;&#xA;&#x9;@TargetAlias varchar(100)&#xD;&#xA;)&#xD;&#xA;RETURNS VARCHAR(MAX)&#xD;&#xA;AS" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetMultiColTableJoinClause].[@Column]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetMultiColTableJoinClause].[@SourceAlias]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetMultiColTableJoinClause].[@TargetAlias]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="100" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Property Name="IsMax" Value="True" />
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[varchar]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_GetNZDateTime]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetNZDateTime].[@d]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
begin
     DECLARE @DT AS datetimeoffset

     SET @DT = CONVERT(datetimeoffset, @d) AT TIME ZONE 'New Zealand Standard Time'

     RETURN CONVERT(datetime, @DT);

end]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="251" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION CTL.udf_GetNZDateTime(@d as datetime)&#xD;&#xA;returns DATETIME&#xD;&#xA;as" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetNZDateTime].[@d]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[datetime]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlScalarFunction" Name="[CTL].[udf_GetWAustDateTime]">
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetimeoffset]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetWAustDateTime].[@d]" />
				</Entry>
				<Entry>
					<References ExternalSource="BuiltIns" Name="[datetime]" />
				</Entry>
			</Relationship>
			<Relationship Name="FunctionBody">
				<Entry>
					<Element Type="SqlScriptFunctionImplementation">
						<Property Name="BodyScript">
							<Value><![CDATA[
begin
     DECLARE @DT AS datetimeoffset

     SET @DT = CONVERT(datetimeoffset, @d) AT TIME ZONE 'W. Australia Standard Time'

     RETURN CONVERT(datetime, @DT);

end]]></Value>
						</Property>
						<Annotation Type="SysCommentsObjectAnnotation">
							<Property Name="Length" Value="255" />
							<Property Name="StartLine" Value="1" />
							<Property Name="StartColumn" Value="1" />
							<Property Name="HeaderContents" Value="CREATE FUNCTION CTL.udf_GetWAustDateTime(@d as datetime)&#xD;&#xA;returns DATETIME&#xD;&#xA;as" />
						</Annotation>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[udf_GetWAustDateTime].[@d]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[datetime]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Relationship Name="Type">
				<Entry>
					<Element Type="SqlTypeSpecifier">
						<Relationship Name="Type">
							<Entry>
								<References ExternalSource="BuiltIns" Name="[datetime]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[UpdateBatchLog]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN

	If (Select Count(*) From CTL.BatchExecutionLog Where BatchExecutionLogId = @BatchLogId) = 0 
		BEGIN
			RAISERROR('Execution batch could not be located', 16, 1) 
		END
	Else
	  BEGIN
		Update CTL.BatchExecutionLog
		   Set EndDate = [CTL].[udf_GetDateLocalTZ](),
		       BatchExecutionStatus = @Status,
			   ErrorMessage = @ErrorMessage
		 Where BatchExecutionLogId = @BatchLogId
	  END

END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[BatchExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionLogId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateBatchLog].[@BatchLogId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[EndDate]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetDateLocalTZ]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateBatchLog].[@Status]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateBatchLog].[@ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionLogId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateBatchLog].[@BatchLogId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateBatchLog].[@Status]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateBatchLog].[@ErrorMessage]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="2000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="532" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE Procedure [CTL].[UpdateBatchLog] (@BatchLogId BigInt, @Status Varchar(50), @ErrorMessage Varchar(2000))&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[UpdateCustomDataLoad]">
			<Property Name="BodyScript">
				<Value><![CDATA[

UPDATE CTL.CustomDataLoad SET ExtractionComplete = 1
WHERE TableName = @TableName
AND StartDate = @StartDate]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[CustomDataLoad]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CustomDataLoad].[ExtractionComplete]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CustomDataLoad].[TableName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateCustomDataLoad].[@TableName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[CustomDataLoad].[StartDate]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateCustomDataLoad].[@StartDate]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateCustomDataLoad].[@TableName]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateCustomDataLoad].[@StartDate]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[date]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="205" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="create procedure CTL.UpdateCustomDataLoad (&#xD;&#xA;@TableName varchar(255),&#xD;&#xA;@StartDate date)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[UpdateManifestAudit]">
			<Property Name="BodyScript">
				<Value><![CDATA[

BEGIN
	IF @ProcessedToTrusted = '1'
		UPDATE CTL.ControlManifest SET 
		[ProcessedToTrustedZone] = 1
		,TrustedZonePipelineRunID = @PipelineRunID
		WHERE [ProcessedToTrustedZone] IS NULL
		AND BatchExecutionLogID <= @BatchExecutionLogID
		AND SourceObject = @SourceObject
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[UpdateManifestAudit].[@ProcessedToTrusted]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[ProcessedToTrustedZone]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[TrustedZonePipelineRunID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestAudit].[@PipelineRunID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestAudit].[@BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestAudit].[@SourceObject]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestAudit].[@BatchExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestAudit].[@SourceObject]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestAudit].[@ProcessedToTrusted]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[char]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestAudit].[@PipelineRunID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="459" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [CTL].[UpdateManifestAudit] (&#xD;&#xA;&#x9;@BatchExecutionLogID bigint,&#xD;&#xA;&#x9;@SourceObject varchar(255),&#xD;&#xA;&#x9;@ProcessedToTrusted char(1),&#xD;&#xA;&#x9;@PipelineRunID varchar(50))&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[UpdateManifestDeltaRecords]">
			<Property Name="BodyScript">
				<Value><![CDATA[

BEGIN
	UPDATE CTL.ControlManifest
	SET RecordCountDeltaTable = @RecordsDeltaTable
	WHERE BatchExecutionLogID = @BatchExecutionLogID
	AND TaskExecutionLogID = @TaskExecutionLogID
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[RecordCountDeltaTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestDeltaRecords].[@RecordsDeltaTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestDeltaRecords].[@BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[TaskExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestDeltaRecords].[@TaskExecutionLogID]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestDeltaRecords].[@BatchExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestDeltaRecords].[@TaskExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestDeltaRecords].[@RecordsDeltaTable]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="337" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [CTL].[UpdateManifestDeltaRecords] (&#xD;&#xA;&#x9;@BatchExecutionLogID bigint,&#xD;&#xA;&#x9;@TaskExecutionLogID bigint,&#xD;&#xA;&#x9;@RecordsDeltaTable bigint)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[UpdateManifestDLTrusted]">
			<Property Name="BodyScript">
				<Value><![CDATA[

BEGIN
	UPDATE CTL.ControlManifest SET 
	[ProcessedToTrustedZone] = 1
	,TrustedZonePipelineRunID = @PipelineRunID
	WHERE [ProcessedToTrustedZone] IS NULL
	AND BatchExecutionLogID = @BatchExecutionLogID
	AND SourceObject = @SourceObject
	AND StartCounter = @StartCounter
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[ProcessedToTrustedZone]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[TrustedZonePipelineRunID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestDLTrusted].[@PipelineRunID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestDLTrusted].[@BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestDLTrusted].[@SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[StartCounter]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestDLTrusted].[@StartCounter]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestDLTrusted].[@SourceObject]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestDLTrusted].[@BatchExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestDLTrusted].[@StartCounter]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestDLTrusted].[@PipelineRunID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="459" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [CTL].[UpdateManifestDLTrusted] (&#xD;&#xA;&#x9;@SourceObject varchar(255),&#xD;&#xA;&#x9;@BatchExecutionLogID bigint,&#xD;&#xA;&#x9;@StartCounter varchar(255),&#xD;&#xA;&#x9;@PipelineRunID varchar(50))&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[UpdateManifestSQLEDW]">
			<Property Name="BodyScript">
				<Value><![CDATA[

BEGIN

	--Get the Audit Table for Main Table
	DECLARE @AuditTable VARCHAR(100)
	SELECT @AuditTable = A.SourceName
	FROM CTL.ControlSource S 
	LEFT JOIN CTL.ControlSource A ON S.SoftDeleteSource = A.SourceLocation
	WHERE S.SourceName = @SourceObject

	--If there is no Audit Table defined then use the same table as default
	IF @AuditTable IS NULL OR @AuditTable = ''
		SET @AuditTable = @SourceObject

	IF @ProcessedToSQLEDW = '1'
		UPDATE CTL.ControlManifest SET 
		[ProcessedToSQLEDW] = 1
		,SQLEDWPipelineRunID = @PipelineRunID
		WHERE 1 = 1
		AND (SourceObject = @SourceObject OR SourceObject = @AuditTable) --Check the Manifest logs for both the main and Audit table
		AND [ProcessedToSQLEDW] IS NULL
		AND BatchExecutionLogID <= @BatchExecutionLogID

END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SoftDeleteSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestSQLEDW].[@SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestSQLEDW].[@ProcessedToSQLEDW]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[ProcessedToSQLEDW]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SQLEDWPipelineRunID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestSQLEDW].[@PipelineRunID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[SourceObject]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlManifest].[BatchExecutionLogID]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateManifestSQLEDW].[@BatchExecutionLogID]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestSQLEDW].[@BatchExecutionLogID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestSQLEDW].[@SourceObject]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="255" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestSQLEDW].[@ProcessedToSQLEDW]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[char]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateManifestSQLEDW].[@PipelineRunID]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="961" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE PROCEDURE [CTL].[UpdateManifestSQLEDW] (&#xD;&#xA;&#x9;@BatchExecutionLogID bigint,&#xD;&#xA;&#x9;@SourceObject varchar(255),&#xD;&#xA;&#x9;@ProcessedToSQLEDW char(1),&#xD;&#xA;&#x9;@PipelineRunID varchar(50)&#xD;&#xA;&#x9;)&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[UpdateTaskLog]">
			<Property Name="BodyScript">
				<Value><![CDATA[
BEGIN
	If (Select Count(*) From CTL.BatchExecutionLog Where BatchExecutionLogId = @BatchLogId And BatchExecutionStatus = 'In Progress') = 0
	  BEGIN
		RAISERROR('Batch execution log could not be located',16,1)
	  END
	Else
	  BEGIN
	    If (Select Count(*) From CTL.TaskExecutionLog Where ControlTaskId = @TaskId And ExecutionStatus = 'In Progress') = 0
		  BEGIN
			RAISERROR('Task execution log could not be located',16,1)
		  END
		Else
		  BEGIN
			Update CTL.TaskExecutionLog
			   Set EndTime = [CTL].[udf_GetDateLocalTZ](),
			       ExecutionStatus = @Status,
				   ErrorMessage = @ErrorMessage,
				   TaskOutput = @Output
			 Where ExecutionLogId = @ExecutionLogId
		  END
	  END
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References Name="[CTL].[BatchExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionLogId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateTaskLog].[@BatchLogId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[BatchExecutionLog].[BatchExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateTaskLog].[@TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[EndTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[udf_GetDateLocalTZ]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateTaskLog].[@Status]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateTaskLog].[@ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[TaskOutput]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateTaskLog].[@Output]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionLogId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateTaskLog].[@ExecutionLogId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateTaskLog].[@BatchLogId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateTaskLog].[@TaskId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateTaskLog].[@ExecutionLogId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateTaskLog].[@Status]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="50" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateTaskLog].[@ErrorMessage]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="2000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateTaskLog].[@Output]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="2000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="893" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE Procedure [CTL].[UpdateTaskLog] (@BatchLogId BigInt, @TaskId BigInt, @ExecutionLogId BigInt, @Status Varchar(50), @ErrorMessage varchar(2000), @Output Varchar(2000))&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlProcedure" Name="[CTL].[UpdateWatermarks]">
			<Property Name="BodyScript">
				<Value><![CDATA[

BEGIN


	DECLARE @WatermarkUpdated varchar(500)
	IF ISDATE(@WatermarkUpdated) = 1
		SET @WatermarkUpdated = FORMAT(TRY_CONVERT(DATETIME, @Watermark), 'yyyy-MM-ddTHH:mm:ss')
	ELSE
		SET @WatermarkUpdated = @Watermark

	Update CTL.ControlWatermark
	   Set Watermarks = @WatermarkUpdated
	 Where ControlSourceId = @SourceId
END]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="BodyDependencies">
				<Entry>
					<References ExternalSource="BuiltIns" Name="[varchar]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateWatermarks].[@Watermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[Watermarks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[UpdateWatermarks].[@SourceId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Parameters">
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateWatermarks].[@SourceId]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[bigint]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlSubroutineParameter" Name="[CTL].[UpdateWatermarks].[@Watermark]">
						<Relationship Name="Type">
							<Entry>
								<Element Type="SqlTypeSpecifier">
									<Property Name="Length" Value="1000" />
									<Relationship Name="Type">
										<Entry>
											<References ExternalSource="BuiltIns" Name="[varchar]" />
										</Entry>
									</Relationship>
								</Element>
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="Length" Value="428" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="CREATE Procedure [CTL].[UpdateWatermarks] @SourceId BigInt, @Watermark Varchar(1000)&#xD;&#xA;As" />
			</Annotation>
		</Element>
		<Element Type="SqlUniqueConstraint" Name="[CTL].[UQ_ControlTasks_TaskName]">
			<Relationship Name="ColumnSpecifications">
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlTasks].[TaskName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlTasks].[ControlStageId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlIndexedColumnSpecification">
						<Relationship Name="Column">
							<Entry>
								<References Name="[CTL].[ControlTasks].[ProjectId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="DefiningTable">
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
			</Relationship>
			<AttachedAnnotation Disambiguator="24" />
		</Element>
		<Element Type="SqlView" Name="[CTL].[vw_ControlConfiguration]">
			<Property Name="QueryScript">
				<Value><![CDATA[
SELECT 
	TaskName 
	,ProjectName
	,DataLoadMode
	,BusinessKeyColumn 
	,TYPES.ControlType
	,TASKS.ControlStageId
	,TrackChanges
	,SourceLocation
	,TargetLocation
	,TaskEnabled
	,S.SourceServer
	,AdditionalProperty
	,Command
	,W.SourceColumn
	,W.Watermarks
	,S.Processor
	,S.SoftDeleteSource
	,S.IsAuditTable
	,TASKS.TaskId
	,S.SourceId
	,TGT.TargetId
	,P.ProjectId
FROM CTL.ControlTasks TASKS
INNER JOIN CTL.ControlSource S ON TASKS.SourceId = S.SourceId
INNER JOIN CTL.ControlTarget TGT ON TASKS.TargetId = TGT.TargetId
INNER JOIN CTL.ControlProjects P ON TASKS.ProjectId = P.ProjectId
INNER JOIN CTL.ControlTypes TYPES ON S.SourceTypeId = TYPES.TypeId
LEFT JOIN CTL.ControlTaskCommand CTC ON Tasks.TaskId = CTC.ControlTaskId
LEFT JOIN CTL.ControlWatermark W ON W.ControlSourceId = S.SourceId]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[TaskName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTasks].[TaskName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[ProjectName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlProjects].[ProjectName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[DataLoadMode]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTasks].[DataLoadMode]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[BusinessKeyColumn]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlSource].[BusinessKeyColumn]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[ControlType]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTypes].[ControlType]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[ControlStageId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTasks].[ControlStageId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[TrackChanges]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTasks].[TrackChanges]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[SourceLocation]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlSource].[SourceLocation]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[TargetLocation]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTarget].[TargetLocation]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[TaskEnabled]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTasks].[TaskEnabled]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[SourceServer]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlSource].[SourceServer]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[AdditionalProperty]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlSource].[AdditionalProperty]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[Command]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTaskCommand].[Command]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[SourceColumn]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlWatermark].[SourceColumn]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[Watermarks]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlWatermark].[Watermarks]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[Processor]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlSource].[Processor]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[SoftDeleteSource]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlSource].[SoftDeleteSource]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[IsAuditTable]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlSource].[IsAuditTable]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[TaskId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTasks].[TaskId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[SourceId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlSource].[SourceId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[TargetId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTarget].[TargetId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_ControlConfiguration].[ProjectId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlProjects].[ProjectId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceTypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[TypeId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[ControlSourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[DataLoadMode]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[BusinessKeyColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTypes].[ControlType]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TrackChanges]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetLocation]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskEnabled]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SourceServer]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[AdditionalProperty]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTaskCommand].[Command]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[SourceColumn]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlWatermark].[Watermarks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[Processor]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[SoftDeleteSource]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlSource].[IsAuditTable]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTarget].[TargetId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectId]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="12" />
				<Property Name="Length" Value="882" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;CREATE VIEW [CTL].[vw_ControlConfiguration]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
		<Element Type="SqlView" Name="[CTL].[vw_TaskExecutionDetails]">
			<Property Name="QueryScript">
				<Value><![CDATA[

SELECT [ExecutionLogId]
      ,[BatchExecutionId]
      ,[ControlTaskId]
	  ,p.ProjectName
	  ,p.ProjectId
	  ,s.ControlStageId as StageId
	  ,s.StageName
	  ,t.TaskName
      ,[StartTime]
      ,[EndTime]
	  ,DATEDIFF(MINUTE,StartTime,EndTime) as Duration
      ,[ExecutionStatus]
      ,[ErrorMessage]
      ,[TaskOutput]
  FROM [CTL].[TaskExecutionLog] as l
  left join [CTL].[ControlTasks] as t 
  on l.ControlTaskId = t.TaskId
  left join [CTL].[ControlStages] as s
  on t.ControlStageId = s.ControlStageId
  left join [CTL].[ControlProjects] as p
  on t.ProjectId = p.ProjectId
  --order by BatchExecutionId desc, StartTime desc--, ExecutionStatus, duration desc]]></Value>
			</Property>
			<Property Name="IsAnsiNullsOn" Value="True" />
			<Relationship Name="Columns">
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[ExecutionLogId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[TaskExecutionLog].[ExecutionLogId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[BatchExecutionId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[TaskExecutionLog].[BatchExecutionId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[ControlTaskId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[ProjectName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlProjects].[ProjectName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[ProjectId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlProjects].[ProjectId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[StageId]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlStages].[ControlStageId]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[StageName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlStages].[StageName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[TaskName]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[ControlTasks].[TaskName]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[StartTime]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[TaskExecutionLog].[StartTime]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[EndTime]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[TaskExecutionLog].[EndTime]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[Duration]" />
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[ExecutionStatus]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[TaskExecutionLog].[ExecutionStatus]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[ErrorMessage]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[TaskExecutionLog].[ErrorMessage]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
				<Entry>
					<Element Type="SqlComputedColumn" Name="[CTL].[vw_TaskExecutionDetails].[TaskOutput]">
						<Relationship Name="ExpressionDependencies">
							<Entry>
								<References Name="[CTL].[TaskExecutionLog].[TaskOutput]" />
							</Entry>
						</Relationship>
					</Element>
				</Entry>
			</Relationship>
			<Relationship Name="QueryDependencies">
				<Entry>
					<References Name="[CTL].[TaskExecutionLog]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionLogId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[BatchExecutionId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ControlTaskId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlProjects].[ProjectName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[ControlStageId]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlStages].[StageName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[ControlTasks].[TaskName]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[StartTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[EndTime]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ExecutionStatus]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[ErrorMessage]" />
				</Entry>
				<Entry>
					<References Name="[CTL].[TaskExecutionLog].[TaskOutput]" />
				</Entry>
			</Relationship>
			<Relationship Name="Schema">
				<Entry>
					<References Name="[CTL]" />
				</Entry>
			</Relationship>
			<Annotation Type="SysCommentsObjectAnnotation">
				<Property Name="CreateOffset" Value="2" />
				<Property Name="Length" Value="742" />
				<Property Name="StartLine" Value="1" />
				<Property Name="StartColumn" Value="1" />
				<Property Name="HeaderContents" Value="&#xD;&#xA;CREATE VIEW [CTL].[vw_TaskExecutionDetails]&#xD;&#xA;AS" />
			</Annotation>
		</Element>
	</Model>
</DataSchemaModel>