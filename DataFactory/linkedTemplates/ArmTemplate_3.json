{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "factoryName": {
            "type": "string",
            "metadata": "Data Factory name",
            "defaultValue": "ama-panel-adf-dp-dev-as-01"
        }
    },
    "variables": {
        "factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
    },
    "resources": [
        {
            "name": "[concat(parameters('factoryName'), '/util-download-schema-file')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "SET-Source-Folder",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "SourceFolder",
                            "value": {
                                "value": "@pipeline().parameters.SourceFolder",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "SET-Target-Folder",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "TargetFolder",
                            "value": {
                                "value": "@toLower(concat(\n  split(pipeline().parameters.TaskDetails.TargetLocation,'/')[0],\n  '/schema/'\n))",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "EP-Download-File",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "SET-Source-Folder",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "SET-Target-Folder",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "SET-Source-File",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "SET-Target-File",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "SET-FileShareUserID",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "util-fileserver-download-file",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "TargetFolder": {
                                    "value": "@variables('TargetFolder')",
                                    "type": "Expression"
                                },
                                "TargetContainer": "raw",
                                "DeleteFile": true,
                                "SourceFile": {
                                    "value": "@variables('SourceFile')",
                                    "type": "Expression"
                                },
                                "TargetFile": {
                                    "value": "@variables('TargetFile')",
                                    "type": "Expression"
                                },
                                "SourceFolder": {
                                    "value": "@variables('SourceFolder')",
                                    "type": "Expression"
                                },
                                "FileShareURL": {
                                    "value": "@pipeline().parameters.FileShareURL",
                                    "type": "Expression"
                                },
                                "FileShareUserID": {
                                    "value": "@pipeline().parameters.FileShareUserID",
                                    "type": "Expression"
                                },
                                "FileSharePassword": {
                                    "value": "@pipeline().parameters.FileSharePassword",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "SET-Source-File",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "SourceFile",
                            "value": {
                                "value": "@toLower(concat(\n  pipeline().parameters.TaskDetails.TaskName,\n  '.schema'\n))",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "SET-Target-File",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "TargetFile",
                            "value": {
                                "value": "@toLower(concat(\n  pipeline().parameters.TaskDetails.TaskName,\n  '.schema'\n))",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "SET-FileShareUserID",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "FileShareUserID",
                            "value": {
                                "value": "/*@if(\n  equals(pipeline().parameters.FileShareUserID,'')\n  ,pipeline().globalParameters.FileServerUserID\n  ,pipeline().parameters.FileShareUserID\n)*/\n123",
                                "type": "Expression"
                            }
                        }
                    }
                ],
                "parameters": {
                    "TaskDetails": {
                        "type": "object"
                    },
                    "FileShareURL": {
                        "type": "string"
                    },
                    "FileShareUserID": {
                        "type": "string"
                    },
                    "FileSharePassword": {
                        "type": "string"
                    },
                    "SourceFolder": {
                        "type": "string"
                    }
                },
                "variables": {
                    "SourceFolder": {
                        "type": "String"
                    },
                    "TargetFolder": {
                        "type": "String"
                    },
                    "SourceFile": {
                        "type": "String"
                    },
                    "TargetFile": {
                        "type": "String"
                    },
                    "FileShareUserID": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Utility"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-SQLServer-B-Source-Copy')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Copy-Source-DataLake",
                        "type": "Copy",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlServerSource",
                                "sqlReaderQuery": {
                                    "value": "@pipeline().parameters.SourceSQL",
                                    "type": "Expression"
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobStorageWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false
                        },
                        "inputs": [
                            {
                                "referenceName": "SRC_SQLServer",
                                "type": "DatasetReference",
                                "parameters": {
                                    "kvSecret": "@pipeline().parameters.TaskDetails.SourceServer"
                                }
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "RAW_ADLS_JSON",
                                "type": "DatasetReference",
                                "parameters": {
                                    "BlobPath": {
                                        "value": "@pipeline().parameters.TargetBLOBFolder",
                                        "type": "Expression"
                                    },
                                    "BlobName": {
                                        "value": "@pipeline().parameters.TargetBLOBName",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "If-RecordCount",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Copy-Source-DataLake",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@greater(activity('Copy-Source-DataLake').output.rowsCopied, 0)",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "SP-Record-Manifest",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                                        "storedProcedureParameters": {
                                            "BatchExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Container": {
                                                "value": "raw",
                                                "type": "String"
                                            },
                                            "EndCounter": {
                                                "value": {
                                                    "value": "@json(string(pipeline().parameters.ValidationDetails)).ReturnValue",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FileName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TargetBLOBName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FolderName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TargetBLOBFolder",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "Records": {
                                                "value": {
                                                    "value": "@string(activity('Copy-Source-DataLake').output.rowsCopied)",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "SourceObject": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "StartCounter": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.Watermarks",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "TaskExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "DeltaColumn": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.WatermarkColumn",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "PipelineRunID": {
                                                "value": {
                                                    "value": "@pipeline().RunId",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Execute-DB-Load-Delta-Table",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Record-Manifest",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-DL-Load-Raw-to-Delta-Table",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@pipeline().parameters.TargetBLOBFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@pipeline().parameters.TargetBLOBName",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Record-Validation",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "Execute-DB-Load-Delta-Table",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "recon-record-validation",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@pipeline().parameters.ValidationDetails",
                                                "type": "Expression"
                                            },
                                            "SourceID": {
                                                "value": "@pipeline().parameters.TaskDetails.SourceID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "securestring"
                    },
                    "SourceSQL": {
                        "type": "string"
                    },
                    "TargetBLOBFolder": {
                        "type": "string"
                    },
                    "TargetBLOBName": {
                        "type": "string"
                    },
                    "ValidationDetails": {
                        "type": "object"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "folder": {
                    "name": "SQL Server"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-27T00:17:49Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-MySQL-B-Source-Copy')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Copy-Source-DataLake",
                        "type": "Copy",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "MySqlSource",
                                "query": {
                                    "value": "@pipeline().parameters.SourceSQL",
                                    "type": "Expression"
                                }
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobStorageWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false
                        },
                        "inputs": [
                            {
                                "referenceName": "SRC_MySQL",
                                "type": "DatasetReference",
                                "parameters": {
                                    "kvSecret": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceServer",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "RAW_ADLS_JSON",
                                "type": "DatasetReference",
                                "parameters": {
                                    "BlobPath": {
                                        "value": "@pipeline().parameters.TargetBLOBFolder",
                                        "type": "Expression"
                                    },
                                    "BlobName": {
                                        "value": "@pipeline().parameters.TargetBLOBName",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "If-RecordCount",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Copy-Source-DataLake",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@greater(activity('Copy-Source-DataLake').output.rowsCopied, 0)",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "SP-Record-Manifest",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                                        "storedProcedureParameters": {
                                            "BatchExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Container": {
                                                "value": "raw",
                                                "type": "String"
                                            },
                                            "EndCounter": {
                                                "value": {
                                                    "value": "@pipeline().parameters.EndCounter",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FileName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TargetBLOBName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FolderName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TargetBLOBFolder",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "Records": {
                                                "value": {
                                                    "value": "@string(activity('Copy-Source-DataLake').output.rowsCopied)",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "SourceObject": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "StartCounter": {
                                                "value": {
                                                    "value": "@pipeline().parameters.StartCounter",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "TaskExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "DeltaColumn": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.WatermarkColumn",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "PipelineRunID": {
                                                "value": {
                                                    "value": "@pipeline().RunId",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Execute-DB-Load-Delta-Table",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Record-Manifest",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-DL-Load-Raw-to-Delta-Table",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@pipeline().parameters.TargetBLOBFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@pipeline().parameters.TargetBLOBName",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Record-Validation",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "Execute-DB-Load-Delta-Table",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "recon-record-validation",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@pipeline().parameters.ValidationDetails",
                                                "type": "Expression"
                                            },
                                            "SourceID": {
                                                "value": "@pipeline().parameters.TaskDetails.SourceID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "securestring"
                    },
                    "SourceSQL": {
                        "type": "string"
                    },
                    "TargetBLOBFolder": {
                        "type": "string"
                    },
                    "TargetBLOBName": {
                        "type": "string"
                    },
                    "StartCounter": {
                        "type": "string"
                    },
                    "EndCounter": {
                        "type": "string"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    },
                    "ValidationDetails": {
                        "type": "object"
                    }
                },
                "folder": {
                    "name": "MySQL"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-Oracle-B-Source-Copy')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Copy-Source-DataLake",
                        "type": "Copy",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "OracleSource",
                                "oracleReaderQuery": {
                                    "value": "@pipeline().parameters.SourceSQL",
                                    "type": "Expression"
                                },
                                "partitionOption": "None",
                                "queryTimeout": "10:00:00"
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobStorageWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false
                        },
                        "inputs": [
                            {
                                "referenceName": "SRC_Oracle",
                                "type": "DatasetReference",
                                "parameters": {
                                    "kvSecret": "@pipeline().parameters.TaskDetails.SourceServer"
                                }
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "RAW_ADLS_JSON",
                                "type": "DatasetReference",
                                "parameters": {
                                    "BlobPath": {
                                        "value": "@pipeline().parameters.TargetBLOBFolder",
                                        "type": "Expression"
                                    },
                                    "BlobName": {
                                        "value": "@pipeline().parameters.TargetBLOBName",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "If-RecordCount",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Copy-Source-DataLake",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@greater(activity('Copy-Source-DataLake').output.rowsCopied, 0)",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "SP-Record-Manifest",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                                        "storedProcedureParameters": {
                                            "BatchExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Container": {
                                                "value": "raw",
                                                "type": "String"
                                            },
                                            "EndCounter": {
                                                "value": {
                                                    "value": "@json(string(pipeline().parameters.ValidationDetails)).ReturnValue",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FileName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TargetBLOBName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FolderName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TargetBLOBFolder",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "Records": {
                                                "value": {
                                                    "value": "@string(activity('Copy-Source-DataLake').output.rowsCopied)",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "SourceObject": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "StartCounter": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.Watermarks",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "TaskExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "DeltaColumn": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.WatermarkColumn",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "PipelineRunID": {
                                                "value": {
                                                    "value": "@pipeline().RunId",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Execute-DB-Load-Delta-Table",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Record-Manifest",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-DL-Load-Raw-to-Delta-Table",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@pipeline().parameters.TargetBLOBFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@pipeline().parameters.TargetBLOBName",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Record-Validation",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "Execute-DB-Load-Delta-Table",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "recon-record-validation",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@pipeline().parameters.ValidationDetails",
                                                "type": "Expression"
                                            },
                                            "SourceID": {
                                                "value": "@pipeline().parameters.TaskDetails.SourceID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "securestring"
                    },
                    "SourceSQL": {
                        "type": "string"
                    },
                    "TargetBLOBFolder": {
                        "type": "string"
                    },
                    "TargetBLOBName": {
                        "type": "string"
                    },
                    "ValidationDetails": {
                        "type": "object"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "folder": {
                    "name": "Oracle"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:07Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-Oracle-XX-Source-Copy')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "LU-DataToLoad",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "Generate Batch Log",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderQuery": {
                                    "value": "@concat('SELECT ', variables('Columns') , ' FROM CTL.CustomDataLoad WHERE TableName = ', '''', pipeline().parameters.SourceObject, '''', 'AND ExtractionComplete IS NULL ORDER BY StartDate')",
                                    "type": "Expression"
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "Loop Periods",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "LU-DataToLoad",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('LU-DataToLoad').output.value",
                                "type": "Expression"
                            },
                            "isSequential": true,
                            "activities": [
                                {
                                    "name": "Copy-Source-DataLake",
                                    "type": "Copy",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-LU-SQL-Main",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "source": {
                                            "type": "OracleSource",
                                            "oracleReaderQuery": {
                                                "value": "@variables('SQLQuery')",
                                                "type": "Expression"
                                            },
                                            "partitionOption": "None",
                                            "queryTimeout": "10:00:00"
                                        },
                                        "sink": {
                                            "type": "JsonSink",
                                            "storeSettings": {
                                                "type": "AzureBlobStorageWriteSettings"
                                            },
                                            "formatSettings": {
                                                "type": "JsonWriteSettings"
                                            }
                                        },
                                        "enableStaging": false
                                    },
                                    "inputs": [
                                        {
                                            "referenceName": "SRC_Oracle",
                                            "type": "DatasetReference",
                                            "parameters": {
                                                "kvSecret": {
                                                    "value": "@item().ServiceName",
                                                    "type": "Expression"
                                                }
                                            }
                                        }
                                    ],
                                    "outputs": [
                                        {
                                            "referenceName": "RAW_ADLS_JSON",
                                            "type": "DatasetReference",
                                            "parameters": {
                                                "BlobPath": {
                                                    "value": "@variables('Folder')",
                                                    "type": "Expression"
                                                },
                                                "BlobName": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                }
                                            }
                                        }
                                    ]
                                },
                                {
                                    "name": "SP-Record-Manifest",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Source-RecordCount",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                                        "storedProcedureParameters": {
                                            "BatchExecutionLogID": {
                                                "value": {
                                                    "value": "@activity('Generate Batch Log').output.firstrow.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Container": {
                                                "value": "raw",
                                                "type": "String"
                                            },
                                            "EndCounter": {
                                                "value": {
                                                    "value": "@item().EndDate",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FileName": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FolderName": {
                                                "value": {
                                                    "value": "@variables('Folder')",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "Records": {
                                                "value": {
                                                    "value": "@variables('RecordCount')",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "SourceObject": {
                                                "value": {
                                                    "value": "@toLower(concat(pipeline().parameters.ProjectName, '_', replace(pipeline().parameters.SourceObject, '.', '_')))",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "StartCounter": {
                                                "value": {
                                                    "value": "@item().StartDate",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "TaskExecutionLogID": {
                                                "value": {
                                                    "value": "@activity('Generate Task Log').output.firstrow.TaskLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "DeltaColumn": {
                                                "value": {
                                                    "value": "@variables('DeltaColumn')",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Source-RecordCount",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "Copy-Source-DataLake",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "RecordCount",
                                        "value": {
                                            "value": "@string(activity('Copy-Source-DataLake').output.rowsCopied)",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-LU-SQL-Main",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "Set-EndDate",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "SQLQuery",
                                        "value": {
                                            "value": "@concat('SELECT * FROM ', item().TableName, ' WHERE CREATED_DATE BETWEEN TO_DATE(', '''', item().StartDate, '''', ',', variables('OracleDateFormat') , ') AND ', 'TO_DATE(', '''', item().EndDate, '''', ',', variables('OracleDateFormat'),  ')')",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "Get Full File Name",
                                    "type": "Lookup",
                                    "dependsOn": [
                                        {
                                            "activity": "Generate Task Log",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "source": {
                                            "type": "AzureSqlSource",
                                            "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                            "storedProcedureParameters": {
                                                "DeltaExtract": {
                                                    "type": "Boolean",
                                                    "value": {
                                                        "value": "true",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "FileName": {
                                                    "type": "String",
                                                    "value": {
                                                        "value": "@pipeline().parameters.SourceObject",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "FolderName": {
                                                    "type": "String",
                                                    "value": {
                                                        "value": "@concat('OneEBS/', toUpper(replace(pipeline().parameters.SourceObject, '.', '_')))",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "Grain": {
                                                    "type": "String",
                                                    "value": {
                                                        "value": "day",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "Compressed": {
                                                    "type": "Boolean",
                                                    "value": {
                                                        "value": "true",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "TargetType": {
                                                    "type": "String",
                                                    "value": {
                                                        "value": "BLOB Storage (json)",
                                                        "type": "Expression"
                                                    }
                                                }
                                            },
                                            "partitionOption": "None"
                                        },
                                        "dataset": {
                                            "referenceName": "AzureSqlDatabase_Ctrldb",
                                            "type": "DatasetReference",
                                            "parameters": {}
                                        },
                                        "firstRowOnly": true
                                    }
                                },
                                {
                                    "name": "Generate Task Log",
                                    "type": "Lookup",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "source": {
                                            "type": "AzureSqlSource",
                                            "sqlReaderStoredProcedureName": "[[CTL].[CreateTaskLog]",
                                            "storedProcedureParameters": {
                                                "BatchLogId": {
                                                    "type": "Int64",
                                                    "value": {
                                                        "value": "@activity('Generate Batch Log').output.firstrow.BatchLogId",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "TaskId": {
                                                    "type": "Int64",
                                                    "value": {
                                                        "value": "@variables('TaskID')",
                                                        "type": "Expression"
                                                    }
                                                }
                                            },
                                            "partitionOption": "None"
                                        },
                                        "dataset": {
                                            "referenceName": "AzureSqlDatabase_Ctrldb",
                                            "type": "DatasetReference",
                                            "parameters": {}
                                        }
                                    }
                                },
                                {
                                    "name": "Log Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "Update Data Load Log",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@activity('Generate Batch Log').output.firstrow.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@activity('Generate Task Log').output.firstrow.TaskLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@variables('TaskID')",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": "Success",
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Update Data Load Log",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Record-Manifest",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateCustomDataLoad]",
                                        "storedProcedureParameters": {
                                            "StartDate": {
                                                "value": {
                                                    "value": "@item().StartDate",
                                                    "type": "Expression"
                                                },
                                                "type": "DateTime"
                                            },
                                            "TableName": {
                                                "value": {
                                                    "value": "@item().TableName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Set Folder",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "Get Full File Name",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "Folder",
                                        "value": {
                                            "value": "@concat(toLower(pipeline().parameters.ProjectName), '/', toLower(replace(pipeline().parameters.SourceObject, '.', '_')), '/json/', 'year=', formatDateTime(item().StartDate, 'yyyy'), '/month=', formatDateTime(item().StartDate, 'MM'), '/day=', formatDateTime(item().StartDate, 'dd'), '/')",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "Set-EndDate",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "Set Folder",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "EndDate",
                                        "value": {
                                            "value": "@item().EndDate",
                                            "type": "Expression"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Generate Batch Log",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "Execute-Generate-Schema",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[CreateBatchLog]",
                                "storedProcedureParameters": {
                                    "ProjectID": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "@variables('ProjectID')",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Batch Log Success",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SP-Update-Watermark",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateBatchLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@activity('Generate Batch Log').output.firstrow.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "@activity('Notebook-Delta-Table').output.runOutput",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Complete",
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Batch Log Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Loop Periods",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateBatchLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@activity('Generate Batch Log').output.firstrow.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": "Check Task Execution Log for errors",
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Execute-Generate-Schema",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "Set ProjectID",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "04-Oracle-Generate-Source-Schema",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "SourceObject": {
                                    "value": "@pipeline().parameters.SourceObject",
                                    "type": "Expression"
                                },
                                "Project": {
                                    "value": "OneEBS",
                                    "type": "Expression"
                                },
                                "SourceServer": {
                                    "value": "@activity('Lookup-TaskID').output.firstRow.SourceServer",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Lookup-TaskID",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderQuery": {
                                    "value": "@concat('SELECT SourceID, SourceServer FROM CTL.ControlSource WHERE SourceTypeID = 6 and SourceLocation = ', '''', pipeline().parameters.SourceObject, '''')",
                                    "type": "Expression"
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Set TaskID",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Lookup-TaskID",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "TaskID",
                            "value": {
                                "value": "@string(activity('Lookup-TaskID').output.firstRow.SourceID)",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Set ProjectID",
                        "type": "SetVariable",
                        "dependsOn": [
                            {
                                "activity": "Set TaskID",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ProjectID",
                            "value": {
                                "value": "@concat(variables('TaskID'), '0')",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Notebook-Delta-Table",
                        "type": "DatabricksNotebook",
                        "dependsOn": [
                            {
                                "activity": "Loop Periods",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "notebookPath": "/build/raw/load-raw-deltatable",
                            "baseParameters": {
                                "file_object": {
                                    "value": "@toLower(concat(pipeline().parameters.ProjectName, '/', replace(pipeline().parameters.SourceObject, '.', '_'), '/*/*/*/*/*.json.gz'))",
                                    "type": "Expression"
                                },
                                "delta_extract": {
                                    "value": "true",
                                    "type": "Expression"
                                },
                                "cdc_mode": {
                                    "value": "false",
                                    "type": "Expression"
                                },
                                "delta_column": {
                                    "value": "@variables('DeltaColumn')",
                                    "type": "Expression"
                                }
                            },
                            "libraries": [
                                {
                                    "maven": {
                                        "coordinates": "com.microsoft.azure:azure-sqldb-spark:1.0.2"
                                    }
                                }
                            ]
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureDatabricks_JobCluster",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": {
                                    "value": "databricks-token",
                                    "type": "Expression"
                                },
                                "DataBricksClusterType": "Standard_DS5_v2",
                                "DataBricksClusterVersion": "6.4.x-scala2.11",
                                "DataBricksWorkerNodes": "2:8"
                            }
                        }
                    },
                    {
                        "name": "Batch Log Failure-Notebook",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Notebook-Delta-Table",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateBatchLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@activity('Generate Batch Log').output.firstrow.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": "Check Task Execution Log for errors",
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "SP-Update-Watermark",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Notebook-Delta-Table",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[updateWatermarks]",
                            "storedProcedureParameters": {
                                "SourceId": {
                                    "value": {
                                        "value": "@string(activity('Lookup-TaskID').output.firstRow.SourceID)",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Watermark": {
                                    "value": {
                                        "value": "@variables('EndDate')",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    }
                ],
                "parameters": {
                    "SourceObject": {
                        "type": "string",
                        "defaultValue": "EBS_0165.REGISTER_EVENTS"
                    },
                    "ProjectName": {
                        "type": "string",
                        "defaultValue": "OneEBS"
                    }
                },
                "variables": {
                    "SQLQuery": {
                        "type": "String"
                    },
                    "RecordCount": {
                        "type": "String"
                    },
                    "DeltaColumn": {
                        "type": "String",
                        "defaultValue": "UPDATED_DATE, CREATED_DATE"
                    },
                    "Folder": {
                        "type": "String"
                    },
                    "Columns": {
                        "type": "String",
                        "defaultValue": "TableName, ServiceName, format(StartDate, 'yyyy-MM-dd hh:mm:ss') StartDate, format(EndDate, 'yyyy-MM-dd hh:mm:ss') EndDate"
                    },
                    "OracleDateFormat": {
                        "type": "String",
                        "defaultValue": "'YYYY-MM-DD HH24:MI:SS'"
                    },
                    "TaskID": {
                        "type": "String"
                    },
                    "ProjectID": {
                        "type": "String"
                    },
                    "EndDate": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Oracle/OneTimeLoad"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-SQLAzure-B-Source-Copy')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Copy-Source-DataLake",
                        "type": "Copy",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlServerSource",
                                "sqlReaderQuery": {
                                    "value": "@pipeline().parameters.SourceSQL",
                                    "type": "Expression"
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobStorageWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false
                        },
                        "inputs": [
                            {
                                "referenceName": "SRC_SQLAzure",
                                "type": "DatasetReference",
                                "parameters": {
                                    "kvSecret": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceServer",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "RAW_ADLS_JSON",
                                "type": "DatasetReference",
                                "parameters": {
                                    "BlobPath": {
                                        "value": "@pipeline().parameters.TargetBLOBFolder",
                                        "type": "Expression"
                                    },
                                    "BlobName": {
                                        "value": "@pipeline().parameters.TargetBLOBName",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "If-RecordCount",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Copy-Source-DataLake",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@greater(activity('Copy-Source-DataLake').output.rowsCopied, 0)",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "SP-Record-Manifest",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                                        "storedProcedureParameters": {
                                            "BatchExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Container": {
                                                "value": "raw",
                                                "type": "String"
                                            },
                                            "EndCounter": {
                                                "value": {
                                                    "value": "@json(string(pipeline().parameters.ValidationDetails)).ReturnValue",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FileName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TargetBLOBName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FolderName": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TargetBLOBFolder",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "Records": {
                                                "value": {
                                                    "value": "@string(activity('Copy-Source-DataLake').output.rowsCopied)",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "SourceObject": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "StartCounter": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.Watermarks",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "TaskExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "DeltaColumn": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.WatermarkColumn",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "PipelineRunID": {
                                                "value": {
                                                    "value": "@pipeline().RunId",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Execute-DB-Load-Delta-Table",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Record-Manifest",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-DL-Load-Raw-to-Delta-Table",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@pipeline().parameters.TargetBLOBFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@pipeline().parameters.TargetBLOBName",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Record-Validation",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "Execute-DB-Load-Delta-Table",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "recon-record-validation",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@pipeline().parameters.ValidationDetails",
                                                "type": "Expression"
                                            },
                                            "SourceID": {
                                                "value": "@pipeline().parameters.TaskDetails.SourceID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "securestring"
                    },
                    "SourceSQL": {
                        "type": "string"
                    },
                    "TargetBLOBFolder": {
                        "type": "string"
                    },
                    "TargetBLOBName": {
                        "type": "string"
                    },
                    "ValidationDetails": {
                        "type": "object"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "folder": {
                    "name": "SQL Azure"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-28T03:15:46Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/recon-target-main')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Get Load Tasks",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[getExecutionTasks]",
                                "storedProcedureParameters": {
                                    "ProjectId": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "@pipeline().parameters.ProjectId",
                                            "type": "Expression"
                                        }
                                    },
                                    "StageId": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "1",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": false
                        }
                    },
                    {
                        "name": "Execute Each Task",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "Get Load Tasks",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('Get Load Tasks').output.value",
                                "type": "Expression"
                            },
                            "isSequential": false,
                            "activities": [
                                {
                                    "name": "If-Validation",
                                    "type": "IfCondition",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "expression": {
                                            "value": "@not(item().IsAuditTable)",
                                            "type": "Expression"
                                        },
                                        "ifTrueActivities": [
                                            {
                                                "name": "EP-Recon-Target",
                                                "type": "ExecutePipeline",
                                                "dependsOn": [],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "pipeline": {
                                                        "referenceName": "recon-target",
                                                        "type": "PipelineReference"
                                                    },
                                                    "waitOnCompletion": true,
                                                    "parameters": {
                                                        "ProjectID": {
                                                            "value": "@pipeline().parameters.ProjectID",
                                                            "type": "Expression"
                                                        },
                                                        "ProjectRunID": {
                                                            "value": "@pipeline().parameters.ProjectRunID",
                                                            "type": "Expression"
                                                        },
                                                        "SourceName": {
                                                            "value": "@item().SourceName",
                                                            "type": "Expression"
                                                        }
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    }
                ],
                "parameters": {
                    "ProjectID": {
                        "type": "int"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "folder": {
                    "name": "Validation"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/06-Curated-NAT')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Get-Files",
                        "type": "GetMetadata",
                        "dependsOn": [
                            {
                                "activity": "Set-SourceFolder",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Set-TargetFolder",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Set-FileShareURL",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Set-FileShareUserID",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Set-FileSharePassword",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "BINARY_ADLS",
                                "type": "DatasetReference",
                                "parameters": {
                                    "File": "*.txt",
                                    "Container": {
                                        "value": "@variables('SourceContainer')",
                                        "type": "Expression"
                                    },
                                    "Folder": {
                                        "value": "@variables('SourceFolder')",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "fieldList": [
                                "childItems"
                            ],
                            "storeSettings": {
                                "type": "AzureBlobStorageReadSettings",
                                "recursive": true
                            },
                            "formatSettings": {
                                "type": "BinaryReadSettings"
                            }
                        }
                    },
                    {
                        "name": "Set-SourceFolder",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "SourceFolder",
                            "value": {
                                "value": "@concat(split(pipeline().parameters.TaskDetails.AdditionalProperty,'|')[0], '/', pipeline().parameters.NotebookOutput)",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "ForEach-CopyFiles",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "Get-Files",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('Get-Files').output.childItems",
                                "type": "Expression"
                            },
                            "isSequential": true,
                            "activities": [
                                {
                                    "name": "If-File-Copy",
                                    "type": "IfCondition",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "expression": {
                                            "value": "@equals(item().type, 'File')",
                                            "type": "Expression"
                                        },
                                        "ifFalseActivities": [
                                            {
                                                "name": "EP-Upload-Folder",
                                                "type": "ExecutePipeline",
                                                "dependsOn": [],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "pipeline": {
                                                        "referenceName": "util-fileserver-upload-folder",
                                                        "type": "PipelineReference"
                                                    },
                                                    "waitOnCompletion": true,
                                                    "parameters": {
                                                        "FileType": "*.txt",
                                                        "SourceContainer": {
                                                            "value": "@variables('SourceContainer')",
                                                            "type": "Expression"
                                                        },
                                                        "SourceFolder": {
                                                            "value": "@concat(variables('SourceFolder'), '/', item().name)",
                                                            "type": "Expression"
                                                        },
                                                        "TargetFolder": {
                                                            "value": "@concat(variables('TargetFolder'), '/', item().name)",
                                                            "type": "Expression"
                                                        },
                                                        "FileShareURL": {
                                                            "value": "@variables('FileShareURL')",
                                                            "type": "Expression"
                                                        },
                                                        "FileShareUserID": {
                                                            "value": "@variables('FileShareUserID')",
                                                            "type": "Expression"
                                                        },
                                                        "FileSharePassword": {
                                                            "value": "@variables('FileSharePassword')",
                                                            "type": "Expression"
                                                        }
                                                    }
                                                }
                                            }
                                        ],
                                        "ifTrueActivities": [
                                            {
                                                "name": "EP-Upload-File",
                                                "type": "ExecutePipeline",
                                                "dependsOn": [],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "pipeline": {
                                                        "referenceName": "util-fileserver-upload-file",
                                                        "type": "PipelineReference"
                                                    },
                                                    "waitOnCompletion": true,
                                                    "parameters": {
                                                        "SourceContainer": {
                                                            "value": "@variables('SourceContainer')",
                                                            "type": "Expression"
                                                        },
                                                        "SourceFolder": {
                                                            "value": "@variables('SourceFolder')",
                                                            "type": "Expression"
                                                        },
                                                        "FileName": {
                                                            "value": "@item().name",
                                                            "type": "Expression"
                                                        },
                                                        "UploadFolder": {
                                                            "value": "@variables('TargetFolder')",
                                                            "type": "Expression"
                                                        },
                                                        "FileShareURL": {
                                                            "value": "@variables('FileShareURL')",
                                                            "type": "Expression"
                                                        },
                                                        "FileShareUserID": {
                                                            "value": "@variables('FileShareUserID')",
                                                            "type": "Expression"
                                                        },
                                                        "FileSharePassword": {
                                                            "value": "@variables('FileSharePassword')",
                                                            "type": "Expression"
                                                        }
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Set-TargetFolder",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "TargetFolder",
                            "value": {
                                "value": "@concat(split(pipeline().parameters.TaskDetails.AdditionalProperty,'|')[1], '/', pipeline().parameters.NotebookOutput)",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Set-FileShareURL",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "FileShareURL",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[0]",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Set-FileShareUserID",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "FileShareUserID",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[1]",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Set-FileSharePassword",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "FileSharePassword",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[2]",
                                "type": "Expression"
                            }
                        }
                    }
                ],
                "parameters": {
                    "TaskDetails": {
                        "type": "object",
                        "defaultValue": {
                            "SourceType": "BLOB Storage (csv)",
                            "SourceServer": "datalake-SasToken",
                            "SourceName": "Qualtrics_Qualtrics",
                            "SourceLocation": "Qualtrics",
                            "AdditionalProperty": "nat/e-reporting|out/nat/ereporting",
                            "Processor": "databricks-token|0925-064956-carps143|Standard_DS5_v2|6.4.x-scala2.11|2:8|interactive",
                            "ProjectName": "Qualtrics1",
                            "TargetType": "SQL Server",
                            "TargetName": "Qualtrics_Qualtrics",
                            "TargetLocation": "Qualtrics",
                            "TargetServer": "AzureSqlDatabase-SQLDB",
                            "DataLoadMode": "0",
                            "DeltaExtract": null,
                            "CDCSource": null,
                            "TruncateTarget": null,
                            "UpsertTarget": null,
                            "TrackChanges": false,
                            "LoadToSqlEDW": true,
                            "TaskName": "Qualtrics_Qualtrics",
                            "ControlStageId": 3,
                            "TaskId": 813,
                            "StageSequence": 300,
                            "StageName": "Trusted to Curated",
                            "SourceId": 851,
                            "TargetId": 830,
                            "ObjectGrain": "Day",
                            "CommandTypeId": 8,
                            "Watermarks": null,
                            "WatermarksDT": null,
                            "WatermarkColumn": "",
                            "BusinessKeyColumn": "",
                            "Command": "/Users/rahul.agrawal1@tafenswtest.edu.au/build/curated/Qualtrics/QualtricsMaster-Test",
                            "LastLoadedFile": null
                        }
                    },
                    "NotebookOutput": {
                        "type": "string",
                        "defaultValue": "20210205"
                    }
                },
                "variables": {
                    "SourceFolder": {
                        "type": "String"
                    },
                    "SourceContainer": {
                        "type": "String",
                        "defaultValue": "curated"
                    },
                    "TargetFolder": {
                        "type": "String",
                        "defaultValue": "out/nat/avetmiss"
                    },
                    "FileShareURL": {
                        "type": "String",
                        "defaultValue": "FileServer-URL"
                    },
                    "FileShareUserID": {
                        "type": "String"
                    },
                    "FileSharePassword": {
                        "type": "String",
                        "defaultValue": "FileServer-ServiceAccount-Password"
                    }
                },
                "folder": {
                    "name": "Curated"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/util-download-schema-file-from-default')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "EP-Download-Schema",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "util-download-schema-file",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                },
                                "FileShareURL": "FileServer-URL",
                                "FileShareUserID": {
                                    "value": "123/*@pipeline().globalParameters.FileServerUserID*/",
                                    "type": "Expression"
                                },
                                "FileSharePassword": "FileServer-ServiceAccount-Password",
                                "SourceFolder": "In"
                            }
                        }
                    }
                ],
                "parameters": {
                    "TaskDetails": {
                        "type": "object"
                    }
                },
                "folder": {
                    "name": "Utility"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/util-download-schema-file')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-Excel-Source-Load')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Get File Metadata",
                        "type": "GetMetadata",
                        "dependsOn": [
                            {
                                "activity": "Set-FileSharePassword",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Set-FileShareUserID",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Set-FileShareURL",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Set-SourceFolder",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "BINARY_FILESERVER",
                                "type": "DatasetReference",
                                "parameters": {
                                    "FileShareUserID": {
                                        "value": "@variables('FileShareUserID')",
                                        "type": "Expression"
                                    },
                                    "Folder": {
                                        "value": "@variables('SourceFolder')",
                                        "type": "Expression"
                                    },
                                    "File": {
                                        "value": "@pipeline().parameters.TaskDetails.Command",
                                        "type": "Expression"
                                    },
                                    "FileShareURL": {
                                        "value": "@variables('FileShareURL')",
                                        "type": "Expression"
                                    },
                                    "FileSharePassword": {
                                        "value": "@variables('FileSharePassword')",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "fieldList": [
                                "exists"
                            ],
                            "storeSettings": {
                                "type": "FileServerReadSettings",
                                "recursive": true
                            },
                            "formatSettings": {
                                "type": "BinaryReadSettings"
                            }
                        }
                    },
                    {
                        "name": "If File Exists",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Get File Metadata",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@activity('Get File Metadata').output.exists",
                                "type": "Expression"
                            },
                            "ifTrueActivities": [
                                {
                                    "name": "Get Full File Name",
                                    "type": "Lookup",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "source": {
                                            "type": "AzureSqlSource",
                                            "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                            "storedProcedureParameters": {
                                                "DeltaExtract": {
                                                    "type": "Boolean",
                                                    "value": {
                                                        "value": "@pipeline().parameters.TaskDetails.DeltaExtract",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "FileName": {
                                                    "type": "String",
                                                    "value": {
                                                        "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "FolderName": {
                                                    "type": "String",
                                                    "value": {
                                                        "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "Grain": {
                                                    "type": "String",
                                                    "value": {
                                                        "value": "@pipeline().parameters.TaskDetails.ObjectGrain",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "Compressed": {
                                                    "type": "Boolean",
                                                    "value": {
                                                        "value": "false",
                                                        "type": "Expression"
                                                    }
                                                },
                                                "TargetType": {
                                                    "type": "String",
                                                    "value": {
                                                        "value": "@pipeline().parameters.TaskDetails.TargetType",
                                                        "type": "Expression"
                                                    }
                                                }
                                            },
                                            "partitionOption": "None"
                                        },
                                        "dataset": {
                                            "referenceName": "AzureSqlDatabase_Ctrldb",
                                            "type": "DatasetReference",
                                            "parameters": {}
                                        },
                                        "firstRowOnly": true
                                    }
                                },
                                {
                                    "name": "Copy Excel File",
                                    "type": "Copy",
                                    "dependsOn": [
                                        {
                                            "activity": "Get Full File Name",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        },
                                        {
                                            "activity": "EP-Download-File",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        },
                                        {
                                            "activity": "EP-Download-Schema",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "source": {
                                            "type": "ExcelSource",
                                            "storeSettings": {
                                                "type": "AzureBlobStorageReadSettings",
                                                "recursive": true
                                            }
                                        },
                                        "sink": {
                                            "type": "DelimitedTextSink",
                                            "storeSettings": {
                                                "type": "AzureBlobStorageWriteSettings"
                                            },
                                            "formatSettings": {
                                                "type": "DelimitedTextWriteSettings",
                                                "quoteAllText": true,
                                                "fileExtension": ".txt"
                                            }
                                        },
                                        "enableStaging": false
                                    },
                                    "inputs": [
                                        {
                                            "referenceName": "SRC_EXCEL",
                                            "type": "DatasetReference",
                                            "parameters": {
                                                "FileName": {
                                                    "value": "@pipeline().parameters.TaskDetails.Command",
                                                    "type": "Expression"
                                                },
                                                "SheetName": {
                                                    "value": "@pipeline().parameters.TaskDetails.AdditionalProperty",
                                                    "type": "Expression"
                                                },
                                                "Container": {
                                                    "value": "@variables('StageContainer')",
                                                    "type": "Expression"
                                                },
                                                "Folder": {
                                                    "value": "@variables('StageFolder')",
                                                    "type": "Expression"
                                                }
                                            }
                                        }
                                    ],
                                    "outputs": [
                                        {
                                            "referenceName": "RAW_ADLS_CSV",
                                            "type": "DatasetReference",
                                            "parameters": {
                                                "BlobPath": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                    "type": "Expression"
                                                },
                                                "BlobName": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "Compression": "none"
                                            }
                                        }
                                    ]
                                },
                                {
                                    "name": "Log Notebook Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "Execute-DB-Load-Delta-Table",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "Error running Databricks Noebook",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Log Copy Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "Copy Excel File",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "File Copy Error",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "SP-Record-Manifest",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "Copy Excel File",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                                        "storedProcedureParameters": {
                                            "BatchExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Container": {
                                                "value": "raw",
                                                "type": "String"
                                            },
                                            "EndCounter": {
                                                "value": {
                                                    "value": "0",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FileName": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FolderName": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "Records": {
                                                "value": {
                                                    "value": "@activity('Copy Excel File').output.rowsCopied",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "SourceObject": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "StartCounter": {
                                                "value": {
                                                    "value": "0",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "TaskExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "DeltaColumn": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.WatermarkColumn",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "PipelineRunID": {
                                                "value": {
                                                    "value": "@pipeline().RunId",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Log Manifest Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Record-Manifest",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "Databricks Error has occured",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Log Archive Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-Archive-ExcelFile",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "File Archive Error has occured",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Execute-DB-Load-Delta-Table",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Record-Manifest",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-DL-Load-Raw-to-Delta-Table",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Archive-ExcelFile",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "Execute-DB-Load-Delta-Table",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "util-datalake-move-file",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "SourceFolder": {
                                                "value": "@variables('StageFolder')",
                                                "type": "Expression"
                                            },
                                            "SourceFile": {
                                                "value": "@pipeline().parameters.TaskDetails.Command",
                                                "type": "Expression"
                                            },
                                            "SourceContainer": {
                                                "value": "@variables('StageContainer')",
                                                "type": "Expression"
                                            },
                                            "TargetContainer": "raw",
                                            "DeleteFile": true,
                                            "TargetFolder": {
                                                "value": "@replace(activity('Get Full File Name').output.firstRow.StorageFolder, 'csv', 'archive')",
                                                "type": "Expression"
                                            },
                                            "TargetFile": {
                                                "value": "@replace(activity('Get Full File Name').output.firstRow.StorageFile, 'csv', 'xlsx')",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Download-Schema",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "util-download-schema-file",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "FileShareURL": {
                                                "value": "@variables('FileShareURL')",
                                                "type": "Expression"
                                            },
                                            "FileShareUserID": {
                                                "value": "@variables('FileShareUserID')",
                                                "type": "Expression"
                                            },
                                            "FileSharePassword": {
                                                "value": "@variables('FileSharePassword')",
                                                "type": "Expression"
                                            },
                                            "SourceFolder": {
                                                "value": "@variables('SourceFolder')",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Download-File",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "util-fileserver-download-file",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "TargetFolder": {
                                                "value": "@variables('StageFolder')",
                                                "type": "Expression"
                                            },
                                            "TargetContainer": {
                                                "value": "@variables('StageContainer')",
                                                "type": "Expression"
                                            },
                                            "DeleteFile": false,
                                            "SourceFile": {
                                                "value": "@pipeline().parameters.TaskDetails.Command",
                                                "type": "Expression"
                                            },
                                            "TargetFile": {
                                                "value": "@pipeline().parameters.TaskDetails.Command",
                                                "type": "Expression"
                                            },
                                            "SourceFolder": {
                                                "value": "@variables('SourceFolder')",
                                                "type": "Expression"
                                            },
                                            "FileShareURL": {
                                                "value": "@variables('FileShareURL')",
                                                "type": "Expression"
                                            },
                                            "FileShareUserID": {
                                                "value": "@variables('FileShareUserID')",
                                                "type": "Expression"
                                            },
                                            "FileSharePassword": {
                                                "value": "@variables('FileSharePassword')",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "Log File Download Error",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-Download-Schema",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "Error Downloading File",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Log Schema Download Error",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-Download-File",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "Error Downloading Schema File",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Delete-Source",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "Execute-DB-Load-Delta-Table",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "util-fileserver-delete-file",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "SourceFile": {
                                                "value": "@pipeline().parameters.TaskDetails.Command",
                                                "type": "Expression"
                                            },
                                            "SourceFolder": {
                                                "value": "@variables('SourceFolder')",
                                                "type": "Expression"
                                            },
                                            "FileShareURL": {
                                                "value": "@variables('FileShareURL')",
                                                "type": "Expression"
                                            },
                                            "FileShareUserID": {
                                                "value": "@variables('FileShareUserID')",
                                                "type": "Expression"
                                            },
                                            "FileSharePassword": {
                                                "value": "@variables('FileSharePassword')",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "Log Delete Source Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-Delete-Source",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "Source File Delete Error has occured",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Log Text Load Success",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "If File Exists",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": null,
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.LastLoadedFile",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Success",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Set-FileShareURL",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "FileShareURL",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[0]",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Set-FileShareUserID",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "FileShareUserID",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[1]",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Set-FileSharePassword",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "FileSharePassword",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[2]",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Set-SourceFolder",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "SourceFolder",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[3]",
                                "type": "Expression"
                            }
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "int"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "StageContainer": {
                        "type": "String",
                        "defaultValue": "external"
                    },
                    "StageFolder": {
                        "type": "String",
                        "defaultValue": "stage"
                    },
                    "FileShareURL": {
                        "type": "String"
                    },
                    "FileShareUserID": {
                        "type": "String"
                    },
                    "FileSharePassword": {
                        "type": "String"
                    },
                    "SourceFolder": {
                        "type": "String",
                        "defaultValue": "In"
                    }
                },
                "folder": {
                    "name": "Excel"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/util-download-schema-file')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-Text-Source-Load')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Get File Metadata",
                        "type": "GetMetadata",
                        "dependsOn": [
                            {
                                "activity": "Set-FileSharePassword",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Set-FileShareUserID",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Set-FileShareURL",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Set-SourceFolder",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "dataset": {
                                "referenceName": "BINARY_FILESERVER",
                                "type": "DatasetReference",
                                "parameters": {
                                    "FileShareUserID": {
                                        "value": "@variables('FileShareUserID')",
                                        "type": "Expression"
                                    },
                                    "Folder": {
                                        "value": "@variables('SourceFolder')",
                                        "type": "Expression"
                                    },
                                    "File": {
                                        "value": "@toLower('')",
                                        "type": "Expression"
                                    },
                                    "FileShareURL": {
                                        "value": "@variables('FileShareURL')",
                                        "type": "Expression"
                                    },
                                    "FileSharePassword": {
                                        "value": "@variables('FileSharePassword')",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "fieldList": [
                                "childItems"
                            ],
                            "storeSettings": {
                                "type": "FileServerReadSettings",
                                "recursive": true
                            },
                            "formatSettings": {
                                "type": "BinaryReadSettings"
                            }
                        }
                    },
                    {
                        "name": "Log Text Load Success",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Loop-All-Files",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": null,
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.LastLoadedFile",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Success",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Loop-All-Files",
                        "type": "ForEach",
                        "dependsOn": [
                            {
                                "activity": "Get File Metadata",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "items": {
                                "value": "@activity('Get File Metadata').output.childItems",
                                "type": "Expression"
                            },
                            "isSequential": true,
                            "activities": [
                                {
                                    "name": "If File Exists",
                                    "type": "IfCondition",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-FileName",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "expression": {
                                            "value": "@and(\nstartswith(item().name, pipeline().parameters.TaskDetails.Command)\n,equals(item().type,'File')\n)",
                                            "type": "Expression"
                                        },
                                        "ifTrueActivities": [
                                            {
                                                "name": "Get Full File Name",
                                                "type": "Lookup",
                                                "dependsOn": [],
                                                "policy": {
                                                    "timeout": "7.00:00:00",
                                                    "retry": 0,
                                                    "retryIntervalInSeconds": 30,
                                                    "secureOutput": false,
                                                    "secureInput": false
                                                },
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "source": {
                                                        "type": "AzureSqlSource",
                                                        "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                                        "storedProcedureParameters": {
                                                            "DeltaExtract": {
                                                                "type": "Boolean",
                                                                "value": {
                                                                    "value": "@pipeline().parameters.TaskDetails.DeltaExtract",
                                                                    "type": "Expression"
                                                                }
                                                            },
                                                            "FileName": {
                                                                "type": "String",
                                                                "value": {
                                                                    "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                                                    "type": "Expression"
                                                                }
                                                            },
                                                            "FolderName": {
                                                                "type": "String",
                                                                "value": {
                                                                    "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                                                    "type": "Expression"
                                                                }
                                                            },
                                                            "Grain": {
                                                                "type": "String",
                                                                "value": {
                                                                    "value": "@pipeline().parameters.TaskDetails.ObjectGrain",
                                                                    "type": "Expression"
                                                                }
                                                            },
                                                            "Compressed": {
                                                                "type": "Boolean",
                                                                "value": {
                                                                    "value": "false",
                                                                    "type": "Expression"
                                                                }
                                                            },
                                                            "TargetType": {
                                                                "type": "String",
                                                                "value": {
                                                                    "value": "@pipeline().parameters.TaskDetails.TargetType",
                                                                    "type": "Expression"
                                                                }
                                                            }
                                                        },
                                                        "partitionOption": "None"
                                                    },
                                                    "dataset": {
                                                        "referenceName": "AzureSqlDatabase_Ctrldb",
                                                        "type": "DatasetReference",
                                                        "parameters": {}
                                                    },
                                                    "firstRowOnly": true
                                                }
                                            },
                                            {
                                                "name": "Copy Text File",
                                                "type": "Copy",
                                                "dependsOn": [
                                                    {
                                                        "activity": "Get Full File Name",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    },
                                                    {
                                                        "activity": "EP-Download-File",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    },
                                                    {
                                                        "activity": "EP-Download-Schema",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    },
                                                    {
                                                        "activity": "Set-FileEncoding",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    },
                                                    {
                                                        "activity": "Set-ColumnDelim",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    }
                                                ],
                                                "policy": {
                                                    "timeout": "7.00:00:00",
                                                    "retry": 0,
                                                    "retryIntervalInSeconds": 30,
                                                    "secureOutput": false,
                                                    "secureInput": false
                                                },
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "source": {
                                                        "type": "DelimitedTextSource",
                                                        "storeSettings": {
                                                            "type": "AzureBlobStorageReadSettings",
                                                            "recursive": true
                                                        },
                                                        "formatSettings": {
                                                            "type": "DelimitedTextReadSettings"
                                                        }
                                                    },
                                                    "sink": {
                                                        "type": "DelimitedTextSink",
                                                        "storeSettings": {
                                                            "type": "AzureBlobStorageWriteSettings"
                                                        },
                                                        "formatSettings": {
                                                            "type": "DelimitedTextWriteSettings",
                                                            "quoteAllText": true,
                                                            "fileExtension": ".txt"
                                                        }
                                                    },
                                                    "enableStaging": false
                                                },
                                                "inputs": [
                                                    {
                                                        "referenceName": "SRC_TEXT_FILE",
                                                        "type": "DatasetReference",
                                                        "parameters": {
                                                            "FileName": {
                                                                "value": "@variables('FileName')",
                                                                "type": "Expression"
                                                            },
                                                            "FileEncoding": {
                                                                "value": "@variables('FileEncoding')",
                                                                "type": "Expression"
                                                            },
                                                            "Container": {
                                                                "value": "@variables('StageContainer')",
                                                                "type": "Expression"
                                                            },
                                                            "Folder": {
                                                                "value": "@variables('StageFolder')",
                                                                "type": "Expression"
                                                            },
                                                            "ColumnDelim": {
                                                                "value": "@variables('ColumnDelim')",
                                                                "type": "Expression"
                                                            }
                                                        }
                                                    }
                                                ],
                                                "outputs": [
                                                    {
                                                        "referenceName": "RAW_ADLS_CSV",
                                                        "type": "DatasetReference",
                                                        "parameters": {
                                                            "BlobPath": {
                                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                                "type": "Expression"
                                                            },
                                                            "BlobName": {
                                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                                "type": "Expression"
                                                            },
                                                            "Compression": "none"
                                                        }
                                                    }
                                                ]
                                            },
                                            {
                                                "name": "Log Notebook Failure",
                                                "type": "SqlServerStoredProcedure",
                                                "dependsOn": [
                                                    {
                                                        "activity": "Execute-DB-Load-Delta-Table",
                                                        "dependencyConditions": [
                                                            "Failed"
                                                        ]
                                                    }
                                                ],
                                                "policy": {
                                                    "timeout": "7.00:00:00",
                                                    "retry": 0,
                                                    "retryIntervalInSeconds": 30,
                                                    "secureOutput": false,
                                                    "secureInput": false
                                                },
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                                    "storedProcedureParameters": {
                                                        "BatchLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.BatchLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "ErrorMessage": {
                                                            "value": {
                                                                "value": "Databricks Error has occured",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "ExecutionLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "Output": {
                                                            "value": null,
                                                            "type": "String"
                                                        },
                                                        "Status": {
                                                            "value": "Failure",
                                                            "type": "String"
                                                        },
                                                        "TaskId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        }
                                                    }
                                                },
                                                "linkedServiceName": {
                                                    "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                                    "type": "LinkedServiceReference",
                                                    "parameters": {
                                                        "kvSecret": "AzureSqlDatabase-ControlDB"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Log Copy Failure",
                                                "type": "SqlServerStoredProcedure",
                                                "dependsOn": [
                                                    {
                                                        "activity": "Copy Text File",
                                                        "dependencyConditions": [
                                                            "Failed"
                                                        ]
                                                    }
                                                ],
                                                "policy": {
                                                    "timeout": "7.00:00:00",
                                                    "retry": 0,
                                                    "retryIntervalInSeconds": 30,
                                                    "secureOutput": false,
                                                    "secureInput": false
                                                },
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                                    "storedProcedureParameters": {
                                                        "BatchLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.BatchLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "ErrorMessage": {
                                                            "value": {
                                                                "value": "File Copy Error",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "ExecutionLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "Output": {
                                                            "value": null,
                                                            "type": "String"
                                                        },
                                                        "Status": {
                                                            "value": "Failure",
                                                            "type": "String"
                                                        },
                                                        "TaskId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        }
                                                    }
                                                },
                                                "linkedServiceName": {
                                                    "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                                    "type": "LinkedServiceReference",
                                                    "parameters": {
                                                        "kvSecret": "AzureSqlDatabase-ControlDB"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "SP-Record-Manifest",
                                                "type": "SqlServerStoredProcedure",
                                                "dependsOn": [
                                                    {
                                                        "activity": "Copy Text File",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    }
                                                ],
                                                "policy": {
                                                    "timeout": "7.00:00:00",
                                                    "retry": 0,
                                                    "retryIntervalInSeconds": 30,
                                                    "secureOutput": false,
                                                    "secureInput": false
                                                },
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                                                    "storedProcedureParameters": {
                                                        "BatchExecutionLogID": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.BatchLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "Container": {
                                                            "value": "raw",
                                                            "type": "String"
                                                        },
                                                        "EndCounter": {
                                                            "value": {
                                                                "value": "0",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "FileName": {
                                                            "value": {
                                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "FolderName": {
                                                            "value": {
                                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "Records": {
                                                            "value": {
                                                                "value": "@activity('Copy Text File').output.rowsCopied",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "SourceObject": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskDetails.SourceName",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "StartCounter": {
                                                            "value": {
                                                                "value": "@convertTimeZone(utcnow(), 'UTC', 'AUS Eastern Standard Time', 's')",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "TaskExecutionLogID": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "DeltaColumn": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskDetails.WatermarkColumn",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "PipelineRunID": {
                                                            "value": {
                                                                "value": "@pipeline().RunId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        }
                                                    }
                                                },
                                                "linkedServiceName": {
                                                    "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                                    "type": "LinkedServiceReference",
                                                    "parameters": {
                                                        "kvSecret": "AzureSqlDatabase-ControlDB"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Log Manifest Failure",
                                                "type": "SqlServerStoredProcedure",
                                                "dependsOn": [
                                                    {
                                                        "activity": "SP-Record-Manifest",
                                                        "dependencyConditions": [
                                                            "Failed"
                                                        ]
                                                    }
                                                ],
                                                "policy": {
                                                    "timeout": "7.00:00:00",
                                                    "retry": 0,
                                                    "retryIntervalInSeconds": 30,
                                                    "secureOutput": false,
                                                    "secureInput": false
                                                },
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                                    "storedProcedureParameters": {
                                                        "BatchLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.BatchLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "ErrorMessage": {
                                                            "value": {
                                                                "value": "Databricks Error has occured",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "ExecutionLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "Output": {
                                                            "value": null,
                                                            "type": "String"
                                                        },
                                                        "Status": {
                                                            "value": "Failure",
                                                            "type": "String"
                                                        },
                                                        "TaskId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        }
                                                    }
                                                },
                                                "linkedServiceName": {
                                                    "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                                    "type": "LinkedServiceReference",
                                                    "parameters": {
                                                        "kvSecret": "AzureSqlDatabase-ControlDB"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Log Archive Failure",
                                                "type": "SqlServerStoredProcedure",
                                                "dependsOn": [
                                                    {
                                                        "activity": "EP-Archive-File",
                                                        "dependencyConditions": [
                                                            "Failed"
                                                        ]
                                                    }
                                                ],
                                                "policy": {
                                                    "timeout": "7.00:00:00",
                                                    "retry": 0,
                                                    "retryIntervalInSeconds": 30,
                                                    "secureOutput": false,
                                                    "secureInput": false
                                                },
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                                    "storedProcedureParameters": {
                                                        "BatchLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.BatchLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "ErrorMessage": {
                                                            "value": {
                                                                "value": "File Archive Error has occured",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "ExecutionLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "Output": {
                                                            "value": null,
                                                            "type": "String"
                                                        },
                                                        "Status": {
                                                            "value": "Failure",
                                                            "type": "String"
                                                        },
                                                        "TaskId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        }
                                                    }
                                                },
                                                "linkedServiceName": {
                                                    "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                                    "type": "LinkedServiceReference",
                                                    "parameters": {
                                                        "kvSecret": "AzureSqlDatabase-ControlDB"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Execute-DB-Load-Delta-Table",
                                                "type": "ExecutePipeline",
                                                "dependsOn": [
                                                    {
                                                        "activity": "SP-Record-Manifest",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    }
                                                ],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "pipeline": {
                                                        "referenceName": "04-DL-Load-Raw-to-Delta-Table",
                                                        "type": "PipelineReference"
                                                    },
                                                    "waitOnCompletion": true,
                                                    "parameters": {
                                                        "BatchLogId": {
                                                            "value": "@pipeline().parameters.BatchLogId",
                                                            "type": "Expression"
                                                        },
                                                        "TaskExecutionLogId": {
                                                            "value": "@pipeline().parameters.TaskExecutionLogId",
                                                            "type": "Expression"
                                                        },
                                                        "TaskDetails": {
                                                            "value": "@pipeline().parameters.TaskDetails",
                                                            "type": "Expression"
                                                        },
                                                        "TargetBLOBFolder": {
                                                            "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                            "type": "Expression"
                                                        },
                                                        "TargetBLOBName": {
                                                            "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                            "type": "Expression"
                                                        },
                                                        "ProjectRunID": {
                                                            "value": "@pipeline().parameters.ProjectRunID",
                                                            "type": "Expression"
                                                        }
                                                    }
                                                }
                                            },
                                            {
                                                "name": "EP-Archive-File",
                                                "type": "ExecutePipeline",
                                                "dependsOn": [
                                                    {
                                                        "activity": "Execute-DB-Load-Delta-Table",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    }
                                                ],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "pipeline": {
                                                        "referenceName": "util-datalake-move-file",
                                                        "type": "PipelineReference"
                                                    },
                                                    "waitOnCompletion": true,
                                                    "parameters": {
                                                        "SourceFolder": {
                                                            "value": "@variables('StageFolder')",
                                                            "type": "Expression"
                                                        },
                                                        "SourceFile": {
                                                            "value": "@variables('FileName')",
                                                            "type": "Expression"
                                                        },
                                                        "SourceContainer": {
                                                            "value": "@variables('StageContainer')",
                                                            "type": "Expression"
                                                        },
                                                        "TargetContainer": "raw",
                                                        "DeleteFile": true,
                                                        "TargetFolder": {
                                                            "value": "@replace(activity('Get Full File Name').output.firstRow.StorageFolder, 'csv', 'archive')",
                                                            "type": "Expression"
                                                        },
                                                        "TargetFile": {
                                                            "value": "@activity('Get Full File Name').output.firstRow.StorageFile",
                                                            "type": "Expression"
                                                        }
                                                    }
                                                }
                                            },
                                            {
                                                "name": "EP-Download-Schema",
                                                "type": "ExecutePipeline",
                                                "dependsOn": [],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "pipeline": {
                                                        "referenceName": "util-download-schema-file",
                                                        "type": "PipelineReference"
                                                    },
                                                    "waitOnCompletion": true,
                                                    "parameters": {
                                                        "TaskDetails": {
                                                            "value": "@pipeline().parameters.TaskDetails",
                                                            "type": "Expression"
                                                        },
                                                        "FileShareURL": {
                                                            "value": "@variables('FileShareURL')",
                                                            "type": "Expression"
                                                        },
                                                        "FileShareUserID": {
                                                            "value": "@variables('FileShareUserID')",
                                                            "type": "Expression"
                                                        },
                                                        "FileSharePassword": {
                                                            "value": "@variables('FileSharePassword')",
                                                            "type": "Expression"
                                                        },
                                                        "SourceFolder": {
                                                            "value": "@variables('SourceFolder')",
                                                            "type": "Expression"
                                                        }
                                                    }
                                                }
                                            },
                                            {
                                                "name": "EP-Download-File",
                                                "type": "ExecutePipeline",
                                                "dependsOn": [],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "pipeline": {
                                                        "referenceName": "util-fileserver-download-file",
                                                        "type": "PipelineReference"
                                                    },
                                                    "waitOnCompletion": true,
                                                    "parameters": {
                                                        "TargetFolder": {
                                                            "value": "@variables('StageFolder')",
                                                            "type": "Expression"
                                                        },
                                                        "TargetContainer": {
                                                            "value": "@variables('StageContainer')",
                                                            "type": "Expression"
                                                        },
                                                        "DeleteFile": false,
                                                        "SourceFile": {
                                                            "value": "@variables('FileName')",
                                                            "type": "Expression"
                                                        },
                                                        "TargetFile": {
                                                            "value": "@variables('FileName')",
                                                            "type": "Expression"
                                                        },
                                                        "SourceFolder": {
                                                            "value": "@variables('SourceFolder')",
                                                            "type": "Expression"
                                                        },
                                                        "FileShareURL": {
                                                            "value": "@variables('FileShareURL')",
                                                            "type": "Expression"
                                                        },
                                                        "FileShareUserID": {
                                                            "value": "@variables('FileShareUserID')",
                                                            "type": "Expression"
                                                        },
                                                        "FileSharePassword": {
                                                            "value": "@variables('FileSharePassword')",
                                                            "type": "Expression"
                                                        }
                                                    }
                                                }
                                            },
                                            {
                                                "name": "EP-Delete-Source",
                                                "type": "ExecutePipeline",
                                                "dependsOn": [
                                                    {
                                                        "activity": "Execute-DB-Load-Delta-Table",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    }
                                                ],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "pipeline": {
                                                        "referenceName": "util-fileserver-delete-file",
                                                        "type": "PipelineReference"
                                                    },
                                                    "waitOnCompletion": true,
                                                    "parameters": {
                                                        "SourceFile": {
                                                            "value": "@variables('FileName')",
                                                            "type": "Expression"
                                                        },
                                                        "SourceFolder": {
                                                            "value": "@variables('SourceFolder')",
                                                            "type": "Expression"
                                                        },
                                                        "FileShareURL": {
                                                            "value": "@variables('FileShareURL')",
                                                            "type": "Expression"
                                                        },
                                                        "FileShareUserID": {
                                                            "value": "@variables('FileShareUserID')",
                                                            "type": "Expression"
                                                        },
                                                        "FileSharePassword": {
                                                            "value": "@variables('FileSharePassword')",
                                                            "type": "Expression"
                                                        }
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Log Delete Source Failure",
                                                "type": "SqlServerStoredProcedure",
                                                "dependsOn": [
                                                    {
                                                        "activity": "EP-Delete-Source",
                                                        "dependencyConditions": [
                                                            "Failed"
                                                        ]
                                                    }
                                                ],
                                                "policy": {
                                                    "timeout": "7.00:00:00",
                                                    "retry": 0,
                                                    "retryIntervalInSeconds": 30,
                                                    "secureOutput": false,
                                                    "secureInput": false
                                                },
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                                    "storedProcedureParameters": {
                                                        "BatchLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.BatchLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "ErrorMessage": {
                                                            "value": {
                                                                "value": "Source File Delete Error has occured",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "ExecutionLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "Output": {
                                                            "value": null,
                                                            "type": "String"
                                                        },
                                                        "Status": {
                                                            "value": "Failure",
                                                            "type": "String"
                                                        },
                                                        "TaskId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        }
                                                    }
                                                },
                                                "linkedServiceName": {
                                                    "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                                    "type": "LinkedServiceReference",
                                                    "parameters": {
                                                        "kvSecret": "AzureSqlDatabase-ControlDB"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Log File Download Error",
                                                "type": "SqlServerStoredProcedure",
                                                "dependsOn": [
                                                    {
                                                        "activity": "EP-Download-File",
                                                        "dependencyConditions": [
                                                            "Failed"
                                                        ]
                                                    }
                                                ],
                                                "policy": {
                                                    "timeout": "7.00:00:00",
                                                    "retry": 0,
                                                    "retryIntervalInSeconds": 30,
                                                    "secureOutput": false,
                                                    "secureInput": false
                                                },
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                                    "storedProcedureParameters": {
                                                        "BatchLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.BatchLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "ErrorMessage": {
                                                            "value": {
                                                                "value": "Error Downloading File",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "ExecutionLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "Output": {
                                                            "value": null,
                                                            "type": "String"
                                                        },
                                                        "Status": {
                                                            "value": "Failure",
                                                            "type": "String"
                                                        },
                                                        "TaskId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        }
                                                    }
                                                },
                                                "linkedServiceName": {
                                                    "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                                    "type": "LinkedServiceReference",
                                                    "parameters": {
                                                        "kvSecret": "AzureSqlDatabase-ControlDB"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Log Schema Download Error",
                                                "type": "SqlServerStoredProcedure",
                                                "dependsOn": [
                                                    {
                                                        "activity": "EP-Download-Schema",
                                                        "dependencyConditions": [
                                                            "Failed"
                                                        ]
                                                    }
                                                ],
                                                "policy": {
                                                    "timeout": "7.00:00:00",
                                                    "retry": 0,
                                                    "retryIntervalInSeconds": 30,
                                                    "secureOutput": false,
                                                    "secureInput": false
                                                },
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                                    "storedProcedureParameters": {
                                                        "BatchLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.BatchLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "ErrorMessage": {
                                                            "value": {
                                                                "value": "Error Downloading Schema File",
                                                                "type": "Expression"
                                                            },
                                                            "type": "String"
                                                        },
                                                        "ExecutionLogId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        },
                                                        "Output": {
                                                            "value": null,
                                                            "type": "String"
                                                        },
                                                        "Status": {
                                                            "value": "Failure",
                                                            "type": "String"
                                                        },
                                                        "TaskId": {
                                                            "value": {
                                                                "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                                "type": "Expression"
                                                            },
                                                            "type": "Int64"
                                                        }
                                                    }
                                                },
                                                "linkedServiceName": {
                                                    "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                                    "type": "LinkedServiceReference",
                                                    "parameters": {
                                                        "kvSecret": "AzureSqlDatabase-ControlDB"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Set-ColumnDelim",
                                                "type": "SetVariable",
                                                "dependsOn": [
                                                    {
                                                        "activity": "Set-Prop-Length",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    }
                                                ],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "variableName": "ColumnDelim",
                                                    "value": {
                                                        "value": "@if(\n\tequals(variables('PropArray')[0], '')\n\t,','\n\t,variables('PropArray')[0]\n)\n",
                                                        "type": "Expression"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Set-FileEncoding",
                                                "type": "SetVariable",
                                                "dependsOn": [
                                                    {
                                                        "activity": "Set-Prop-Length",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    }
                                                ],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "variableName": "FileEncoding",
                                                    "value": {
                                                        "value": "@if(\n\tgreaterOrEquals(int(variables('PropLength')) , 2)\n\t,variables('PropArray')[1]\n\t,'UTF-8'\n)\n",
                                                        "type": "Expression"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Set-Properties",
                                                "type": "SetVariable",
                                                "dependsOn": [],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "variableName": "PropArray",
                                                    "value": {
                                                        "value": "@split(pipeline().parameters.TaskDetails.AdditionalProperty,'--')",
                                                        "type": "Expression"
                                                    }
                                                }
                                            },
                                            {
                                                "name": "Set-Prop-Length",
                                                "type": "SetVariable",
                                                "dependsOn": [
                                                    {
                                                        "activity": "Set-Properties",
                                                        "dependencyConditions": [
                                                            "Succeeded"
                                                        ]
                                                    }
                                                ],
                                                "userProperties": [],
                                                "typeProperties": {
                                                    "variableName": "PropLength",
                                                    "value": {
                                                        "value": "@string(length(variables('PropArray')))",
                                                        "type": "Expression"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "SET-FileName",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "FileName",
                                        "value": {
                                            "value": "@item().name",
                                            "type": "Expression"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Set-FileShareURL",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "FileShareURL",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[0]",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Set-FileShareUserID",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "FileShareUserID",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[1]",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Set-FileSharePassword",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "FileSharePassword",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[2]",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "Set-SourceFolder",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "SourceFolder",
                            "value": {
                                "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[3]",
                                "type": "Expression"
                            }
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "TaskDetails": {
                        "type": "object",
                        "defaultValue": {
                            "Command": "taleo_1_requisition_master",
                            "SourceType": "Flat File",
                            "SourceServer": "",
                            "SourceName": "taleo_requisition_master",
                            "SourceLocation": "requisition_master",
                            "AdditionalProperty": "",
                            "Processor": "databricks-token|1028-231358-piles213|Standard_DS3_v2|6.4.x-scala2.11|2:8|interactive",
                            "IsAuditTable": false,
                            "SoftDeleteSource": "",
                            "ProjectName": "ONDEMAND",
                            "TargetType": "BLOB Storage (csv)",
                            "TargetName": "taleo_requisition_master",
                            "TargetLocation": "taleo/requisition_master",
                            "TargetServer": "datalake-SasToken",
                            "DataLoadMode": "TRUNCATE-LOAD",
                            "DeltaExtract": false,
                            "CDCSource": false,
                            "TruncateTarget": true,
                            "UpsertTarget": false,
                            "TrackChanges": false,
                            "LoadToSqlEDW": true,
                            "TaskName": "taleo_requisition_master",
                            "ControlStageId": 1,
                            "TaskId": 1146,
                            "StageSequence": 100,
                            "StageName": "Source to Raw",
                            "SourceId": 1184,
                            "TargetId": 1163,
                            "ObjectGrain": "Day",
                            "CommandTypeId": 5,
                            "Watermarks": null,
                            "WatermarksDT": null,
                            "WatermarkColumn": "",
                            "BusinessKeyColumn": "",
                            "LastLoadedFile": null
                        }
                    },
                    "TaskExecutionLogId": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "FileEncoding": {
                        "type": "String"
                    },
                    "StageContainer": {
                        "type": "String",
                        "defaultValue": "external"
                    },
                    "StageFolder": {
                        "type": "String",
                        "defaultValue": "stage"
                    },
                    "ColumnDelim": {
                        "type": "String"
                    },
                    "PropArray": {
                        "type": "Array"
                    },
                    "PropLength": {
                        "type": "String"
                    },
                    "FileName": {
                        "type": "String"
                    },
                    "FileShareURL": {
                        "type": "String"
                    },
                    "FileShareUserID": {
                        "type": "String"
                    },
                    "FileSharePassword": {
                        "type": "String"
                    },
                    "SourceFolder": {
                        "type": "String",
                        "defaultValue": "In"
                    }
                },
                "folder": {
                    "name": "Text"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/util-download-schema-file')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-MySQL-A-Source Load')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Check Delta Load",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Get-Table-Values",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Execute-Generate-Schema",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.TaskDetails.DeltaExtract,true)",
                                "type": "Expression"
                            },
                            "ifFalseActivities": [
                                {
                                    "name": "Log Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Full",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Log Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Full",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "Some error occured",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-SQL-Copy-Full",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-MySQL-B-Source-Copy",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "SourceSQL": {
                                                "value": "@pipeline().parameters.TaskDetails.Command",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "StartCounter": "0",
                                            "EndCounter": "0",
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@activity('Get-Table-Values').output.firstRow",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ],
                            "ifTrueActivities": [
                                {
                                    "name": "Task Log Failure Copy",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Delta",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Watermark Task Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Update-Watermark",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Watermark Task Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Update-Watermark",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-SQL-Copy-Delta",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Delta-SQL",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-MySQL-B-Source-Copy",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "SourceSQL": {
                                                "value": "@variables('DeltaSQL')",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "StartCounter": {
                                                "value": "@pipeline().parameters.TaskDetails.Watermarks",
                                                "type": "Expression"
                                            },
                                            "EndCounter": {
                                                "value": "@activity('Get-Table-Values').output.firstRow.ReturnValue",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@activity('Get-Table-Values').output.firstRow",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Delta-SQL",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Watermark-Value",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "DeltaSQL",
                                        "value": {
                                            "value": "@replace(pipeline().parameters.TaskDetails.Command, '<<ENDDATE>>', variables('WatermarkValue'))",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SP-Update-Watermark",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Delta",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[updateWatermarks]",
                                        "storedProcedureParameters": {
                                            "SourceId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Watermark": {
                                                "value": {
                                                    "value": "@variables('WatermarkValue')",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Watermark-Value",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "WatermarkValue",
                                        "value": {
                                            "value": "@if(\n equals(coalesce(activity('Get-Table-Values').output.firstRow.ReturnValue, 0), 0)\n ,'1970-01-01 00:00:00'\n ,replace(activity('Get-Table-Values').output.firstRow.ReturnValue, '\\', ' ')\n)",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "Task Log Failure-Watermark Value SET",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Watermark-Value",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Get Full File Name",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                "storedProcedureParameters": {
                                    "DeltaExtract": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.DeltaExtract",
                                            "type": "Expression"
                                        }
                                    },
                                    "FileName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "FolderName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "Grain": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.ObjectGrain",
                                            "type": "Expression"
                                        }
                                    },
                                    "Compressed": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "true",
                                            "type": "Expression"
                                        }
                                    },
                                    "TargetType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Execute-Generate-Schema",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "04-MySQL-Generate-Source-Schema",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Task Log Failure Schema",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Execute-Generate-Schema",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred while generating schema",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Task Log Failure FileName",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred while getting file name",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Get-Table-SQL",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetTableDetails]",
                                "storedProcedureParameters": {
                                    "SourceId": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceId",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Get-Table-Values",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "Get-Table-SQL",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "MySqlSource",
                                "query": {
                                    "value": "@activity('Get-Table-SQL').output.firstrow.SQLStatement",
                                    "type": "Expression"
                                }
                            },
                            "dataset": {
                                "referenceName": "SRC_MySQL",
                                "type": "DatasetReference",
                                "parameters": {
                                    "kvSecret": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceServer",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Task Log Failure-Watermark Values",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Get-Table-Values",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int",
                        "defaultValue": 1
                    },
                    "TaskDetails": {
                        "type": "object",
                        "defaultValue": {
                            "SourceType": "MySQL",
                            "SourceServer": "LMS-clms",
                            "SourceName": "LMS_lmsuu_mdl_assign_grades",
                            "SourceLocation": "lmsuu.mdl_assign_grades",
                            "AdditionalProperty": "",
                            "Processor": "databricks-token|0708-233111-note225|Standard_DS3_v2|6.4.x-scala2.11|2:8",
                            "IsAuditTable": false,
                            "SoftDeleteSource": "",
                            "ProjectName": "LMS",
                            "ProjectId": 37,
                            "TargetType": "BLOB Storage (json)",
                            "TargetName": "LMS_lmsuu_mdl_assign_grades",
                            "TargetLocation": "LMS/lmsuu_mdl_assign_grades",
                            "TargetServer": "datalake-SasToken",
                            "DataLoadMode": "INCREMENTAL",
                            "DeltaExtract": true,
                            "CDCSource": false,
                            "TruncateTarget": false,
                            "UpsertTarget": true,
                            "TrackChanges": true,
                            "LoadToSqlEDW": true,
                            "TaskName": "LMS_lmsuu_mdl_assign_grades",
                            "ControlStageId": 1,
                            "TaskId": 1218,
                            "StageSequence": 100,
                            "StageName": "Source to Raw",
                            "SourceId": 1256,
                            "TargetId": 1235,
                            "ObjectGrain": "Day",
                            "CommandTypeId": 16,
                            "Watermarks": "2000-01-01 00:00:00",
                            "WatermarksDT": "2000-01-01T00:00:00Z",
                            "WatermarkColumn": "TIMEMODIFIED, TIMECREATED",
                            "BusinessKeyColumn": "ID",
                            "UpdateMetaData": false,
                            "Command": "SELECT * FROM lmsuu.mdl_assign_grades",
                            "LastLoadedFile": null
                        }
                    },
                    "TaskExecutionLogId": {
                        "type": "int",
                        "defaultValue": 1
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "OutputFileName": {
                        "type": "String"
                    },
                    "DeltaSQL": {
                        "type": "String"
                    },
                    "WatermarkValue": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "MySQL"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/04-MySQL-B-Source-Copy')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-Oracle-A-Source Load')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Check Delta Load",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Execute-Generate-Schema",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Get-Table-Values",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.TaskDetails.DeltaExtract,true)",
                                "type": "Expression"
                            },
                            "ifFalseActivities": [
                                {
                                    "name": "Log Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-Oracle-Copy-Full",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Log Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-Oracle-Copy-Full",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "Some error occured",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Oracle-Copy-Full",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-Oracle-B-Source-Copy",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "SourceSQL": {
                                                "value": "@pipeline().parameters.TaskDetails.Command",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@activity('Get-Table-Values').output.firstRow",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ],
                            "ifTrueActivities": [
                                {
                                    "name": "Task Log Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-Oracle-Copy-Delta",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Watermark Task Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Update-Watermark",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred while updating Watermark",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Task Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Update-Watermark",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Oracle-Copy-Delta",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Delta-SQL",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-Oracle-B-Source-Copy",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "SourceSQL": {
                                                "value": "@variables('DeltaSQL')",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@activity('Get-Table-Values').output.firstRow",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Delta-SQL",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Watermark-Value",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "DeltaSQL",
                                        "value": {
                                            "value": "@replace(pipeline().parameters.TaskDetails.Command, '<<ENDDATE>>', variables('WatermarkValue'))",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SP-Update-Watermark",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-Oracle-Copy-Delta",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[updateWatermarks]",
                                        "storedProcedureParameters": {
                                            "SourceId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Watermark": {
                                                "value": {
                                                    "value": "@variables('WatermarkValue')",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Watermark-Value",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "WatermarkValue",
                                        "value": {
                                            "value": "@replace(activity('Get-Table-Values').output.firstRow.ReturnValue, '\\', ' ')",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "Task Log Failure-Watermark Value SET",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Watermark-Value",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Get Full File Name",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                "storedProcedureParameters": {
                                    "DeltaExtract": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.DeltaExtract",
                                            "type": "Expression"
                                        }
                                    },
                                    "FileName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "FolderName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "Grain": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.ObjectGrain",
                                            "type": "Expression"
                                        }
                                    },
                                    "Compressed": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "true",
                                            "type": "Expression"
                                        }
                                    },
                                    "TargetType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Execute-Generate-Schema",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "04-Oracle-Generate-Source-Schema",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Task Log Failure Schema",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Execute-Generate-Schema",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred while generating schema",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Task Log Failure FileName",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred while getting file name",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Get-Table-SQL",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetTableDetails]",
                                "storedProcedureParameters": {
                                    "SourceId": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceId",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Get-Table-Values",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "Get-Table-SQL",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "OracleSource",
                                "oracleReaderQuery": {
                                    "value": "@activity('Get-Table-SQL').output.firstrow.SQLStatement",
                                    "type": "Expression"
                                },
                                "partitionOption": "None",
                                "queryTimeout": "02:00:00"
                            },
                            "dataset": {
                                "referenceName": "SRC_Oracle",
                                "type": "DatasetReference",
                                "parameters": {
                                    "kvSecret": "@pipeline().parameters.TaskDetails.SourceServer"
                                }
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Task Log Failure-Watermark Values",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Get-Table-Values",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "int"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "OutputFileName": {
                        "type": "String"
                    },
                    "DeltaSQL": {
                        "type": "String"
                    },
                    "WatermarkValue": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Oracle"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/04-Oracle-B-Source-Copy')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-SQLServer-A-Source Load')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Check Delta Load",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Get-Table-Values",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Execute-Generate-Schema",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.TaskDetails.DeltaExtract,true)",
                                "type": "Expression"
                            },
                            "ifFalseActivities": [
                                {
                                    "name": "Log Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Full",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Log Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Full",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "Some error occured",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-SQL-Copy-Full",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-SQLServer-B-Source-Copy",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "SourceSQL": {
                                                "value": "@pipeline().parameters.TaskDetails.Command",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@activity('Get-Table-Values').output.firstRow",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ],
                            "ifTrueActivities": [
                                {
                                    "name": "Task Log Failure Copy",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Delta",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Watermark Task Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Update-Watermark",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred while updating Watermark",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Task Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Update-Watermark",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-SQL-Copy-Delta",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Delta-SQL",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-SQLServer-B-Source-Copy",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "SourceSQL": {
                                                "value": "@variables('DeltaSQL')",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@activity('Get-Table-Values').output.firstRow",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Delta-SQL",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Watermark-Value",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "DeltaSQL",
                                        "value": {
                                            "value": "@replace(pipeline().parameters.TaskDetails.Command, '<<ENDDATE>>', variables('WatermarkValue'))",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SP-Update-Watermark",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Delta",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[updateWatermarks]",
                                        "storedProcedureParameters": {
                                            "SourceId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Watermark": {
                                                "value": {
                                                    "value": "@variables('WatermarkValue')",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Watermark-Value",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "WatermarkValue",
                                        "value": {
                                            "value": "@replace(activity('Get-Table-Values').output.firstRow.ReturnValue, '\\', ' ')",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "Task Log Failure-Watermark Value SET",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Watermark-Value",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Get Full File Name",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                "storedProcedureParameters": {
                                    "DeltaExtract": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.DeltaExtract",
                                            "type": "Expression"
                                        }
                                    },
                                    "FileName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "FolderName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "Grain": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.ObjectGrain",
                                            "type": "Expression"
                                        }
                                    },
                                    "Compressed": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "true",
                                            "type": "Expression"
                                        }
                                    },
                                    "TargetType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Execute-Generate-Schema",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "04-SQLServer-Generate-Source-Schema",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Task Log Failure Schema",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Execute-Generate-Schema",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred while generating schema",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Task Log Failure FileName",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred while getting file name",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Get-Table-SQL",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetTableDetails]",
                                "storedProcedureParameters": {
                                    "SourceId": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceId",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Get-Table-Values",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "Get-Table-SQL",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlServerSource",
                                "sqlReaderQuery": {
                                    "value": "@activity('Get-Table-SQL').output.firstrow.SQLStatement",
                                    "type": "Expression"
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "SRC_SQLServer",
                                "type": "DatasetReference",
                                "parameters": {
                                    "kvSecret": "@pipeline().parameters.TaskDetails.SourceServer"
                                }
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Task Log Failure-Watermark Values",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Get-Table-Values",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "int"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "OutputFileName": {
                        "type": "String"
                    },
                    "DeltaSQL": {
                        "type": "String"
                    },
                    "WatermarkValue": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "SQL Server"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/04-SQLServer-B-Source-Copy')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-SQLAzure-A-Source Load')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Check Delta Load",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Get-Table-Values",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Execute-Generate-Schema",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.TaskDetails.DeltaExtract,true)",
                                "type": "Expression"
                            },
                            "ifFalseActivities": [
                                {
                                    "name": "Log Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Full",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Log Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Full",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "Some error occured",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-SQL-Copy-Full",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-SQLAzure-B-Source-Copy",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "SourceSQL": {
                                                "value": "@pipeline().parameters.TaskDetails.Command",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@activity('Get-Table-Values').output.firstRow",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                }
                            ],
                            "ifTrueActivities": [
                                {
                                    "name": "Task Log Failure Copy",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Delta",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Watermark Task Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Update-Watermark",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred while updating Watermark",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Task Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Update-Watermark",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-SQL-Copy-Delta",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Delta-SQL",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-SQLAzure-B-Source-Copy",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "SourceSQL": {
                                                "value": "@variables('DeltaSQL')",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "ValidationDetails": {
                                                "value": "@activity('Get-Table-Values').output.firstRow",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Delta-SQL",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Watermark-Value",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "DeltaSQL",
                                        "value": {
                                            "value": "@replace(pipeline().parameters.TaskDetails.Command, '<<ENDDATE>>', variables('WatermarkValue'))",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SP-Update-Watermark",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Delta",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[updateWatermarks]",
                                        "storedProcedureParameters": {
                                            "SourceId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Watermark": {
                                                "value": {
                                                    "value": "@variables('WatermarkValue')",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Watermark-Value",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "WatermarkValue",
                                        "value": {
                                            "value": "@replace(activity('Get-Table-Values').output.firstRow.ReturnValue, '\\', ' ')",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "Task Log Failure-Watermark Value SET",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Watermark-Value",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Get Full File Name",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                "storedProcedureParameters": {
                                    "DeltaExtract": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.DeltaExtract",
                                            "type": "Expression"
                                        }
                                    },
                                    "FileName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "FolderName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "Grain": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.ObjectGrain",
                                            "type": "Expression"
                                        }
                                    },
                                    "Compressed": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "true",
                                            "type": "Expression"
                                        }
                                    },
                                    "TargetType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Execute-Generate-Schema",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "04-SQLAzure-Generate-Source-Schema",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Task Log Failure Schema",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Execute-Generate-Schema",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred while generating schema",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Task Log Failure FileName",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred while getting file name",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Get-Table-SQL",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetTableDetails]",
                                "storedProcedureParameters": {
                                    "SourceId": {
                                        "type": "Int64",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceId",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Get-Table-Values",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "Get-Table-SQL",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SqlServerSource",
                                "sqlReaderQuery": {
                                    "value": "@activity('Get-Table-SQL').output.firstrow.SQLStatement",
                                    "type": "Expression"
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "SRC_SQLAzure",
                                "type": "DatasetReference",
                                "parameters": {
                                    "kvSecret": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceServer",
                                        "type": "Expression"
                                    }
                                }
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Task Log Failure-Watermark Values",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Get-Table-Values",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "An Error Occurred",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "int"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "OutputFileName": {
                        "type": "String"
                    },
                    "DeltaSQL": {
                        "type": "String"
                    },
                    "WatermarkValue": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "SQL Azure"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-28T02:30:08Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/04-SQLAzure-B-Source-Copy')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/06-Curated-Main')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "LU-ProcessingPeriod",
                        "type": "Lookup",
                        "dependsOn": [
                            {
                                "activity": "Set-ClusterType",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[CuratedGetProcessingPeriod]",
                                "storedProcedureParameters": {
                                    "Project": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "SubjectArea": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "queryTimeout": "02:00:00",
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            }
                        }
                    },
                    {
                        "name": "Log Success",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SP-Log-Curated-End",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": null,
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": "Curated Load Complete",
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Success",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "SP-Log-Curated-Start",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "LU-ProcessingPeriod",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[CuratedLogStart]",
                            "storedProcedureParameters": {
                                "BatchExecutionLogID": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "EndPeriod": {
                                    "value": {
                                        "value": "@activity('LU-ProcessingPeriod').output.firstRow.ProcessingEndDate",
                                        "type": "Expression"
                                    },
                                    "type": "DateTime"
                                },
                                "Project": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "StartPeriod": {
                                    "value": {
                                        "value": "@activity('LU-ProcessingPeriod').output.firstRow.ProcessingStartDate",
                                        "type": "Expression"
                                    },
                                    "type": "DateTime"
                                },
                                "SubjectArea": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "TaskExecutionLogID": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "SP-Log-Curated-End",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SW-Project-Custom",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[CuratedLogComplete]",
                            "storedProcedureParameters": {
                                "BatchExecutionLogID": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "TaskExecutionLogID": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Log DB Failure LU Processing",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "LU-ProcessingPeriod",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Error Occurred during Curated load on Lookup for Processing Period",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Log DB Failure SP Processing Start",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SP-Log-Curated-Start",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Error Occurred during Curated load on SP for Processing Period",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Set-ClusterType",
                        "type": "SetVariable",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "variableName": "ClusterType",
                            "value": {
                                "value": "@toLower(last(split(pipeline().parameters.TaskDetails.Processor,'|')))",
                                "type": "Expression"
                            }
                        }
                    },
                    {
                        "name": "If-Cluster-Interactive",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "SP-Log-Curated-Start",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(variables('ClusterType'), 'interactive')",
                                "type": "Expression"
                            },
                            "ifFalseActivities": [
                                {
                                    "name": "DB-Load-Curated-Job",
                                    "type": "DatabricksNotebook",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "notebookPath": {
                                            "value": "@pipeline().parameters.TaskDetails.Command",
                                            "type": "Expression"
                                        },
                                        "baseParameters": {
                                            "start_date": {
                                                "value": "@activity('LU-ProcessingPeriod').output.firstRow.ProcessingStartDate",
                                                "type": "Expression"
                                            },
                                            "end_date": {
                                                "value": "@activity('LU-ProcessingPeriod').output.firstRow.ProcessingEndDate",
                                                "type": "Expression"
                                            }
                                        },
                                        "libraries": [
                                            {
                                                "maven": {
                                                    "coordinates": "com.microsoft.azure:azure-sqldb-spark:1.0.2"
                                                }
                                            }
                                        ]
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureDatabricks_JobCluster",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": {
                                                "value": "@split(pipeline().parameters.TaskDetails.Processor,'|')[0]",
                                                "type": "Expression"
                                            },
                                            "DataBricksClusterType": {
                                                "value": "@split(pipeline().parameters.TaskDetails.Processor,'|')[2]",
                                                "type": "Expression"
                                            },
                                            "DataBricksClusterVersion": {
                                                "value": "@split(pipeline().parameters.TaskDetails.Processor,'|')[3]",
                                                "type": "Expression"
                                            },
                                            "DataBricksWorkerNodes": {
                                                "value": "@split(pipeline().parameters.TaskDetails.Processor,'|')[4]",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "SET-ReturnValue-Job",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "DB-Load-Curated-Job",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "NoteBookReturnValue",
                                        "value": {
                                            "value": "@if(contains(activity('DB-Load-Curated-Job').output, 'runOutput'),\nstring(activity('DB-Load-Curated-Job').output.runOutput), '')",
                                            "type": "Expression"
                                        }
                                    }
                                }
                            ],
                            "ifTrueActivities": [
                                {
                                    "name": "DB-Load-Curated-Interactive",
                                    "type": "DatabricksNotebook",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "notebookPath": {
                                            "value": "@pipeline().parameters.TaskDetails.Command",
                                            "type": "Expression"
                                        },
                                        "baseParameters": {
                                            "start_date": {
                                                "value": "@activity('LU-ProcessingPeriod').output.firstRow.ProcessingStartDate",
                                                "type": "Expression"
                                            },
                                            "end_date": {
                                                "value": "@activity('LU-ProcessingPeriod').output.firstRow.ProcessingEndDate",
                                                "type": "Expression"
                                            }
                                        },
                                        "libraries": [
                                            {
                                                "maven": {
                                                    "coordinates": "com.microsoft.azure:azure-sqldb-spark:1.0.2"
                                                }
                                            }
                                        ]
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureDatabricks_DefinedCluster",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": {
                                                "value": "@split(pipeline().parameters.TaskDetails.Processor,'|')[0]",
                                                "type": "Expression"
                                            },
                                            "clusterId": {
                                                "value": "@split(pipeline().parameters.TaskDetails.Processor,'|')[1]",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "SET-ReturnValue-Interactive",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "DB-Load-Curated-Interactive",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "NoteBookReturnValue",
                                        "value": {
                                            "value": "@if(contains(activity('DB-Load-Curated-Interactive').output, 'runOutput'),\nstring(activity('DB-Load-Curated-Interactive').output.runOutput), '')",
                                            "type": "Expression"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Log DB Failure SP Curated End",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SP-Log-Curated-End",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Error Occurred during Curated load on SP End",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Log DB Failure Curated",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "If-Cluster-Interactive",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Error Occurred during Curated load on DataBricks",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "SW-Project-Custom",
                        "type": "Switch",
                        "dependsOn": [
                            {
                                "activity": "If-Cluster-Interactive",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "on": {
                                "value": "@pipeline().parameters.TaskDetails.ProjectName",
                                "type": "Expression"
                            },
                            "cases": [
                                {
                                    "value": "Qualtrics",
                                    "activities": [
                                        {
                                            "name": "EP-Qualtrics",
                                            "type": "ExecutePipeline",
                                            "dependsOn": [],
                                            "userProperties": [],
                                            "typeProperties": {
                                                "pipeline": {
                                                    "referenceName": "06-Curated-Qualtrics",
                                                    "type": "PipelineReference"
                                                },
                                                "waitOnCompletion": true,
                                                "parameters": {
                                                    "TaskDetails": {
                                                        "value": "@pipeline().parameters.TaskDetails",
                                                        "type": "Expression"
                                                    },
                                                    "NotebookOutput": {
                                                        "value": "@variables('NoteBookReturnValue')",
                                                        "type": "Expression"
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                },
                                {
                                    "value": "UMD",
                                    "activities": [
                                        {
                                            "name": "EP-UMD",
                                            "type": "ExecutePipeline",
                                            "dependsOn": [],
                                            "userProperties": [],
                                            "typeProperties": {
                                                "pipeline": {
                                                    "referenceName": "06-Curated-UMD",
                                                    "type": "PipelineReference"
                                                },
                                                "waitOnCompletion": true,
                                                "parameters": {}
                                            }
                                        }
                                    ]
                                },
                                {
                                    "value": "NATAvetmiss",
                                    "activities": [
                                        {
                                            "name": "EP-NAT-Avetmiss",
                                            "type": "ExecutePipeline",
                                            "dependsOn": [],
                                            "userProperties": [],
                                            "typeProperties": {
                                                "pipeline": {
                                                    "referenceName": "06-Curated-NAT",
                                                    "type": "PipelineReference"
                                                },
                                                "waitOnCompletion": true,
                                                "parameters": {
                                                    "TaskDetails": {
                                                        "value": "@pipeline().parameters.TaskDetails",
                                                        "type": "Expression"
                                                    },
                                                    "NotebookOutput": {
                                                        "value": "@variables('NoteBookReturnValue')",
                                                        "type": "Expression"
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                },
                                {
                                    "value": "NATEReporting",
                                    "activities": [
                                        {
                                            "name": "EP-NAT-eReporting",
                                            "type": "ExecutePipeline",
                                            "dependsOn": [],
                                            "userProperties": [],
                                            "typeProperties": {
                                                "pipeline": {
                                                    "referenceName": "06-Curated-NAT",
                                                    "type": "PipelineReference"
                                                },
                                                "waitOnCompletion": true,
                                                "parameters": {
                                                    "TaskDetails": {
                                                        "value": "@pipeline().parameters.TaskDetails",
                                                        "type": "Expression"
                                                    },
                                                    "NotebookOutput": {
                                                        "value": "@variables('NoteBookReturnValue')",
                                                        "type": "Expression"
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    },
                    {
                        "name": "Log Custom Action Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SW-Project-Custom",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Error Occurred during Curated Custom Action",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    }
                ],
                "parameters": {
                    "TaskDetails": {
                        "type": "object",
                        "defaultValue": {
                            "SourceType": "BLOB Storage (csv)",
                            "SourceServer": "datalake-SasToken",
                            "SourceName": "Qualtrics_Qualtrics",
                            "SourceLocation": "Qualtrics",
                            "AdditionalProperty": "",
                            "Processor": "databricks-token|0925-064956-carps143|Standard_DS5_v2|6.4.x-scala2.11|2:8|interactive",
                            "ProjectName": "Qualtrics1",
                            "TargetType": "SQL Server",
                            "TargetName": "Qualtrics_Qualtrics",
                            "TargetLocation": "Qualtrics",
                            "TargetServer": "AzureSqlDatabase-SQLDB",
                            "DataLoadMode": "0",
                            "DeltaExtract": null,
                            "CDCSource": null,
                            "TruncateTarget": null,
                            "UpsertTarget": null,
                            "TrackChanges": false,
                            "LoadToSqlEDW": true,
                            "TaskName": "Qualtrics_Qualtrics",
                            "ControlStageId": 3,
                            "TaskId": 813,
                            "StageSequence": 300,
                            "StageName": "Trusted to Curated",
                            "SourceId": 851,
                            "TargetId": 830,
                            "ObjectGrain": "Day",
                            "CommandTypeId": 8,
                            "Watermarks": null,
                            "WatermarksDT": null,
                            "WatermarkColumn": "",
                            "BusinessKeyColumn": "",
                            "Command": "/Users/rahul.agrawal1@tafenswtest.edu.au/build/curated/Qualtrics/QualtricsMaster-Test",
                            "LastLoadedFile": null
                        }
                    },
                    "TaskExecutionLogId": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "BatchLogId": {
                        "type": "int",
                        "defaultValue": 0
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "ClusterType": {
                        "type": "String"
                    },
                    "NoteBookReturnValue": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "Curated"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:08Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/06-Curated-NAT')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-ODataAADSP-Source-Load')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Log Text Load Success",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Execute-DB-Load-Delta-Table",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": null,
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.LastLoadedFile",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Success",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Copy OData Source",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "ODataSource",
                                "httpRequestTimeout": "00:05:00"
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobStorageWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false
                        },
                        "inputs": [
                            {
                                "referenceName": "RAW_ODATA_AADSP_JSON",
                                "type": "DatasetReference",
                                "parameters": {
                                    "UserName": {
                                        "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[0]",
                                        "type": "Expression"
                                    },
                                    "Password": {
                                        "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[1]",
                                        "type": "Expression"
                                    },
                                    "BaseUrl": {
                                        "value": "@pipeline().parameters.TaskDetails.Command",
                                        "type": "Expression"
                                    },
                                    "Table": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "RAW_ADLS_JSON",
                                "type": "DatasetReference",
                                "parameters": {
                                    "BlobPath": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                        "type": "Expression"
                                    },
                                    "BlobName": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "Log Copy Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy OData Source",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "API Copy Error",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "SP-Record-Manifest",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy OData Source",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                            "storedProcedureParameters": {
                                "BatchExecutionLogID": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Container": {
                                    "value": "raw",
                                    "type": "String"
                                },
                                "EndCounter": {
                                    "value": {
                                        "value": "0",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "FileName": {
                                    "value": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "FolderName": {
                                    "value": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "Records": {
                                    "value": {
                                        "value": "@activity('Copy OData Source').output.rowsCopied",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "SourceObject": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "StartCounter": {
                                    "value": {
                                        "value": "0",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "TaskExecutionLogID": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "DeltaColumn": {
                                    "value": null,
                                    "type": "String"
                                },
                                "PipelineRunID": {
                                    "value": {
                                        "value": "@pipeline().RunId",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Log Manifest Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SP-Record-Manifest",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Databricks Error has occured",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Execute-DB-Load-Delta-Table",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "SP-Record-Manifest",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "EP-Download-Schema-File",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "04-DL-Load-Raw-to-Delta-Table",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "BatchLogId": {
                                    "value": "@pipeline().parameters.BatchLogId",
                                    "type": "Expression"
                                },
                                "TaskExecutionLogId": {
                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                    "type": "Expression"
                                },
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                },
                                "TargetBLOBFolder": {
                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                    "type": "Expression"
                                },
                                "TargetBLOBName": {
                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                    "type": "Expression"
                                },
                                "ProjectRunID": {
                                    "value": "@pipeline().parameters.ProjectRunID",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Get Full File Name",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                "storedProcedureParameters": {
                                    "DeltaExtract": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.DeltaExtract",
                                            "type": "Expression"
                                        }
                                    },
                                    "FileName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "FolderName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "Grain": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.ObjectGrain",
                                            "type": "Expression"
                                        }
                                    },
                                    "Compressed": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "true",
                                            "type": "Expression"
                                        }
                                    },
                                    "TargetType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Log DataBricks Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Execute-DB-Load-Delta-Table",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Databricks Error",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "EP-Download-Schema-File",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "util-download-schema-file-from-default",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Log File Download Error",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "EP-Download-Schema-File",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Error Downloading File",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "int"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "OutputFileName": {
                        "type": "String"
                    },
                    "DeltaSQL": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "API"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:09Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/util-download-schema-file-from-default')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-REST-IRTAFE-Source-Load')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Check Delta Load",
                        "type": "IfCondition",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "expression": {
                                "value": "@equals(pipeline().parameters.TaskDetails.DeltaExtract,true)",
                                "type": "Expression"
                            },
                            "ifFalseActivities": [
                                {
                                    "name": "Log Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Full",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Log Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-SQL-Copy-Full",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "Some error occured",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-SQL-Copy-Full",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-SQLServer-B-Source-Copy",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "SourceSQL": {
                                                "value": "@pipeline().parameters.TaskDetails.Command",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "StartCounter": "0",
                                            "EndCounter": "0"
                                        }
                                    }
                                }
                            ],
                            "ifTrueActivities": [
                                {
                                    "name": "Task Log Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "Copy-API-Raw",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Watermark Task Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Update-Watermark",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Watermark Task Success",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Update-Watermark",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": "",
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Success",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "SP-Update-Watermark",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "Execute-DB-Load-Delta-Table",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[updateWatermarks]",
                                        "storedProcedureParameters": {
                                            "SourceId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Watermark": {
                                                "value": {
                                                    "value": "@variables('CurrentTime')",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Copy-API-Raw",
                                    "type": "Copy",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-RelativeURL",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        },
                                        {
                                            "activity": "LU-API-Params",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "source": {
                                            "type": "RestSource",
                                            "httpRequestTimeout": "00:05:00",
                                            "requestInterval": "00.00:00:00.010",
                                            "requestMethod": "GET",
                                            "paginationRules": {
                                                "AbsoluteUrl": {
                                                    "value": "@variables('PropNextTag')",
                                                    "type": "Expression"
                                                }
                                            }
                                        },
                                        "sink": {
                                            "type": "JsonSink",
                                            "storeSettings": {
                                                "type": "AzureBlobStorageWriteSettings"
                                            },
                                            "formatSettings": {
                                                "type": "JsonWriteSettings"
                                            }
                                        },
                                        "enableStaging": false,
                                        "translator": {
                                            "value": "@json(activity('LU-API-Params').output.firstRow.MappingInfo)",
                                            "type": "Expression"
                                        }
                                    },
                                    "inputs": [
                                        {
                                            "referenceName": "RAW_REST_IRTAFE_Basic",
                                            "type": "DatasetReference",
                                            "parameters": {
                                                "BaesUrl": {
                                                    "value": "@pipeline().parameters.TaskDetails.Command",
                                                    "type": "Expression"
                                                },
                                                "UserName": {
                                                    "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[0]",
                                                    "type": "Expression"
                                                },
                                                "SecretKey": {
                                                    "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[1]",
                                                    "type": "Expression"
                                                },
                                                "RelativeURL": {
                                                    "value": "@variables('RelativeURL')",
                                                    "type": "Expression"
                                                }
                                            }
                                        }
                                    ],
                                    "outputs": [
                                        {
                                            "referenceName": "RAW_ADLS_JSON",
                                            "type": "DatasetReference",
                                            "parameters": {
                                                "BlobPath": {
                                                    "value": "@activity('Get Full File Name').output.firstRow.StorageFolder",
                                                    "type": "Expression"
                                                },
                                                "BlobName": {
                                                    "value": "@activity('Get Full File Name').output.firstRow.StorageFile",
                                                    "type": "Expression"
                                                }
                                            }
                                        }
                                    ]
                                },
                                {
                                    "name": "SP-Record-Manifest",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "Copy-API-Raw",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                                        "storedProcedureParameters": {
                                            "BatchExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Container": {
                                                "value": "raw",
                                                "type": "String"
                                            },
                                            "EndCounter": {
                                                "value": {
                                                    "value": "@variables('CurrentTime')",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FileName": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstRow.StorageFile",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "FolderName": {
                                                "value": {
                                                    "value": "@activity('Get Full File Name').output.firstRow.StorageFolder",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "Records": {
                                                "value": {
                                                    "value": "@activity('Copy-API-Raw').output.rowsCopied",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "SourceObject": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.SourceName",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "StartCounter": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.Watermarks",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "TaskExecutionLogID": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "DeltaColumn": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.WatermarkColumn",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "PipelineRunID": {
                                                "value": {
                                                    "value": "@pipeline().RunId",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Execute-DB-Load-Delta-Table",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Record-Manifest",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        },
                                        {
                                            "activity": "EP-Download-Schema-File",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "04-DL-Load-Raw-to-Delta-Table",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "BatchLogId": {
                                                "value": "@pipeline().parameters.BatchLogId",
                                                "type": "Expression"
                                            },
                                            "TaskExecutionLogId": {
                                                "value": "@pipeline().parameters.TaskExecutionLogId",
                                                "type": "Expression"
                                            },
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBFolder": {
                                                "value": "@activity('Get Full File Name').output.firstRow.StorageFolder",
                                                "type": "Expression"
                                            },
                                            "TargetBLOBName": {
                                                "value": "@activity('Get Full File Name').output.firstRow.StorageFile",
                                                "type": "Expression"
                                            },
                                            "ProjectRunID": {
                                                "value": "@pipeline().parameters.ProjectRunID",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "SET-RelativeURL",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Prop-NextTag",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        },
                                        {
                                            "activity": "SET-Prop-FieldStart",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        },
                                        {
                                            "activity": "SET-Prop-FieldEnd",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        },
                                        {
                                            "activity": "SET-Prop-QSStatic",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        },
                                        {
                                            "activity": "SET-CurrentTime",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "RelativeURL",
                                        "value": {
                                            "value": "@concat(\n  pipeline().parameters.TaskDetails.SourceLocation,\n  '/',\n  '?',\n  variables('PropQSStatic'), '&',\n  variables('PropQSFieldStart'), '=', formatDateTime(pipeline().parameters.TaskDetails.WaterMarks,variables('PropTSFormat')), '&',\n  variables('PropQSFieldEnd'), '=', variables('CurrentTime'), '&'\n)",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "LU-API-Params",
                                    "type": "Lookup",
                                    "dependsOn": [],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "source": {
                                            "type": "AzureSqlSource",
                                            "sqlReaderStoredProcedureName": "[[CTL].[GetAPIParams]",
                                            "storedProcedureParameters": {
                                                "SourceId": {
                                                    "type": "Int64",
                                                    "value": {
                                                        "value": "@pipeline().parameters.TaskDetails.SourceId",
                                                        "type": "Expression"
                                                    }
                                                }
                                            },
                                            "queryTimeout": "02:00:00",
                                            "partitionOption": "None"
                                        },
                                        "dataset": {
                                            "referenceName": "AzureSqlDatabase_Ctrldb",
                                            "type": "DatasetReference",
                                            "parameters": {}
                                        }
                                    }
                                },
                                {
                                    "name": "Log Manifest Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SP-Record-Manifest",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "Databricks Error has occured",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-CurrentTime",
                                    "type": "SetVariable",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-Pro-TSFormat",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        },
                                        {
                                            "activity": "SET-Pro-TimeZone",
                                            "dependencyConditions": [
                                                "Succeeded"
                                            ]
                                        }
                                    ],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "CurrentTime",
                                        "value": {
                                            "value": "@formatDateTime(convertFromUtc(utcNow('o'), variables('PropTimeZone')), variables('PropTSFormat'))",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Prop-NextTag",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "PropNextTag",
                                        "value": {
                                            "value": "@split(pipeline().parameters.TaskDetails.AdditionalProperty, '|')[2]",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Prop-FieldStart",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "PropQSFieldStart",
                                        "value": {
                                            "value": "@split(pipeline().parameters.TaskDetails.AdditionalProperty, '|')[4]",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Prop-FieldEnd",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "PropQSFieldEnd",
                                        "value": {
                                            "value": "@split(pipeline().parameters.TaskDetails.AdditionalProperty, '|')[5]",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Pro-TSFormat",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "PropTSFormat",
                                        "value": {
                                            "value": "@split(pipeline().parameters.TaskDetails.AdditionalProperty, '|')[6]",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Prop-QSStatic",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "PropQSStatic",
                                        "value": {
                                            "value": "@split(pipeline().parameters.TaskDetails.AdditionalProperty, '|')[3]",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "SET-Pro-TimeZone",
                                    "type": "SetVariable",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "variableName": "PropTimeZone",
                                        "value": {
                                            "value": "@split(pipeline().parameters.TaskDetails.AdditionalProperty, '|')[7]",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                {
                                    "name": "Task Relative URL Failure",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "SET-RelativeURL",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred while setting Relative URL",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "Task API Params",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "LU-API-Params",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "An Error Occurred while getting API Params",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                },
                                {
                                    "name": "EP-Download-Schema-File",
                                    "type": "ExecutePipeline",
                                    "dependsOn": [],
                                    "userProperties": [],
                                    "typeProperties": {
                                        "pipeline": {
                                            "referenceName": "util-download-schema-file-from-default",
                                            "type": "PipelineReference"
                                        },
                                        "waitOnCompletion": true,
                                        "parameters": {
                                            "TaskDetails": {
                                                "value": "@pipeline().parameters.TaskDetails",
                                                "type": "Expression"
                                            }
                                        }
                                    }
                                },
                                {
                                    "name": "Log File Download Error",
                                    "type": "SqlServerStoredProcedure",
                                    "dependsOn": [
                                        {
                                            "activity": "EP-Download-Schema-File",
                                            "dependencyConditions": [
                                                "Failed"
                                            ]
                                        }
                                    ],
                                    "policy": {
                                        "timeout": "7.00:00:00",
                                        "retry": 0,
                                        "retryIntervalInSeconds": 30,
                                        "secureOutput": false,
                                        "secureInput": false
                                    },
                                    "userProperties": [],
                                    "typeProperties": {
                                        "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                                        "storedProcedureParameters": {
                                            "BatchLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.BatchLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "ErrorMessage": {
                                                "value": {
                                                    "value": "Error Downloading File",
                                                    "type": "Expression"
                                                },
                                                "type": "String"
                                            },
                                            "ExecutionLogId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            },
                                            "Output": {
                                                "value": null,
                                                "type": "String"
                                            },
                                            "Status": {
                                                "value": "Failure",
                                                "type": "String"
                                            },
                                            "TaskId": {
                                                "value": {
                                                    "value": "@pipeline().parameters.TaskDetails.TaskId",
                                                    "type": "Expression"
                                                },
                                                "type": "Int64"
                                            }
                                        }
                                    },
                                    "linkedServiceName": {
                                        "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                                        "type": "LinkedServiceReference",
                                        "parameters": {
                                            "kvSecret": "AzureSqlDatabase-ControlDB"
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    {
                        "name": "Get Full File Name",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                "storedProcedureParameters": {
                                    "DeltaExtract": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.DeltaExtract",
                                            "type": "Expression"
                                        }
                                    },
                                    "FileName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "FolderName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "Grain": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.ObjectGrain",
                                            "type": "Expression"
                                        }
                                    },
                                    "Compressed": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "true",
                                            "type": "Expression"
                                        }
                                    },
                                    "TargetType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": true
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int",
                        "defaultValue": 1
                    },
                    "TaskDetails": {
                        "type": "object",
                        "defaultValue": {
                            "SourceType": "API-TAFE",
                            "SourceServer": "API-VCPrexip-UserID|API-VCPrexip-Password",
                            "SourceName": "VCPrexip_participant",
                            "SourceLocation": "participant",
                            "AdditionalProperty": "av_id,bandwidth,call_direction,call_quality,call_uuid,conference,conference_name,conversation_id,disconnect_reason,display_name,duration,encryption,end_time,has_media,id,is_streaming,license_count,license_type,local_alias,media_node,parent_id,presentation_id,protocol,proxy_node,remote_address,remote_alias,remote_port,resource_uri,role,service_tag,service_type,signalling_node,start_time,system_location,vendor|$.objects|$.meta.next|limit=100000|end_time__gte|end_time__lt|yyyy-MM-ddTHH:mm:ss",
                            "Processor": "databricks-token|0708-233111-note225|Standard_DS3_v2|6.4.x-scala2.11|2:8",
                            "ProjectName": "ONDEMAND",
                            "TargetType": "BLOB Storage (json)",
                            "TargetName": "VCPrexip_participant",
                            "TargetLocation": "VCPrexip/participant",
                            "TargetServer": "datalake-SasToken",
                            "TargetDBSchema": null,
                            "DataLoadMode": "INCREMENTAL",
                            "DeltaExtract": true,
                            "CDCSource": false,
                            "TruncateTarget": false,
                            "UpsertTarget": true,
                            "TrackChanges": false,
                            "LoadToSqlEDW": true,
                            "TaskName": "VCPrexip_participant",
                            "ControlStageId": 1,
                            "TaskId": 584,
                            "StageSequence": 100,
                            "StageName": "Source to Raw",
                            "SourceId": 622,
                            "TargetId": 601,
                            "ObjectGrain": "Day",
                            "CommandTypeId": 14,
                            "Watermarks": "2020-09-11T16:28:50Z",
                            "WatermarksDT": "2020-09-11T16:28:50Z",
                            "WatermarkColumn": "end_time",
                            "BusinessKeyColumn": "id",
                            "Command": "https://manage.vc.tafensw.edu.au/api/admin/history/v1",
                            "LastLoadedFile": null
                        }
                    },
                    "TaskExecutionLogId": {
                        "type": "int",
                        "defaultValue": 1
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "RelativeURL": {
                        "type": "String"
                    },
                    "CurrentTime": {
                        "type": "String"
                    },
                    "PropNextTag": {
                        "type": "String"
                    },
                    "PropQSFieldStart": {
                        "type": "String"
                    },
                    "PropQSFieldEnd": {
                        "type": "String"
                    },
                    "PropTSFormat": {
                        "type": "String"
                    },
                    "PropQSStatic": {
                        "type": "String"
                    },
                    "PropTimeZone": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "API"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:09Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/04-SQLServer-B-Source-Copy')]",
                "[concat(variables('factoryId'), '/pipelines/util-download-schema-file-from-default')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-SharePoint-Source-Load')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Log Text Load Success",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Execute-DB-Load-Delta-Table",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": null,
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.LastLoadedFile",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Success",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Copy SharePoint Source",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "SharePointOnlineListSource",
                                "httpRequestTimeout": "00:05:00"
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobStorageWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false
                        },
                        "inputs": [
                            {
                                "referenceName": "RAW_SHAREPOINT_JSON",
                                "type": "DatasetReference",
                                "parameters": {
                                    "AppID": {
                                        "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[0]",
                                        "type": "Expression"
                                    },
                                    "AppSecret": {
                                        "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[1]",
                                        "type": "Expression"
                                    },
                                    "SiteURL": {
                                        "value": "@pipeline().parameters.TaskDetails.Command",
                                        "type": "Expression"
                                    },
                                    "ListName": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "RAW_ADLS_JSON",
                                "type": "DatasetReference",
                                "parameters": {
                                    "BlobPath": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                        "type": "Expression"
                                    },
                                    "BlobName": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "Log Copy Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy SharePoint Source",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "API Copy Error",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "SP-Record-Manifest",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy SharePoint Source",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                            "storedProcedureParameters": {
                                "BatchExecutionLogID": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Container": {
                                    "value": "raw",
                                    "type": "String"
                                },
                                "EndCounter": {
                                    "value": {
                                        "value": "0",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "FileName": {
                                    "value": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "FolderName": {
                                    "value": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "Records": {
                                    "value": {
                                        "value": "@activity('Copy SharePoint Source').output.rowsCopied",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "SourceObject": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "StartCounter": {
                                    "value": {
                                        "value": "0",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "TaskExecutionLogID": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "DeltaColumn": {
                                    "value": null,
                                    "type": "String"
                                },
                                "PipelineRunID": {
                                    "value": {
                                        "value": "@pipeline().RunId",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Log Manifest Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SP-Record-Manifest",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Databricks Error has occured",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Execute-DB-Load-Delta-Table",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "SP-Record-Manifest",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "EP-Download-Schema-File",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "04-DL-Load-Raw-to-Delta-Table",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "BatchLogId": {
                                    "value": "@pipeline().parameters.BatchLogId",
                                    "type": "Expression"
                                },
                                "TaskExecutionLogId": {
                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                    "type": "Expression"
                                },
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                },
                                "TargetBLOBFolder": {
                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                    "type": "Expression"
                                },
                                "TargetBLOBName": {
                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                    "type": "Expression"
                                },
                                "ProjectRunID": {
                                    "value": "@pipeline().parameters.ProjectRunID",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Get Full File Name",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                "storedProcedureParameters": {
                                    "DeltaExtract": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.DeltaExtract",
                                            "type": "Expression"
                                        }
                                    },
                                    "FileName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "FolderName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "Grain": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.ObjectGrain",
                                            "type": "Expression"
                                        }
                                    },
                                    "Compressed": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "true",
                                            "type": "Expression"
                                        }
                                    },
                                    "TargetType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Log DataBricks Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Execute-DB-Load-Delta-Table",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Databricks Error",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "EP-Download-Schema-File",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "util-download-schema-file-from-default",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Log File Download Error",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "EP-Download-Schema-File",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Error Downloading File",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "int"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "OutputFileName": {
                        "type": "String"
                    },
                    "DeltaSQL": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "SharePoint"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:09Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/util-download-schema-file-from-default')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/04-ODataBasic-Source-Load')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Log Text Load Success",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Execute-DB-Load-Delta-Table",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": null,
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.LastLoadedFile",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Success",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Copy OData Source",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "Get Full File Name",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "ODataSource",
                                "httpRequestTimeout": "00:05:00"
                            },
                            "sink": {
                                "type": "JsonSink",
                                "storeSettings": {
                                    "type": "AzureBlobStorageWriteSettings"
                                },
                                "formatSettings": {
                                    "type": "JsonWriteSettings"
                                }
                            },
                            "enableStaging": false
                        },
                        "inputs": [
                            {
                                "referenceName": "RAW_ODATA_BASIC_JSON",
                                "type": "DatasetReference",
                                "parameters": {
                                    "Username": {
                                        "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[0]",
                                        "type": "Expression"
                                    },
                                    "Password": {
                                        "value": "@split(pipeline().parameters.TaskDetails.SourceServer,'|')[1]",
                                        "type": "Expression"
                                    },
                                    "BaseUrl": {
                                        "value": "@pipeline().parameters.TaskDetails.Command",
                                        "type": "Expression"
                                    },
                                    "Table": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ],
                        "outputs": [
                            {
                                "referenceName": "RAW_ADLS_JSON",
                                "type": "DatasetReference",
                                "parameters": {
                                    "BlobPath": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                        "type": "Expression"
                                    },
                                    "BlobName": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                        "type": "Expression"
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "Log Copy Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy OData Source",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "API Copy Error",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "SP-Record-Manifest",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Copy OData Source",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[CreateManifestRecord]",
                            "storedProcedureParameters": {
                                "BatchExecutionLogID": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Container": {
                                    "value": "raw",
                                    "type": "String"
                                },
                                "EndCounter": {
                                    "value": {
                                        "value": "0",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "FileName": {
                                    "value": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "FolderName": {
                                    "value": {
                                        "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "Records": {
                                    "value": {
                                        "value": "@activity('Copy OData Source').output.rowsCopied",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "SourceObject": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.SourceName",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "StartCounter": {
                                    "value": {
                                        "value": "0",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "TaskExecutionLogID": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "DeltaColumn": {
                                    "value": null,
                                    "type": "String"
                                },
                                "PipelineRunID": {
                                    "value": {
                                        "value": "@pipeline().RunId",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Log Manifest Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SP-Record-Manifest",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Databricks Error has occured",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "Execute-DB-Load-Delta-Table",
                        "type": "ExecutePipeline",
                        "dependsOn": [
                            {
                                "activity": "SP-Record-Manifest",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "EP-Download-Schema-File",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "04-DL-Load-Raw-to-Delta-Table",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "BatchLogId": {
                                    "value": "@pipeline().parameters.BatchLogId",
                                    "type": "Expression"
                                },
                                "TaskExecutionLogId": {
                                    "value": "@pipeline().parameters.TaskExecutionLogId",
                                    "type": "Expression"
                                },
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                },
                                "TargetBLOBFolder": {
                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFolder",
                                    "type": "Expression"
                                },
                                "TargetBLOBName": {
                                    "value": "@activity('Get Full File Name').output.firstrow.StorageFile",
                                    "type": "Expression"
                                },
                                "ProjectRunID": {
                                    "value": "@pipeline().parameters.ProjectRunID",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Get Full File Name",
                        "type": "Lookup",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "source": {
                                "type": "AzureSqlSource",
                                "sqlReaderStoredProcedureName": "[[CTL].[GetStorageFileName]",
                                "storedProcedureParameters": {
                                    "DeltaExtract": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.DeltaExtract",
                                            "type": "Expression"
                                        }
                                    },
                                    "FileName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.SourceLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "FolderName": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetLocation",
                                            "type": "Expression"
                                        }
                                    },
                                    "Grain": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.ObjectGrain",
                                            "type": "Expression"
                                        }
                                    },
                                    "Compressed": {
                                        "type": "Boolean",
                                        "value": {
                                            "value": "true",
                                            "type": "Expression"
                                        }
                                    },
                                    "TargetType": {
                                        "type": "String",
                                        "value": {
                                            "value": "@pipeline().parameters.TaskDetails.TargetType",
                                            "type": "Expression"
                                        }
                                    }
                                },
                                "partitionOption": "None"
                            },
                            "dataset": {
                                "referenceName": "AzureSqlDatabase_Ctrldb",
                                "type": "DatasetReference",
                                "parameters": {}
                            },
                            "firstRowOnly": true
                        }
                    },
                    {
                        "name": "Log DataBricks Failure",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "Execute-DB-Load-Delta-Table",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Databricks Error",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    },
                    {
                        "name": "EP-Download-Schema-File",
                        "type": "ExecutePipeline",
                        "dependsOn": [],
                        "userProperties": [],
                        "typeProperties": {
                            "pipeline": {
                                "referenceName": "util-download-schema-file-from-default",
                                "type": "PipelineReference"
                            },
                            "waitOnCompletion": true,
                            "parameters": {
                                "TaskDetails": {
                                    "value": "@pipeline().parameters.TaskDetails",
                                    "type": "Expression"
                                }
                            }
                        }
                    },
                    {
                        "name": "Log File Download Error",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "EP-Download-Schema-File",
                                "dependencyConditions": [
                                    "Failed"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[CTL].[UpdateTaskLog]",
                            "storedProcedureParameters": {
                                "BatchLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.BatchLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "ErrorMessage": {
                                    "value": {
                                        "value": "Error Downloading File",
                                        "type": "Expression"
                                    },
                                    "type": "String"
                                },
                                "ExecutionLogId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskExecutionLogId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                },
                                "Output": {
                                    "value": null,
                                    "type": "String"
                                },
                                "Status": {
                                    "value": "Failure",
                                    "type": "String"
                                },
                                "TaskId": {
                                    "value": {
                                        "value": "@pipeline().parameters.TaskDetails.TaskId",
                                        "type": "Expression"
                                    },
                                    "type": "Int64"
                                }
                            }
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-ControlDB"
                            }
                        }
                    }
                ],
                "parameters": {
                    "BatchLogId": {
                        "type": "int"
                    },
                    "TaskDetails": {
                        "type": "object"
                    },
                    "TaskExecutionLogId": {
                        "type": "int"
                    },
                    "ProjectRunID": {
                        "type": "string"
                    }
                },
                "variables": {
                    "OutputFileName": {
                        "type": "String"
                    },
                    "DeltaSQL": {
                        "type": "String"
                    }
                },
                "folder": {
                    "name": "API"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:09Z"
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/pipelines/util-download-schema-file-from-default')]"
            ]
        }
    ]
}