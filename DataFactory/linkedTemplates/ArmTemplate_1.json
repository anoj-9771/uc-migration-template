{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "factoryName": {
            "type": "string",
            "metadata": "Data Factory name",
            "defaultValue": "ama-panel-adf-dp-dev-as-01"
        },
        "LS_SQLAzure_properties_typeProperties_connectionString_secretName": {
            "type": "string",
            "defaultValue": "@linkedService().kvSecret"
        }
    },
    "variables": {
        "factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
    },
    "resources": [
        {
            "name": "[concat(parameters('factoryName'), '/LS_SQLAzure')]",
            "type": "Microsoft.DataFactory/factories/linkedServices",
            "apiVersion": "2018-06-01",
            "properties": {
                "parameters": {
                    "kvSecret": {
                        "type": "string",
                        "defaultValue": "ADF-LS-SQLAzure-iBodyShop"
                    }
                },
                "annotations": [],
                "type": "SqlServer",
                "typeProperties": {
                    "connectionString": {
                        "type": "AzureKeyVaultSecret",
                        "store": {
                            "referenceName": "LS-AzureKeyVault",
                            "type": "LinkedServiceReference"
                        },
                        "secretName": {
                            "value": "[parameters('LS_SQLAzure_properties_typeProperties_connectionString_secretName')]",
                            "type": "Expression"
                        }
                    }
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/RAW_ODATA_AADSP_JSON')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS_ODataSource_AADSP",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "AppID": {
                            "value": "@dataset().UserName",
                            "type": "Expression"
                        },
                        "AppSecret": {
                            "value": "@dataset().Password",
                            "type": "Expression"
                        },
                        "BaseUrl": {
                            "value": "@dataset().BaseUrl",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "UserName": {
                        "type": "string"
                    },
                    "Password": {
                        "type": "string"
                    },
                    "BaseUrl": {
                        "type": "string"
                    },
                    "Table": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "ODataResource",
                "schema": [],
                "typeProperties": {
                    "path": {
                        "value": "@dataset().Table",
                        "type": "Expression"
                    }
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/DS_AZURE_SQLSERVER')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS-AzureSqlDatabase_SQLDB",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "kvSecret": {
                            "value": "@dataset().kvSecret",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "kvSecret": {
                        "type": "string"
                    },
                    "TableName": {
                        "type": "string"
                    },
                    "SchemaName": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [],
                "typeProperties": {
                    "schema": {
                        "value": "@dataset().SchemaName",
                        "type": "Expression"
                    },
                    "table": {
                        "value": "@dataset().TableName",
                        "type": "Expression"
                    }
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/SRC_AzureSqlDatabase')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS-AzureSqlDatabase_SQLDB",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "kvSecret": {
                            "value": "@dataset().kvSecret",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "kvSecret": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [],
                "typeProperties": {}
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/SRC_EXCEL')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS-AzureDataLake",
                    "type": "LinkedServiceReference"
                },
                "parameters": {
                    "FileName": {
                        "type": "string"
                    },
                    "SheetName": {
                        "type": "string"
                    },
                    "Container": {
                        "type": "string"
                    },
                    "Folder": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "Excel",
                "typeProperties": {
                    "sheetName": {
                        "value": "@dataset().SheetName",
                        "type": "Expression"
                    },
                    "location": {
                        "type": "AzureBlobStorageLocation",
                        "fileName": {
                            "value": "@dataset().FileName",
                            "type": "Expression"
                        },
                        "folderPath": {
                            "value": "@dataset().Folder",
                            "type": "Expression"
                        },
                        "container": {
                            "value": "@dataset().Container",
                            "type": "Expression"
                        }
                    },
                    "firstRowAsHeader": true
                },
                "schema": []
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/RAW_ADLS_CSV')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS-AzureDataLake",
                    "type": "LinkedServiceReference"
                },
                "parameters": {
                    "BlobPath": {
                        "type": "string"
                    },
                    "BlobName": {
                        "type": "string"
                    },
                    "Compression": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "DelimitedText",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobStorageLocation",
                        "fileName": {
                            "value": "@dataset().BlobName",
                            "type": "Expression"
                        },
                        "folderPath": {
                            "value": "@dataset().BlobPath",
                            "type": "Expression"
                        },
                        "container": "raw"
                    },
                    "columnDelimiter": "|",
                    "compressionCodec": {
                        "value": "@dataset().Compression",
                        "type": "Expression"
                    },
                    "compressionLevel": "Optimal",
                    "escapeChar": "\\",
                    "firstRowAsHeader": true,
                    "quoteChar": "\""
                },
                "schema": []
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/AzureSqlDatabase_Ctrldb')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS-AzureSqlDatabase_Ctrldb",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "kvSecret": "AzureSqlDatabase-ControlDB"
                    }
                },
                "annotations": [],
                "type": "AzureSqlTable",
                "schema": [],
                "typeProperties": {}
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/BINARY_FILESERVER')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS_FileServer",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "UserID": {
                            "value": "@dataset().FileShareUserID",
                            "type": "Expression"
                        },
                        "URL": {
                            "value": "@dataset().FileShareURL",
                            "type": "Expression"
                        },
                        "Password": {
                            "value": "@dataset().FileSharePassword",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "FileShareUserID": {
                        "type": "string",
                        "defaultValue": "srvEDWSMFT@tafenswtest.edu.au"
                    },
                    "Folder": {
                        "type": "string"
                    },
                    "File": {
                        "type": "string"
                    },
                    "FileShareURL": {
                        "type": "string",
                        "defaultValue": "FileServer-URL"
                    },
                    "FileSharePassword": {
                        "type": "string",
                        "defaultValue": "FileServer-ServiceAccount-Password"
                    }
                },
                "annotations": [],
                "type": "Binary",
                "typeProperties": {
                    "location": {
                        "type": "FileServerLocation",
                        "fileName": {
                            "value": "@dataset().File",
                            "type": "Expression"
                        },
                        "folderPath": {
                            "value": "@dataset().Folder",
                            "type": "Expression"
                        }
                    }
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/SRC_Oracle')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS_Oracle",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "kvSecret": {
                            "value": "@dataset().kvSecret",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "kvSecret": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "OracleTable",
                "typeProperties": {}
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/SRC_MySQL')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS_MySQL",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "kvSecret": {
                            "value": "@dataset().kvSecret",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "kvSecret": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "MySqlTable",
                "schema": [],
                "typeProperties": {}
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/RAW_SHAREPOINT_JSON')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS_SharePointOnlineList",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "AppID": {
                            "value": "@dataset().AppID",
                            "type": "Expression"
                        },
                        "AppSecret": {
                            "value": "@dataset().AppSecret",
                            "type": "Expression"
                        },
                        "SiteUrl": {
                            "value": "@dataset().SiteURL",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "AppID": {
                        "type": "string"
                    },
                    "AppSecret": {
                        "type": "string"
                    },
                    "SiteURL": {
                        "type": "string"
                    },
                    "ListName": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "SharePointOnlineListResource",
                "schema": [],
                "typeProperties": {
                    "listName": {
                        "value": "@dataset().ListName",
                        "type": "Expression"
                    }
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/RAW_ODATA_BASIC_JSON')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS_ODataSource_Basic",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "Username": {
                            "value": "@dataset().Username",
                            "type": "Expression"
                        },
                        "SecretName": {
                            "value": "@dataset().Password",
                            "type": "Expression"
                        },
                        "BaseUrl": {
                            "value": "@dataset().BaseUrl",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "Username": {
                        "type": "string"
                    },
                    "Password": {
                        "type": "string"
                    },
                    "BaseUrl": {
                        "type": "string"
                    },
                    "Table": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "ODataResource",
                "schema": [],
                "typeProperties": {
                    "path": {
                        "value": "@dataset().Table",
                        "type": "Expression"
                    }
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/BINARY_ADLS')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS-AzureDataLake",
                    "type": "LinkedServiceReference"
                },
                "parameters": {
                    "File": {
                        "type": "string"
                    },
                    "Container": {
                        "type": "string"
                    },
                    "Folder": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "Binary",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobStorageLocation",
                        "fileName": {
                            "value": "@dataset().File",
                            "type": "Expression"
                        },
                        "folderPath": {
                            "value": "@dataset().Folder",
                            "type": "Expression"
                        },
                        "container": {
                            "value": "@dataset().Container",
                            "type": "Expression"
                        }
                    }
                }
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/SRC_TEXT_FILE')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS-AzureDataLake",
                    "type": "LinkedServiceReference"
                },
                "parameters": {
                    "FileName": {
                        "type": "string"
                    },
                    "FileEncoding": {
                        "type": "string",
                        "defaultValue": "UTF-8"
                    },
                    "Container": {
                        "type": "string"
                    },
                    "Folder": {
                        "type": "string"
                    },
                    "ColumnDelim": {
                        "type": "string",
                        "defaultValue": ","
                    }
                },
                "annotations": [],
                "type": "DelimitedText",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobStorageLocation",
                        "fileName": {
                            "value": "@dataset().FileName",
                            "type": "Expression"
                        },
                        "folderPath": {
                            "value": "@dataset().Folder",
                            "type": "Expression"
                        },
                        "container": {
                            "value": "@dataset().Container",
                            "type": "Expression"
                        }
                    },
                    "columnDelimiter": {
                        "value": "@dataset().ColumnDelim",
                        "type": "Expression"
                    },
                    "encodingName": {
                        "value": "@dataset().FileEncoding",
                        "type": "Expression"
                    },
                    "escapeChar": "\\",
                    "firstRowAsHeader": true,
                    "quoteChar": "\""
                },
                "schema": []
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/RAW_REST_IRTAFE_Basic')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS_REST_IRTAFE_Basic",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "BaseUrl": {
                            "value": "@dataset().BaesUrl",
                            "type": "Expression"
                        },
                        "UserName": {
                            "value": "@dataset().UserName",
                            "type": "Expression"
                        },
                        "SecretKey": {
                            "value": "@dataset().SecretKey",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "BaesUrl": {
                        "type": "string",
                        "defaultValue": "https://manage.vc.tafensw.edu.au/"
                    },
                    "UserName": {
                        "type": "string",
                        "defaultValue": "API-VCPrexip-UserID"
                    },
                    "SecretKey": {
                        "type": "string",
                        "defaultValue": "API-VCPrexip-Password"
                    },
                    "RelativeURL": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "RestResource",
                "typeProperties": {
                    "relativeUrl": {
                        "value": "@dataset().RelativeURL",
                        "type": "Expression"
                    }
                },
                "schema": []
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/SRC_SQLServer')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS-SQLServer",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "kvSecret": {
                            "value": "@dataset().kvSecret",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "kvSecret": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "SqlServerTable",
                "schema": [],
                "typeProperties": {}
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/RAW_ADLS_JSON')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS-AzureDataLake",
                    "type": "LinkedServiceReference"
                },
                "parameters": {
                    "BlobPath": {
                        "type": "string"
                    },
                    "BlobName": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "Json",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobStorageLocation",
                        "fileName": {
                            "value": "@dataset().BlobName",
                            "type": "Expression"
                        },
                        "folderPath": {
                            "value": "@dataset().BlobPath",
                            "type": "Expression"
                        },
                        "container": "raw"
                    },
                    "compression": {
                        "type": "gzip",
                        "level": "Optimal"
                    }
                },
                "schema": {}
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/RAW_ADLS_Schema')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS-AzureDataLake",
                    "type": "LinkedServiceReference"
                },
                "parameters": {
                    "BlobPath": {
                        "type": "string"
                    },
                    "BlobName": {
                        "type": "string"
                    },
                    "Compression": {
                        "type": "string"
                    },
                    "ColumnDelim": {
                        "type": "string",
                        "defaultValue": ","
                    },
                    "HeaderRow": {
                        "type": "bool",
                        "defaultValue": true
                    }
                },
                "annotations": [],
                "type": "DelimitedText",
                "typeProperties": {
                    "location": {
                        "type": "AzureBlobStorageLocation",
                        "fileName": {
                            "value": "@dataset().BlobName",
                            "type": "Expression"
                        },
                        "folderPath": {
                            "value": "@dataset().BlobPath",
                            "type": "Expression"
                        },
                        "container": "raw"
                    },
                    "columnDelimiter": {
                        "value": "@dataset().ColumnDelim",
                        "type": "Expression"
                    },
                    "compressionCodec": {
                        "value": "@dataset().Compression",
                        "type": "Expression"
                    },
                    "compressionLevel": "Optimal",
                    "escapeChar": "\\",
                    "firstRowAsHeader": {
                        "value": "@dataset().HeaderRow",
                        "type": "Expression"
                    },
                    "quoteChar": ""
                },
                "schema": []
            },
            "dependsOn": []
        },
        {
            "name": "[concat(parameters('factoryName'), '/SRC_SQLAzure')]",
            "type": "Microsoft.DataFactory/factories/datasets",
            "apiVersion": "2018-06-01",
            "properties": {
                "linkedServiceName": {
                    "referenceName": "LS_SQLAzure",
                    "type": "LinkedServiceReference",
                    "parameters": {
                        "kvSecret": {
                            "value": "@dataset().kvSecret",
                            "type": "Expression"
                        }
                    }
                },
                "parameters": {
                    "kvSecret": {
                        "type": "string"
                    }
                },
                "annotations": [],
                "type": "SqlServerTable",
                "schema": [],
                "typeProperties": {}
            },
            "dependsOn": [
                "[concat(variables('factoryId'), '/linkedServices/LS_SQLAzure')]"
            ]
        },
        {
            "name": "[concat(parameters('factoryName'), '/06-Curated-UMD')]",
            "type": "Microsoft.DataFactory/factories/pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "SP-USP_RefreshUMDDataModel",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[UMD].[USP_RefreshUMDDataModel]"
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_SQLDB",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-SQLDB"
                            }
                        }
                    },
                    {
                        "name": "SP-USP_RefreshUMDDimFunding",
                        "type": "SqlServerStoredProcedure",
                        "dependsOn": [
                            {
                                "activity": "SP-USP_RefreshUMDDataModel",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "7.00:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "userProperties": [],
                        "typeProperties": {
                            "storedProcedureName": "[[UMD].[USP_RefreshUMDDimFunding]"
                        },
                        "linkedServiceName": {
                            "referenceName": "LS-AzureSqlDatabase_SQLDB",
                            "type": "LinkedServiceReference",
                            "parameters": {
                                "kvSecret": "AzureSqlDatabase-SQLDB"
                            }
                        }
                    }
                ],
                "folder": {
                    "name": "Curated"
                },
                "annotations": [],
                "lastPublishTime": "2021-06-24T12:03:06Z"
            },
            "dependsOn": []
        }
    ]
}